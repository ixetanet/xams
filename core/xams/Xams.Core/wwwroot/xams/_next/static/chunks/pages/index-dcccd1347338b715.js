(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{191:(e,t,l)=>{"use strict";l.d(t,{A:()=>i});var a=l(5834),n=l(7544),r=l(702),s=l(3218);let i=e=>{let t=(0,a.useContext)(n.BR),l=(0,a.useContext)(s.cy),i=async e=>{try{var a,n,r;let s=(null!=(a=null==l?void 0:l.apiUrl)?a:"")+e.url;void 0!==e.searchParams&&(s+="?".concat(e.searchParams.toString()));let i="";(null==l?void 0:l.getAccessToken)!==void 0&&(i=null!=(n=await l.getAccessToken())?n:"");let o=await fetch(s,{method:e.method,headers:{Authorization:"Bearer ".concat(i),...void 0!==e.body&&!(e.body instanceof FormData)&&{"Content-Type":"application/json"},...e.headers,...(null==l?void 0:l.headers)!==void 0&&(null==l?void 0:l.headers)},...(null==l?void 0:l.withCredentials)&&{credentials:"include"},...void 0!==e.body&&!(e.body instanceof FormData)&&{body:JSON.stringify(e.body)},...void 0!==e.body&&e.body instanceof FormData&&{body:e.body}});if(401===o.status)return(null==l?void 0:l.onUnauthorized)!==void 0&&l.onUnauthorized(),{succeeded:!1,data:void 0,friendlyMessage:"",logMessage:"",response:o};if(400===o.status&&!e.hideFailureMessage)if(void 0!==e.failureMessage)null==t||t.showError(e.failureMessage);else{let e=await o.json();return null==t||t.showError(e.friendlyMessage),console.error(e.logMessage),e}if(!1===o.ok){let e=await o.text();return null==t||t.showError(e),{succeeded:!1,data:void 0,friendlyMessage:e,logMessage:e,response:o}}let d=o.headers.get("content-type");if(d&&-1!==d.indexOf("application/octet-stream")&&((e,t)=>{let l=document.createElement("a");l.href=URL.createObjectURL(e),l.download=t,document.body.appendChild(l),l.click(),setTimeout(()=>{document.body.removeChild(l),URL.revokeObjectURL(l.href)},0)})(await o.blob(),null!=(r=e.fileName)?r:"file"),!d||-1===d.indexOf("application/json"))return{succeeded:!0,data:o.body,friendlyMessage:"",logMessage:"",response:o};{let l=await o.json();return!1===l.succeeded&&((void 0===e.hideFailureMessage||!1===e.hideFailureMessage)&&(null==t||t.showError(l.friendlyMessage)),console.error(l.logMessage)),l}}catch(l){return console.error(l),(void 0===e.hideFailureMessage||!1===e.hideFailureMessage)&&void 0!==e.failureMessage&&(null==t||t.showError(JSON.stringify(l))),{succeeded:!1,data:void 0,friendlyMessage:"",logMessage:"",response:void 0}}},o=async e=>{let t=await fetch("".concat(null==l?void 0:l.apiUrl,"/config?name=").concat(e),{method:"GET"});return t.ok?await t.json():null},d=async()=>await i({url:r.Q3,method:"GET"}),c=async e=>{let t=await i({url:r.rG,method:"POST",body:{method:"has_permissions",parameters:{permissionNames:e}}});return!0===t.succeeded&&t.data.length===e.length||!1},m=async e=>{let t=await i({url:r.rG,method:"POST",body:{method:"has_permissions",parameters:{permissionNames:e}}});return!0===t.succeeded&&!!(t.data.length>0)||!1},u=async e=>{let t=await i({url:r.qK,method:"POST",body:{method:"table_metadata",parameters:{tableName:e}}});return null==t?void 0:t.data},p=async e=>await i({url:r.qK,method:"POST",body:{method:"table_list",parameters:{tag:e}}}),f=async function(e,t){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return await i({method:"POST",url:r.Lx,body:{tableName:e,fields:t,parameters:l}})},E=async(e,t,l)=>await i({method:"PATCH",url:r.I7,body:{tableName:e,fields:t,parameters:l}}),h=async(e,t,l)=>await i({method:"DELETE",url:r.UK,body:{tableName:e,id:t,fields:{},parameters:l}}),v=async(e,t,l)=>await i({method:"POST",url:r.Wf,body:{tableName:e,fields:t,parameters:l}}),y=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return await i({method:"POST",url:r.Lx,body:{entities:e,parameters:t}})},g=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return await i({method:"PATCH",url:r.I7,body:{entities:e,parameters:t}})},b=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return await i({method:"DELETE",url:r.UK,body:{entities:e,parameters:t}})},N=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return await i({method:"POST",url:r.Wf,body:{entities:e,parameters:t}})},I=async function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1],await i({url:r.vh,method:"POST",body:e})},w=async e=>await i({method:"POST",url:r.V8,body:e}),C=async(e,t,l)=>await i({method:"POST",url:r.nm,body:{name:e,parameters:t},fileName:l}),x=async e=>await i({method:"POST",url:r.N$,body:e});return(0,a.useMemo)(()=>({execute:i,config:o,whoAmI:d,hasAllPermissions:c,hasAnyPermissions:m,tables:p,metadata:u,create:f,read:w,update:E,delete:h,upsert:v,bulkCreate:y,bulkUpdate:g,bulkDelete:b,bulkUpsert:N,bulk:I,action:C,file:x}),[null==l?void 0:l.apiUrl,null==l?void 0:l.headers,null==l?void 0:l.onUnauthorized])}},646:(e,t,l)=>{"use strict";l.d(t,{Ay:()=>s,cK:()=>n,xW:()=>r});var a=l(5834);let n=a.createContext(null),r=()=>{let e=a.useContext(n);if(!e)throw Error("useFormContext must be used within a FormContextProvider");return e},s=e=>a.createElement(n.Provider,{value:{formBuilder:e.formBuilder}},e.children)},702:(e,t,l)=>{"use strict";l.d(t,{I7:()=>o,Lx:()=>s,N$:()=>p,Q3:()=>a,UK:()=>d,V8:()=>i,Wf:()=>c,nm:()=>u,qK:()=>r,rG:()=>n,vh:()=>m});let a="/xams/WhoAmI",n="/xams/Permissions",r="/xams/MetaData",s="/xams/Create",i="/xams/Read",o="/xams/Update",d="/xams/Delete",c="/xams/Upsert",m="/xams/Bulk",u="/xams/Action",p="/xams/File"},777:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>e5});var a=l(6514),n=l(191),r=l(5261),s=l(5050),i=l(5627),o=l(9967),d=l(5834),c=l(4918),m=l(702),u=l(2651),p=l(2903),f=l(4180),E=l(8979);let h=e=>{let t=(0,n.A)(),[l,a]=d.useState([]),[s,i]=d.useState(!0),c=async()=>{i(!0),await t.execute({url:m.nm,method:"POST",body:{name:"ADMIN_ExportData",parameters:{tables:l.filter(e=>!0===e.checked).map(e=>({name:e.Name,dependencies:e.Dependencies.filter(e=>!0===e.checked).map(e=>({name:e.Name}))}))}},fileName:"export_".concat(new Date().toLocaleString().replaceAll(" ",""),".json")}),e.close()},h=async()=>{i(!0);let e=await t.execute({url:m.nm,method:"POST",body:{name:"ADMIN_ExportDependencies"}});if((null==e?void 0:e.succeeded)===!0){let t=e.data;for(let e of t)for(let t of(e.checked=!1,e.Dependencies))t.checked=!1,t.disabled=!1;a(t)}i(!1)},v=(e,t)=>{let l=!1;for(let a of e)if(a.Name===t){l=!a.checked;break}let n=e.map(e=>e);y(t,n,[],l),a(n)},y=(e,t,l,a)=>{if(!l.includes(e))for(let n of(l.push(e),t))if(n.Name===e)for(let e of(n.checked=a,n.disabled=!1,n.Dependencies))!1===e.Optional&&(e.checked=a,e.disabled=a,y(e.Name,t,l,a));else for(let t of n.Dependencies)t.Name===e&&(t.checked=a,t.disabled=a)};return(0,d.useEffect)(()=>{!0===e.opened&&(i(!1),a([]),h())},[e.opened]),d.createElement(u.a,{opened:e.opened,onClose:e.close,title:"Export Data",styles:{body:{overflow:"hidden",position:"relative",padding:"0px"}},centered:!0},!0===s&&d.createElement("div",{className:"absolute w-full h-full flex justify-center items-center overflow-hidden z-30"},d.createElement(r.a,null)),d.createElement("div",{className:"p-4 ".concat(s?"invisible":"")},d.createElement(p.F,{h:650},d.createElement("div",{className:" pl-2 flex flex-col gap-2"},l.map(e=>d.createElement("div",{key:e.Name},d.createElement("div",null,d.createElement(f.S,{styles:{input:{cursor:"pointer"},label:{cursor:"pointer"}},checked:e.checked,disabled:e.disabled,onChange:()=>{},onClick:()=>{v(l,e.Name)},label:e.Name})),d.createElement("div",{className:"flex flex-col gap-1"},e.Dependencies.map(e=>d.createElement("div",{key:"".concat(E.A.name,"-").concat(e.Name),className:"ml-8"},d.createElement(f.S,{styles:{input:{cursor:"pointer"},label:{cursor:"pointer"}},label:e.Name,checked:e.checked,onChange:()=>{},disabled:e.disabled,onClick:()=>v(l,e.Name)})))))))),d.createElement("div",{className:"w-full flex justify-end mt-4"},d.createElement(o.$,{onClick:c},"Export"))))};var v=l(9590);let y=e=>{let t=(0,n.A)(),[l,a]=d.useState(null),[s,i]=d.useState(!1),c=(0,d.useRef)(null),p=(0,d.useRef)(!1),f=(0,d.useRef)(null),E=async()=>{if(!p.current){p.current=!0;try{let l=await t.action("ADMIN_ImportData",{jobHistoryId:c.current});if(!l.succeeded){p.current=!1;return}let a=l.data.jobStatus;"Running"!==a&&"Not Started"!==a&&(clearInterval(f.current),f.current=null,i(!1),"Failed"===a?console.error("Job failed",l.data.jobMessage):"Completed"===a&&(console.log("Job completed successfully"),e.close())),console.log(a)}catch(e){p.current=!1;return}p.current=!1}},h=async()=>{if(null===l)return;i(!0);let e=new FormData;e.append("file",l),e.append("name","ADMIN_ImportData");let a=await t.execute({url:m.N$,method:"POST",body:e});a.succeeded&&(c.current=a.data.jobHistoryId,f.current=setInterval(E,2e3))};return(0,d.useEffect)(()=>{!0===e.opened&&(i(!1),a(null),c.current=null,null!=f.current&&clearInterval(f.current))},[e.opened]),d.createElement(u.a,{opened:e.opened,onClose:e.close,size:"md",title:"Import Data",closeOnEscape:!s,closeOnClickOutside:!s,withCloseButton:!s,styles:{body:{overflow:"hidden",position:"relative",padding:"0px"}},centered:!0},!0===s&&d.createElement("div",{className:"absolute w-full h-full  flex justify-center items-center overflow-hidden z-30"},d.createElement(r.a,null)),d.createElement("div",{className:"p-4 ".concat(s?"invisible":"")},d.createElement(v.z,{label:"File Upload",placeholder:"Click to choose data file",required:!0,value:l,onChange:e=>{a(e)}}),d.createElement("div",{className:"w-full flex justify-end mt-4"},d.createElement(o.$,{onClick:h,disabled:null===l},"Upload"))))};var g=l(7188),b=l(6508),N=l(6300),I=l(3108);let w=e=>{let{colorScheme:t,toggleColorScheme:l}=(0,g.C)(),[a,n]=d.useState(!1);if((0,d.useEffect)(()=>{n(!0)},[]),"dark"===t?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),!a)return null;let r="dark"===t,s="yellow";return r&&e.darkColor&&(s=e.darkColor),!r&&e.lightColor&&(s=e.lightColor),d.createElement(b.M,{variant:"outline",color:s,onClick:()=>l(),title:"Toggle color scheme"},r?d.createElement(N.A,{size:"1.1rem"}):d.createElement(I.A,{size:"1.1rem"}))};var C=l(8779);let x=d.createContext(null),A=()=>{let e=d.useContext(x);if(!e)throw Error("useAdminDashContext must be used within a AdminDashContextProvider");return e};var T=l(8588),S=l(8309);let R=d.lazy(()=>Promise.resolve().then(l.bind(l,9583))),D=(0,d.forwardRef)((e,t)=>{let[l,a]=(0,d.useState)(!1),n=d.useRef(null);if((0,d.useImperativeHandle)(t,()=>n.current),(0,d.useEffect)(()=>{a(!0)},[]),!l)return d.createElement("div",{className:"w-full h-full flex justify-center items-center"},d.createElement(r.a,null));let s=e.tableName+JSON.stringify(e.filters)+JSON.stringify(e.joins)+JSON.stringify(e.orderBy)+JSON.stringify(e.except)+JSON.stringify(e.additionalFields)+JSON.stringify(e.fields)+JSON.stringify(e.maxResults);return d.createElement(R,{key:s,ref:n,...e})});var k=l(7828),_=l(2702),F=l(1916);let L=e=>d.createElement(d.Fragment,null,d.createElement("span",null,"Id: ",e.value),d.createElement(k.i,{value:e.value},e=>{let{copied:t,copy:l}=e;return d.createElement(o.$,{variant:"subtle",styles:{root:{paddingRight:4,paddingLeft:4}},onClick:l},t?d.createElement(_.A,{size:16}):d.createElement(F.A,{className:"mr-1",size:16}),t?"Copied":"Copy")})),B=()=>{var e;let t=A();return d.createElement(d.Fragment,null,t.tables.length>0&&!(null==(e=t.props.hiddenMenuItems)?void 0:e.includes("Entities"))&&d.createElement(T.k,{label:"Entities",leftSection:d.createElement(S.A,{size:16,strokeWidth:2,color:t.color})},t.tables.filter(e=>{var l,a;return"System"!==e.tag&&(null==(l=t.props.hiddenEntities)?void 0:l.includes(e.tableName))!==!0&&(void 0===t.props.visibleEntities||(null==(a=t.props.visibleEntities)?void 0:a.includes(e.tableName)))}).sort((e,l)=>t.props.showEntityDisplayNames?e.displayName.localeCompare(l.displayName):e.tableName.localeCompare(l.tableName)).map(e=>d.createElement(T.k,{key:e.tableName,label:t.props.showEntityDisplayNames?e.displayName:e.tableName,leftSection:d.createElement(S.A,{size:16,strokeWidth:2,color:t.color}),onClick:()=>t.setActiveComponent(t=>({component:d.createElement(D,{tableName:e.tableName,maxResults:100,showActiveSwitch:!0,canDeactivate:!0,formMinWidth:36,formAppendButton:e=>d.createElement(d.Fragment,null,"UPDATE"===e.operation&&d.createElement("div",{className:"w-full flex justify-start items-center gap-1"},d.createElement(L,{value:e.data["".concat(e.tableName,"Id")]})))})}))}))))};var P=l(4821),O=l(2037),M=l(330),U=l(781);let W=e=>d.createElement("div",{className:"flex justify-center items-center w-full h-full"},"none"===e.icon&&d.createElement("svg",{width:"20",height:"20",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"cursor-pointer",onClick:e.onClick},d.createElement("rect",{x:"2.00024",y:"2",width:"28",height:"28",rx:"6",stroke:"#4B4B4B",strokeWidth:"4"})),"user"===e.icon&&d.createElement("svg",{width:"20",height:"20",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"cursor-pointer",onClick:e.onClick},d.createElement("rect",{x:"2.00024",y:"2",width:"28",height:"28",rx:"6",stroke:"#4B4B4B",strokeWidth:"4"}),d.createElement("mask",{id:"mask0_712_5305",maskUnits:"userSpaceOnUse",x:"4",y:"16",width:"12",height:"12"},d.createElement("path",{d:"M4 16V28H16L4 16Z",fill:"#D9D9D9"})),d.createElement("g",{mask:"url(#mask0_712_5305)"},d.createElement("rect",{x:"4.00024",y:"4",width:"24",height:"24",rx:"4",fill:"#991B1B"}))),"team"===e.icon&&d.createElement("svg",{width:"20",height:"20",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"cursor-pointer",onClick:e.onClick},d.createElement("rect",{x:"2",y:"2",width:"28",height:"28",rx:"6",stroke:"#4B4B4B",strokeWidth:"4"}),d.createElement("mask",{id:"mask0_712_5300",maskUnits:"userSpaceOnUse",x:"4",y:"4",width:"24",height:"24"},d.createElement("path",{d:"M4 28H28L4 4V28Z",fill:"#D9D9D9"})),d.createElement("g",{mask:"url(#mask0_712_5300)"},d.createElement("rect",{x:"4",y:"4",width:"24",height:"24",rx:"4",fill:"#F59E0B"}))),"system"===e.icon&&d.createElement("svg",{width:"20",height:"20",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"cursor-pointer",onClick:e.onClick},d.createElement("rect",{x:"2",y:"2",width:"28",height:"28",rx:"6",stroke:"#4B4B4B",strokeWidth:"4"}),d.createElement("rect",{x:"4",y:"4",width:"24",height:"24",rx:"4",fill:"#84CC16"})));var j=l(9254),z=l(4296),V=l(3742),H=l(2360),G=l(9089),q=l(2009);let K=d.createContext(null),J=()=>{let e=d.useContext(K);if(!e)throw Error("useDataGridContext must be used within a DataGridContextProvider");return e},X=d.createContext(null),Y=e=>{let t=J();return d.createElement("div",{className:"w-full"},d.createElement("input",{type:"text",style:{zIndex:null!=t.props.zIndex?t.props.zIndex+1:2,textAlign:e.rightAlign?"right":"left"},className:"w-full h-full border-none outline-none",value:t.editValue,onChange:e=>{let l=e.target.value;if(t.activeCell&&t.activeCell.onEditing&&t.activeCellLocation){var a;l=t.activeCell.onEditing(l,t.activeCellLocation,null==(a=t.activeCell)?void 0:a.data)}t.setEditValue(l)},autoFocus:!0}))};var $=l(336);let Q=e=>e.isEditing||null==e.errorMessage||""===e.errorMessage?d.createElement(d.Fragment,null):d.createElement($.m,{label:e.errorMessage,color:"#dc2626",withArrow:!0},d.createElement("div",{className:"absolute w-full h-full flex justify-start items-center"},d.createElement("div",{className:"w-4 h-4 text-xs text-white rounded-full bg-red-600 flex justify-center items-center font-bold ml-1"},"!"))),Z=e=>{var t,l,a,n,r;let s=J(),i=(()=>{let e=d.useContext(X);if(!e)throw Error("useSubGrid must be used within a SubGridContextProvider");return e})(),o=(0,d.useRef)(null),c=(0,C.A)();if(null==s.props.rows[e.rowIndex+i.skipRows])return;let m=s.props.rows[e.rowIndex+i.skipRows].columns[e.columnIndex+i.skipColumns],u={row:e.rowIndex+i.skipRows,col:e.columnIndex+i.skipColumns},p=null!=(a=m.value)?a:"",f=null==p?"":p.toString(),E="light"===c.colorScheme?"bg-gray-200":"bg-neutral-800",h=s.props.rightAlignNumbers&&(e=>"string"==typeof e&&!isNaN(e)&&!isNaN(parseFloat(e)))(f),v=s.props.rows[e.rowIndex+i.skipRows].columns[e.columnIndex+i.skipColumns].style,y=(null==(t=s.activeCellLocation)?void 0:t.row)===e.rowIndex+i.skipRows&&(null==(l=s.activeCellLocation)?void 0:l.col)===e.columnIndex+i.skipColumns;return d.createElement(d.Fragment,null,d.createElement("div",{key:e.columnIndex,ref:o,style:{...e.style,borderRight:"1px solid gray",borderBottom:"1px solid gray",...null!=v?v:{}},className:"h-full ".concat(null==m.custom?"py-0.5":""," relative whitespace-nowrap text-ellipsis text-sm flex items-center ").concat(m.isDisabled?E:""," ").concat(h?"justify-end":""," ").concat(!1===s.props.editable?"":"cursor-pointer"),onClick:()=>((e,t)=>{let l=s.props.rows[e+i.skipRows].columns[t+i.skipColumns].onClick;if(null!=l){let a=s.props.rows[e+i.skipRows].columns[t+i.skipColumns].data;l(p,{row:e+i.skipRows,col:t+i.skipColumns},a)}!1!==s.props.editable&&(s.setActiveCellLocation({row:e+i.skipRows,col:t+i.skipColumns}),s.isEditing&&s.onEndEdit())})(e.rowIndex,e.columnIndex),onDoubleClick:()=>s.onKeyDown(window,void 0,f)},!y&&null!=m.errorMessage&&d.createElement(Q,{isEditing:y&&s.isEditing,errorMessage:m.errorMessage}),d.createElement("div",{onMouseDown:t=>{s.gridResize.setIsResizing(!0),s.gridResize.setResizingStartClientX(t.clientX),s.gridResize.setResizingColNumber(e.columnIndex+i.skipColumns)},style:{zIndex:(null!=(n=s.props.zIndex)?n:0)+2},className:"absolute -right-1 top-0 w-1.5 h-full cursor-ew-resize"}),y?d.createElement("div",{style:{pointerEvents:"none",boxSizing:s.isEditing?"content-box":"border-box",zIndex:null!=(r=s.props.zIndex)?r:1},className:"absolute ".concat(s.isEditing?"-top-0.5 -left-0.5 border-blue-400 border-2":"top-0 left-0 border-blue-600 border-1","  w-full h-full border-solid")},null!=m.errorMessage&&d.createElement("div",{className:"w-full h-full absolute"},d.createElement(Q,{isEditing:y&&s.isEditing,errorMessage:m.errorMessage})),d.createElement("div",{className:"w-full h-full ".concat(s.isEditing?"border-2 border-solid border-blue-600 flex items-center":""," ")},s.isEditing&&d.createElement(Y,{rightAlign:null!=h&&h}))):"",null!=m.custom?m.custom(p,u,m.data):"",null==m.custom&&d.createElement("span",{className:" overflow-hidden px-1"},""===f.replaceAll(" ","")?"\xa0":f)))},ee=(0,d.forwardRef)((e,t)=>{var l;let[a,n]=(0,d.useState)(void 0),[r,s]=(0,d.useState)(!1),[i,o]=(0,d.useState)(""),c=(0,d.useRef)(!1),m=(0,d.useRef)(!1),u=(0,d.useRef)(null),p=(0,d.useRef)(null),f=(0,d.useRef)(null),E=(0,d.useRef)(null),h=(0,d.useRef)(null);(e=>{if(e.rows.length>0){if(void 0===e.rows[0].columns||0===e.rows[0].columns.length)throw Error("DataGrid: rows must contain columns");let t=e.rows[0].columns.length;for(let l of e.rows){if(null==l.columns)throw Error("DataGrid: rows must contain columns");if(l.columns.length!==t)throw Error("DataGrid: rows must contain the same number of columns")}if("number"!=typeof e.columnWidths&&e.columnWidths.length!==t)throw Error("DataGrid: columnWidths ".concat(e.columnWidths," must be the same length as the number of columns ").concat(t))}})(e);let v=(0,d.useCallback)(e=>{let{scrollLeft:t,scrollTop:l,scrollUpdateWasRequested:a}=e;if(!a){var n,r;null==(n=f.current)||n.scrollTo({scrollLeft:0,scrollTop:l}),null==(r=E.current)||r.scrollTo({scrollLeft:t,scrollTop:0})}},[]),y=(e=>{let[t,l]=(0,d.useState)(!1),[a,n]=(0,d.useState)(void 0),[r,s]=(0,d.useState)(void 0),[i,o]=(0,d.useState)(e.columnWidths),[c,m]=(0,d.useState)(e.columnWidths),[u,p]=(0,d.useState)({startX:0,startY:0,endY:0,clientX:0,clientY:0}),f=()=>{if(t){if(l(!1),null==r)return;let e=u.clientX-a,t=[...c],n=t[r]+e;n<32&&(n=32),t[r]=n,m(t)}};return(0,d.useEffect)(()=>(window.addEventListener("mouseup",f),()=>{window.removeEventListener("mouseup",f)})),(0,d.useEffect)(()=>{if(e.columnWidths.length!==i.length)o(e.columnWidths),m(e.columnWidths);else for(let t=0;t<e.columnWidths.length;t++)if(e.columnWidths[t]!==i[t]){o(e.columnWidths),m(e.columnWidths);break}},[e.columnWidths]),{isResizing:t,setIsResizing:l,resizingStartClientX:a,setResizingStartClientX:n,resizingColNumber:r,setResizingColNumber:s,columnWidths:c,setColWidths:m,onMouseMove:l=>{if(t&&l.preventDefault(),!e.divRef.current)return;let a=e.divRef.current.getBoundingClientRect();p({startX:l.clientX-a.left,startY:0,endY:a.height,clientX:l.clientX,clientY:l.clientY})},mousePosition:u}})({rows:e.rows,divRef:u,columnWidths:"number"==typeof e.columnWidths&&e.rows.length>0?Array(e.rows[0].columns.length).fill(e.columnWidths):"object"==typeof e.columnWidths?e.columnWidths:[]}),g=e.rows.length>0&&e.rows[0].columns.length>0?e.rows[0].columns.length:0,b=y.columnWidths.slice(0,null!=(l=e.snapColumns)?l:0).reduce((e,t)=>e+t,0),N=!1,I=(t,l,r)=>{if(!1!==e.editable&&((null==l?void 0:l.key)==="Shift"&&(c.current=!0),(null==l?void 0:l.key)==="Control"&&(m.current=!0),!N)){if(void 0===l)return void w(l,r);if(a){let t=e.rows[a.row].columns[a.col];if("Delete"===l.key&&(null!=e.onDelete&&e.onDelete(i,a,t.data),null!=t.onDelete&&t.onDelete(i,a,t.data)),"Backspace"===l.key&&(null!=e.onBackspace&&e.onBackspace(i,a,t.data),null!=t.onBackspace&&t.onBackspace(i,a,t.data)),("ArrowDown"===l.key||"ArrowUp"===l.key||"ArrowLeft"===l.key||"ArrowRight"===l.key||"Enter"===l.key||"Escape"===l.key||"Tab"===l.key)&&l.preventDefault(),"ArrowDown"===l.key){if(a.row===e.rows.length-1)return;C(),n({row:a.row+1,col:a.col}),N=!0}else if("ArrowUp"===l.key){if(0===a.row)return;C(),n({row:a.row-1,col:a.col}),N=!0}else if("ArrowLeft"===l.key){if(0===a.col)return;C(),n({row:a.row,col:a.col-1}),N=!0}else if("ArrowRight"===l.key){if(a.col===e.rows[0].columns.length-1)return;C(),n({row:a.row,col:a.col+1}),N=!0}else if("Enter"===l.key){if(C(),a.row===e.rows.length-1)return;n({row:a.row+1,col:a.col})}else if("Escape"===l.key)x();else if("Tab"===l.key){if(C(),c.current){if(0===a.col)return;n({row:a.row,col:a.col-1})}else{if(a.col===e.rows[0].columns.length-1)return;n({row:a.row,col:a.col+1})}l.stopPropagation()}else m.current||w(l)}}},w=(t,l)=>{if(!r&&a){let n=e.rows[a.row].columns[a.col].isReadOnly,r=e.rows[a.row].columns[a.col].isDisabled;if(n||r)return;null==t&&(o(null!=l?l:""),s(!0)),null!=t&&1===t.key.length&&(o(""),s(!0))}N=!1},C=()=>{if(a&&r){let t=e.rows[a.row].columns[a.col];null!=e.onEndEdit&&e.onEndEdit(i,a,t.data),null!=t.onEndEdit&&t.onEndEdit(i,a,t.data),o(""),s(!1)}},x=()=>{o(""),s(!1)};(0,d.useEffect)(()=>{let e=e=>{I(window,e)},t=e=>{"Shift"===e.key&&(c.current=!1),"Control"===e.key&&(m.current=!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[a,r,i]);let A=e=>{u.current&&!u.current.contains(e.target)&&n(void 0)},T=()=>{var e,t,l,a;null==p||null==(e=p.current)||e.resetAfterColumnIndex(0),null==(t=f.current)||t.resetAfterColumnIndex(0),null==(l=E.current)||l.resetAfterColumnIndex(0),null==(a=h.current)||a.resetAfterColumnIndex(0)};(0,d.useImperativeHandle)(t,()=>({reset:()=>{T()},activeCell:a,setActiveCell:e=>{n(e)},isEditing:r,editValue:i,setEditValue:e=>{o(e)}})),(0,d.useEffect)(()=>{T()},[y.columnWidths]),(0,d.useEffect)(()=>(document.addEventListener("click",A,!0),()=>{document.removeEventListener("click",A,!0)}),[]);let S="";if(null!=e.columnWidths&&"object"==typeof e.columnWidths)for(let e=0;e<y.columnWidths.length;e++)S+=y.columnWidths[e];else S=e.columnWidths.toString();return d.createElement("div",{key:"".concat(e.snapColumns,"-").concat(e.snapRows,"-").concat(S),ref:u,className:"w-full h-full relative",onMouseMove:e=>y.onMouseMove(e)},y.isResizing&&d.createElement("div",{style:{top:y.mousePosition.startY,left:y.mousePosition.startX,border:"1px solid black",width:1,height:y.mousePosition.endY,zIndex:null==e.zIndex?2:e.zIndex+2},className:"absolute"}),d.createElement(G.Ay,null,t=>{var l,c,m,u,N,w,x,A,T;let{height:S,width:R}=t;return d.createElement(K.Provider,{value:{props:e,activeCell:null!=a&&null!=e.rows[a.row]&&null!=e.rows[a.row].columns[a.col]?e.rows[a.row].columns[a.col]:void 0,editValue:i,setEditValue:o,activeCellLocation:a,setActiveCellLocation:n,isEditing:r,setIsEditing:s,onKeyDown:I,onEndEdit:C,gridResize:y}},d.createElement("div",{style:{display:"flex",flexDirection:"row",width:R,height:S}},null!=e.snapColumns&&e.snapColumns>0&&d.createElement("div",{style:{width:b,height:"100%"}},null!=e.snapRows&&e.snapRows>0&&d.createElement(X.Provider,{value:{skipColumns:0,skipRows:0}},d.createElement(q.cB,{ref:p,columnCount:e.snapColumns,rowCount:e.snapRows,columnWidth:e=>y.columnWidths[e],rowHeight:e=>30,height:30*e.snapRows,width:b,style:{overflow:"hidden",...e.styletl},className:" border border-solid border-gray-500"},Z)),d.createElement(X.Provider,{value:{skipColumns:0,skipRows:null!=(l=e.snapRows)?l:0}},d.createElement(q.cB,{ref:f,columnCount:e.snapColumns,rowCount:e.rows.length-(null!=(c=e.snapRows)?c:0),columnWidth:e=>y.columnWidths[e],rowHeight:e=>30,height:S-(null!=(m=e.snapRows)?m:0)*30,width:b,style:{overflow:"hidden",...e.stylebl},className:" border border-solid border-gray-500"},Z))),d.createElement("div",{className:"w-full h-full flex flex-col"},null!=e.snapRows&&e.snapRows>0&&d.createElement(X.Provider,{value:{skipColumns:null!=(u=e.snapColumns)?u:0,skipRows:0}},d.createElement(q.cB,{ref:E,columnCount:g-(null!=(N=e.snapColumns)?N:0),rowCount:e.snapRows,columnWidth:t=>{var l;return y.columnWidths[t+(null!=(l=e.snapColumns)?l:0)]},rowHeight:e=>30,height:30*e.snapRows,width:null!=e.snapColumns&&e.snapColumns>0?R-b:R,style:{overflow:"hidden",...e.styletr},className:" border border-solid border-gray-500"},Z)),d.createElement(X.Provider,{value:{skipColumns:null!=(w=e.snapColumns)?w:0,skipRows:null!=(x=e.snapRows)?x:0}},d.createElement(q.cB,{ref:h,onScroll:v,columnCount:g-(null!=(A=e.snapColumns)?A:0),rowCount:e.rows.length-(null!=(T=e.snapRows)?T:0),columnWidth:t=>{var l;return console.log(e.snapColumns),y.columnWidths[t+(null!=(l=e.snapColumns)?l:0)]},rowHeight:e=>30,height:null!=e.snapRows&&e.snapRows>0?S-30*e.snapRows:S,width:null!=e.snapColumns&&e.snapColumns>0?R-b:R,style:{...e.style},className:"thin-scrollbar-x border border-solid border-gray-500"},Z)))))}))});ee.displayName="DataGrid";let et="64589861-0481-4dbb-a96f-9b8b6546c40d",el=e=>{let[t,l]=(0,d.useState)([]),a=(t,n,r,s)=>{let i=!s;if(""===r&&i){var o;let t={RoleId:e.roleId,PermissionId:null==(o=e.state.allPermissions.find(e=>e.Name===n))?void 0:o.PermissionId,Permission:"permission.".concat(n)};e.setState(e=>({...e,createRolePermissions:[...e.createRolePermissions,t],deleteRolePermissions:e.deleteRolePermissions.filter(e=>e.Permission!=="permission.".concat(n))}))}else""!==r||i?""===r||i?""!==r&&i&&e.setState(e=>({...e,createRolePermissions:e.createRolePermissions.filter(e=>e.PermissionId!==r||e.Permission!=="permission.".concat(n)),deleteRolePermissions:e.deleteRolePermissions.filter(e=>e.RolePermissionId!==r)})):e.setState(e=>({...e,createRolePermissions:e.createRolePermissions.filter(e=>e.PermissionId!==r||e.Permission!=="permission.".concat(n)),deleteRolePermissions:[...e.deleteRolePermissions,{RolePermissionId:r}]})):e.setState(e=>({...e,createRolePermissions:e.createRolePermissions.filter(e=>e.Permission!=="permission.".concat(n))}));l(e=>{let l=[...e],s=l[t.row],o={...s.columns[t.col]};return o.custom=(e,t)=>d.createElement(W,{icon:i?"system":"none",onClick:()=>a(t,n,r,i)}),s.columns[t.col]=o,l})},n=(t,a,r,s,i)=>{let o="none",c=t;t.endsWith("NONE")?(c=c.substring(0,t.length-4).concat("USER"),o="user"):t.endsWith("USER")?(c=c.substring(0,t.length-4).concat("TEAM"),o="team"):t.endsWith("TEAM")?(c=c.substring(0,t.length-4).concat("SYSTEM"),o="system"):t.endsWith("SYSTEM")&&(c=c.substring(0,t.length-6).concat("NONE"),o="none"),"none"===o&&null!=r&&e.setState(e=>({...e,deleteRolePermissions:[...e.deleteRolePermissions,{RolePermissionId:r}],updateRolePermissions:e.updateRolePermissions.filter(e=>e.RolePermissionId!==r),createRolePermissions:e.createRolePermissions.filter(e=>e.PermissionId!==r)})),"none"!==o&&null==r&&e.setState(t=>{var l;return{...t,createRolePermissions:[...t.createRolePermissions.filter(e=>e.Permission!=="".concat(s,".").concat(i)),{RolePermissionId:"",RoleId:e.roleId,PermissionId:null==(l=e.state.allPermissions.find(e=>e.Name===c))?void 0:l.PermissionId,Permission:"".concat(s,".").concat(i)}]}}),"none"!==o&&null!=r&&e.setState(t=>{var l;return{...t,updateRolePermissions:[...t.updateRolePermissions.filter(e=>e.RolePermissionId!==r),{RolePermissionId:r,PermissionId:null==(l=e.state.allPermissions.find(e=>e.Name===c))?void 0:l.PermissionId}],deleteRolePermissions:t.deleteRolePermissions.filter(e=>e.RolePermissionId!==r)}}),l(e=>e.map((e,t)=>({columns:e.columns.map((e,l)=>t===a.row&&l===a.col?{...e,custom:(e,t)=>d.createElement(W,{icon:o,onClick:()=>n(c,t,r,s,i)})}:e)})))};return{toggleBinaryPermission:a,toggleTablePermission:n,rows:t,setRows:l}},ea=e=>{let t=el(e),l=(e,t,l)=>{var a,n,r,s,i;let o="none",d=e.find(e=>{var a;return null==(a=e.Permission)?void 0:a.startsWith("TABLE_".concat(t,"_").concat(l))});return null==d?{permissionLevel:"none",RolePermissionId:null}:(((null==(a=d.Permission)?void 0:a.endsWith("IMPORT"))||(null==(n=d.Permission)?void 0:n.endsWith("EXPORT")))&&(o="system"),(null==(r=d.Permission)?void 0:r.endsWith("USER"))&&(o="user"),(null==(s=d.Permission)?void 0:s.endsWith("TEAM"))&&(o="team"),(null==(i=d.Permission)?void 0:i.endsWith("SYSTEM"))&&(o="system"),{permissionLevel:o,RolePermissionId:d.RolePermissionId})};return(0,d.useEffect)(()=>{((a,n)=>{let r=[];for(let s of(r.push({columns:[{value:"Entity",isReadOnly:!0,style:{}},{value:"Create",isReadOnly:!0,style:{justifyContent:"center"}},{value:"Read",isReadOnly:!0,style:{justifyContent:"center"}},{value:"Update",isReadOnly:!0,style:{justifyContent:"center"}},{value:"Delete",isReadOnly:!0,style:{justifyContent:"center"}},{value:"Assign",isReadOnly:!0,style:{justifyContent:"center"}},{value:"Import",isReadOnly:!0,style:{justifyContent:"center"}},{value:"Export",isReadOnly:!0,style:{justifyContent:"center"}}]}),n)){let n=l(a,s.tableName,"CREATE"),i=l(a,s.tableName,"READ"),o=l(a,s.tableName,"UPDATE"),c=l(a,s.tableName,"DELETE"),m=l(a,s.tableName,"ASSIGN"),u=l(a,s.tableName,"IMPORT"),p=l(a,s.tableName,"EXPORT"),f=e.roleId!==et,E={columns:[{value:s.tableName,isReadOnly:!0,style:{border:"none",userSelect:"none"}},{custom:(e,l)=>d.createElement(W,{icon:n.permissionLevel,onClick:()=>f&&t.toggleTablePermission("TABLE_".concat(s.tableName,"_CREATE_").concat(n.permissionLevel.toUpperCase()),l,n.RolePermissionId,s.tableName,"CREATE")}),isReadOnly:!0,style:{justifyContent:"center",border:"none",userSelect:"none"}},{custom:(e,l)=>d.createElement(W,{icon:i.permissionLevel,onClick:()=>f&&t.toggleTablePermission("TABLE_".concat(s.tableName,"_READ_").concat(i.permissionLevel.toUpperCase()),l,i.RolePermissionId,s.tableName,"READ")}),isReadOnly:!0,style:{justifyContent:"center",border:"none",userSelect:"none"}},{custom:(e,l)=>d.createElement(W,{icon:o.permissionLevel,onClick:()=>f&&t.toggleTablePermission("TABLE_".concat(s.tableName,"_UPDATE_").concat(o.permissionLevel.toUpperCase()),l,o.RolePermissionId,s.tableName,"UPDATE")}),isReadOnly:!0,style:{justifyContent:"center",border:"none",userSelect:"none"}},{custom:(e,l)=>d.createElement(W,{icon:c.permissionLevel,onClick:()=>f&&t.toggleTablePermission("TABLE_".concat(s.tableName,"_DELETE_").concat(c.permissionLevel.toUpperCase()),l,c.RolePermissionId,s.tableName,"DELETE")}),isReadOnly:!0,style:{justifyContent:"center",border:"none",userSelect:"none"}},{custom:(e,l)=>d.createElement(W,{icon:m.permissionLevel,onClick:()=>f&&t.toggleTablePermission("TABLE_".concat(s.tableName,"_ASSIGN_").concat(m.permissionLevel.toUpperCase()),l,m.RolePermissionId,s.tableName,"ASSIGN")}),isReadOnly:!0,style:{justifyContent:"center",border:"none",userSelect:"none"}},{custom:(e,l)=>d.createElement(W,{icon:u.permissionLevel,onClick:()=>{var e;return f&&t.toggleBinaryPermission(l,"TABLE_".concat(s.tableName,"_IMPORT"),null!=(e=u.RolePermissionId)?e:"","none"!==u.permissionLevel)}}),isReadOnly:!0,style:{justifyContent:"center",border:"none",userSelect:"none"}},{custom:(e,l)=>d.createElement(W,{icon:p.permissionLevel,onClick:()=>{var e;return f&&t.toggleBinaryPermission(l,"TABLE_".concat(s.tableName,"_EXPORT"),null!=(e=p.RolePermissionId)?e:"","none"!==p.permissionLevel)}}),isReadOnly:!0,style:{justifyContent:"center",border:"none",userSelect:"none"}}]};r.push(E)}t.setRows(r)})(e.state.rolePermissions,e.state.tables)},[e.state.rolePermissions,e.state.tables]),d.createElement(ee,{rows:t.rows,columnWidths:[300,100,100,100,100,100,100,100],snapRows:1,snapColumns:1,editable:!1,style:{borderBottomRightRadius:"0.2rem"},styletr:{borderTopRightRadius:"0.2rem"},styletl:{borderTopLeftRadius:"0.2rem"},stylebl:{borderBottomLeftRadius:"0.2rem"}})},en=e=>{let t=el(e);return(0,d.useEffect)(()=>{(()=>{let l=[];l.push({columns:[{value:"Permission Name",isReadOnly:!0},{value:"Access",isReadOnly:!0,style:{justifyContent:"center"}}]});let a=e.roleId!==et;for(let n of e.state.allPermissions){if("System"===n.Tag)continue;let r="",s=!1;for(let t of e.state.rolePermissions)if(t.PermissionId===n.PermissionId){r=t.RolePermissionId,s=!0;break}let i={columns:[{value:n.Name,isReadOnly:!0,style:{border:"none"}},{custom:(e,l)=>d.createElement(W,{icon:r?"system":"none",onClick:()=>a&&t.toggleBinaryPermission(l,n.Name,r,s)}),style:{justifyContent:"center",border:"none",userSelect:"none"}}]};l.push(i)}t.setRows(l)})()},[]),d.createElement(ee,{rows:t.rows,columnWidths:[300,150],snapColumns:1,snapRows:1,editable:!1,style:{borderBottomRightRadius:"0.2rem"},styletr:{borderTopRightRadius:"0.2rem"},styletl:{borderTopLeftRadius:"0.2rem"},stylebl:{borderBottomLeftRadius:"0.2rem"}})},er=e=>{let t=el(e);return(0,d.useEffect)(()=>{(()=>{let l=[];l.push({columns:[{value:"Permission Name",isReadOnly:!0},{value:"Access",isReadOnly:!0,style:{justifyContent:"center"}}]});let a=e.roleId!==et;for(let n of e.state.allPermissions){if("System"!==n.Tag||!n.Name.startsWith("JOB_"))continue;let r="",s=!1;for(let t of e.state.rolePermissions)if(t.PermissionId===n.PermissionId){r=t.RolePermissionId,s=!0;break}let i={columns:[{value:n.Name,isReadOnly:!0,style:{border:"none"}},{custom:(e,l)=>d.createElement(W,{icon:r?"system":"none",onClick:()=>a&&t.toggleBinaryPermission(l,n.Name,r,s)}),style:{justifyContent:"center",border:"none",userSelect:"none"}}]};l.push(i)}t.setRows(l)})()},[]),d.createElement(ee,{rows:t.rows,columnWidths:[300,150],snapColumns:1,snapRows:1,editable:!1,style:{borderBottomRightRadius:"0.2rem"},styletr:{borderTopRightRadius:"0.2rem"},styletl:{borderTopLeftRadius:"0.2rem"},stylebl:{borderBottomLeftRadius:"0.2rem"}})},es=e=>{let t=el(e);return(0,d.useEffect)(()=>{(()=>{let l=[];l.push({columns:[{value:"Permission Name",isReadOnly:!0},{value:"Access",isReadOnly:!0,style:{justifyContent:"center"}}]});let a=e.roleId!==et;for(let n of e.state.allPermissions){if("System"!==n.Tag||n.Name.startsWith("TABLE_")||n.Name.startsWith("JOB_")||!(n.Name.startsWith("ACTION_ADMIN")||n.Name.startsWith("ACTION_TABLE")||n.Name.startsWith("ACCESS_ADMIN")))continue;let r="",s=!1;for(let t of e.state.rolePermissions)if(t.PermissionId===n.PermissionId){r=t.RolePermissionId,s=!0;break}let i={columns:[{value:n.Name,isReadOnly:!0,style:{border:"none"}},{custom:(e,l)=>d.createElement(W,{icon:r?"system":"none",onClick:()=>a&&t.toggleBinaryPermission(l,n.Name,r,s)}),style:{justifyContent:"center",border:"none",userSelect:"none"}}]};l.push(i)}t.setRows(l)})()},[]),d.createElement(ee,{rows:t.rows,columnWidths:[300,150],snapColumns:1,snapRows:1,editable:!1,style:{borderBottomRightRadius:"0.2rem"},styletr:{borderTopRightRadius:"0.2rem"},styletl:{borderTopLeftRadius:"0.2rem"},stylebl:{borderBottomLeftRadius:"0.2rem"}})},ei=e=>{let t=el(e);return(0,d.useEffect)(()=>{(()=>{let l=[];l.push({columns:[{value:"Permission Name",isReadOnly:!0},{value:"Access",isReadOnly:!0,style:{justifyContent:"center"}}]});let a=e.roleId!==et;for(let n of e.state.allPermissions){if("System"!==n.Tag||n.Name.startsWith("ACTION_ADMIN")||n.Name.startsWith("ACTION_TABLE")||n.Name.startsWith("ACCESS_ADMIN")||!n.Name.startsWith("ACTION_"))continue;let r="",s=!1;for(let t of e.state.rolePermissions)if(t.PermissionId===n.PermissionId){r=t.RolePermissionId,s=!0;break}let i={columns:[{value:n.Name,isReadOnly:!0,style:{border:"none"}},{custom:(e,l)=>d.createElement(W,{icon:r?"system":"none",onClick:()=>a&&t.toggleBinaryPermission(l,n.Name,r,s)}),style:{justifyContent:"center",border:"none",userSelect:"none"}}]};l.push(i)}t.setRows(l)})()},[]),d.createElement(ee,{rows:t.rows,columnWidths:[300,150],snapColumns:1,snapRows:1,editable:!1,style:{borderBottomRightRadius:"0.2rem"},styletr:{borderTopRightRadius:"0.2rem"},styletl:{borderTopLeftRadius:"0.2rem"},stylebl:{borderBottomLeftRadius:"0.2rem"}})},eo=e=>{let t=el(e);return(0,d.useEffect)(()=>{(()=>{let l=[];l.push({columns:[{value:"Hub Name",isReadOnly:!0},{value:"Access",isReadOnly:!0,style:{justifyContent:"center"}}]});let a=e.roleId!==et;for(let n of e.state.allPermissions){if(!n.Name.startsWith("HUB_"))continue;let r="",s=!1;for(let t of e.state.rolePermissions)if(t.PermissionId===n.PermissionId){r=t.RolePermissionId,s=!0;break}let i={columns:[{value:n.Name,isReadOnly:!0,style:{border:"none"}},{custom:(e,l)=>d.createElement(W,{icon:r?"system":"none",onClick:()=>a&&t.toggleBinaryPermission(l,n.Name,r,s)}),style:{justifyContent:"center",border:"none",userSelect:"none"}}]};l.push(i)}t.setRows(l)})()},[]),d.createElement(ee,{rows:t.rows,columnWidths:[300,150],snapColumns:1,snapRows:1,editable:!1,style:{borderBottomRightRadius:"0.2rem"},styletr:{borderTopRightRadius:"0.2rem"},styletl:{borderTopLeftRadius:"0.2rem"},stylebl:{borderBottomLeftRadius:"0.2rem"}})},ed=e=>{let t=(0,n.A)(),[l,a]=d.useState(!0),[s,i]=(0,d.useState)({tables:[],allPermissions:[],rolePermissions:[],createRolePermissions:[],updateRolePermissions:[],deleteRolePermissions:[],isLoaded:!1}),[o,c]=(0,d.useState)("entities"),m=async()=>{if(null==e.roleId)return void a(!1);let l=await t.tables();if(!l.succeeded)return;let n=new j.XK(["*"]).top(999999).from("Permission").orderBy("Name","asc").distinct().toReadRequest(),r=await t.read(n),s=new j.XK(["*"]).top(999999).from("RolePermission").where("RoleId","==",e.roleId).distinct().toReadRequest(),o=await t.read(s);o.succeeded&&(i(e=>({...e,tables:l.data,allPermissions:r.data.results,rolePermissions:o.data.results,isLoaded:!0})),a(!1))},u=(0,d.useCallback)(async()=>{let e=s.createRolePermissions.map(e=>({tableName:"RolePermission",fields:{PermissionId:e.PermissionId,RoleId:e.RoleId}})),l=s.updateRolePermissions.map(e=>({tableName:"RolePermission",fields:e})),n=s.deleteRolePermissions.map(e=>({tableName:"RolePermission",fields:e}));return 0===e.length&&0===l.length&&0===n.length?{continue:!0}:(a(!0),(await t.bulk({creates:e,updates:l,deletes:n})).succeeded)?(a(!1),{continue:!0}):(a(!1),{continue:!1})},[s.deleteRolePermissions,s.createRolePermissions,s.updateRolePermissions]);return(0,d.useEffect)(()=>{m()},[]),e.formBuilder.onPreSaveRef.current=u,d.createElement("div",{className:"w-full flex flex-col gap-4"},d.createElement(V.A,{name:"Name"}),d.createElement("div",{className:"w-full h-[500px] relative"},l&&d.createElement("div",{className:"w-full h-full absolute flex justify-center items-center"},d.createElement(r.a,null)),null==e.roleId&&d.createElement("div",{className:"w-full h-full flex justify-center items-center"},"Save the role to set permissions"),null!=e.roleId&&s.isLoaded&&d.createElement(d.Fragment,null,d.createElement(z.t,{defaultValue:"entities",className:"h-full flex flex-col",onChange:c},d.createElement(z.t.List,null,d.createElement(z.t.Tab,{value:"entities"},"Entities"),d.createElement(z.t.Tab,{value:"actions"},"Actions"),d.createElement(z.t.Tab,{value:"jobs"},"Jobs"),d.createElement(z.t.Tab,{value:"hubs"},"Hubs"),d.createElement(z.t.Tab,{value:"system"},"System"),d.createElement(z.t.Tab,{value:"permissions"},"Custom Permissions")),d.createElement(z.t.Panel,{value:"entities",pt:"xs",className:"h-full"},d.createElement("div",{className:"w-full h-full"},d.createElement(ea,{roleId:e.roleId,state:s,setState:i}))),d.createElement(z.t.Panel,{value:"actions",pt:"xs",className:"h-full"},d.createElement("div",{className:"w-full h-full"},d.createElement(ei,{roleId:e.roleId,state:s,setState:i}))),d.createElement(z.t.Panel,{value:"permissions",pt:"xs",className:"h-full"},d.createElement("div",{className:"w-full h-full"},d.createElement(en,{roleId:e.roleId,state:s,setState:i}))),d.createElement(z.t.Panel,{value:"jobs",pt:"xs",className:"h-full"},d.createElement("div",{className:"w-full h-full"},d.createElement(er,{roleId:e.roleId,state:s,setState:i}))),d.createElement(z.t.Panel,{value:"hubs",pt:"xs",className:"h-full"},d.createElement("div",{className:"w-full h-full"},d.createElement(eo,{roleId:e.roleId,state:s,setState:i}))),d.createElement(z.t.Panel,{value:"system",pt:"xs",className:"h-full"},d.createElement("div",{className:"w-full h-full"},d.createElement(es,{roleId:e.roleId,state:s,setState:i})))))),d.createElement("div",{className:"flex justify-between"},d.createElement("div",{className:"flex gap-5 w-full"},null!=e.roleId&&null!=o&&"entities"===o&&d.createElement(d.Fragment,null,d.createElement("span",{className:"flex text-sm gap-1 items-center"},d.createElement(W,{icon:"none"}),"None"),d.createElement("span",{className:"flex text-sm gap-1 items-center"},d.createElement(W,{icon:"user"}),"User"),d.createElement("span",{className:"flex text-sm gap-1 items-center"},d.createElement(W,{icon:"team"}),"Team"),d.createElement("span",{className:"flex text-sm gap-1 items-center"},d.createElement(W,{icon:"system"}),"System")),null!=e.roleId&&null!=o&&("permissions"===o||"system"===o||"hubs"===o)&&d.createElement(d.Fragment,null,d.createElement("span",{className:"flex text-sm gap-1 items-center whitespace-nowrap"},d.createElement(W,{icon:"none"}),"Doesn't have permission"),d.createElement("span",{className:"flex text-sm gap-1 items-center whitespace-nowrap"},d.createElement(W,{icon:"system"}),"Has permission")),null!=e.roleId&&null!=o&&"actions"===o&&d.createElement(d.Fragment,null,d.createElement("span",{className:"flex text-sm gap-1 items-center whitespace-nowrap"},d.createElement(W,{icon:"none"}),"Can't execute action"),d.createElement("span",{className:"flex text-sm gap-1 items-center whitespace-nowrap"},d.createElement(W,{icon:"system"}),"Can execute action")),null!=e.roleId&&null!=o&&"jobs"===o&&d.createElement(d.Fragment,null,d.createElement("span",{className:"flex text-sm gap-1 items-center whitespace-nowrap"},d.createElement(W,{icon:"none"}),"Can't start job"),d.createElement("span",{className:"flex text-sm gap-1 items-center whitespace-nowrap"},d.createElement(W,{icon:"system"}),"Can start job")),"UPDATE"===e.formBuilder.operation&&d.createElement("div",{className:"w-full flex justify-start items-center pr-2"},d.createElement(L,{value:e.formBuilder.data["".concat(e.formBuilder.tableName,"Id")]}))),d.createElement("div",null,d.createElement(H.A,null))))},ec=()=>{var e,t,l,a,n;let r=A();return d.createElement(d.Fragment,null,r.tables.filter(e=>["User","Role","Team","Permission"].includes(e.tableName)).length>0&&!(null==(e=r.props.hiddenMenuItems)?void 0:e.includes("Security"))&&d.createElement(T.k,{label:"Security",leftSection:d.createElement(P.A,{size:16,strokeWidth:2,color:r.color})},r.tables.find(e=>"User"===e.tableName)&&!(null==(t=r.props.hiddenMenuItems)?void 0:t.includes("Users"))&&d.createElement(T.k,{label:"Users",onClick:()=>r.setActiveComponent({component:d.createElement("div",{className:"w-full h-full flex flex-col"},d.createElement("div",{className:"grow h-1"},d.createElement(D,{tableName:"User",maxResults:100,formMaxWidth:72,formAppendButton:e=>d.createElement(d.Fragment,null,"UPDATE"===e.operation&&d.createElement("div",{className:"w-full flex justify-start items-center gap-1"},d.createElement(L,{value:e.data["".concat(e.tableName,"Id")]}))),appendCustomForm:e=>void 0===e.snapshot?d.createElement(d.Fragment,null):d.createElement("div",{className:" h-96 mt-5 flex justify-stretch gap-4"},d.createElement(D,{title:"Roles",tableName:"UserRole",fields:["RoleId"],filters:[{field:"UserId",value:e.snapshot.UserId}],formZIndex:1e3,formFields:["RoleId"],formFieldDefaults:[{field:"UserId",value:e.snapshot.UserId}],formLookupQueries:[{field:"RoleId",except:[{fromField:"RoleId",query:{tableName:"UserRole",fields:["RoleId"],filters:[{field:"UserId",operator:"==",value:e.snapshot.UserId}]}}]}]}),d.createElement(D,{title:"Teams",tableName:"TeamUser",fields:["TeamId"],filters:[{field:"UserId",value:e.snapshot.UserId}],formZIndex:1e3,formFields:["TeamId"],formFieldDefaults:[{field:"UserId",value:e.snapshot.UserId}],formLookupQueries:[{field:"TeamId",except:[{fromField:"TeamId",query:{tableName:"TeamUser",fields:["TeamId"],filters:[{field:"UserId",operator:"==",value:e.snapshot.UserId}]}}]}]}))})))}),leftSection:d.createElement(O.A,{size:16,strokeWidth:2,color:r.color})}),r.tables.find(e=>"Team"===e.tableName)&&!(null==(l=r.props.hiddenMenuItems)?void 0:l.includes("Teams"))&&d.createElement(T.k,{label:"Teams",onClick:()=>r.setActiveComponent({component:d.createElement("div",{className:"w-full h-full flex flex-col"},d.createElement("div",{className:"grow h-1"},d.createElement(D,{tableName:"Team",formCloseOnCreate:!1,maxResults:100,formMaxWidth:72,formAppendButton:e=>d.createElement(d.Fragment,null,"UPDATE"===e.operation&&d.createElement("div",{className:"w-full flex justify-start items-center gap-1"},d.createElement(L,{value:e.data["".concat(e.tableName,"Id")]}))),appendCustomForm:e=>void 0===e.snapshot?d.createElement(d.Fragment,null):d.createElement("div",{className:" h-96 mt-5 flex justify-stretch gap-4"},d.createElement(D,{title:"Roles",tableName:"TeamRole",fields:["RoleId"],filters:[{field:"TeamId",value:e.snapshot.TeamId}],formZIndex:1e3,formFields:["RoleId"],formFieldDefaults:[{field:"TeamId",value:e.snapshot.TeamId}],formLookupQueries:[{field:"RoleId",except:[{fromField:"RoleId",query:{tableName:"TeamRole",fields:["RoleId"],filters:[{field:"TeamId",operator:"==",value:e.snapshot.TeamId}]}}]}]}),d.createElement(D,{title:"Users",tableName:"TeamUser",fields:["UserId"],filters:[{field:"TeamId",value:e.snapshot.TeamId}],formZIndex:1e3,formFields:["UserId"],formFieldDefaults:[{field:"TeamId",value:e.snapshot.TeamId}],formLookupQueries:[{field:"UserId",except:[{fromField:"UserId",query:{tableName:"TeamUser",fields:["UserId"],filters:[{field:"TeamId",operator:"==",value:e.snapshot.TeamId}]}}]}]}))})))}),leftSection:d.createElement(M.A,{size:16,strokeWidth:2,color:r.color})}),r.tables.find(e=>"Role"===e.tableName)&&!(null==(a=r.props.hiddenMenuItems)?void 0:a.includes("Roles"))&&d.createElement(T.k,{label:"Roles",onClick:()=>{r.setActiveComponent({component:d.createElement(D,{tableName:"Role",formMaxWidth:72,maxResults:100,formCloseOnCreate:!1,customForm:e=>{var t,l;return d.createElement(ed,{key:null==(t=e.snapshot)?void 0:t.RoleId,roleId:null==(l=e.snapshot)?void 0:l.RoleId,formBuilder:e})}})})},leftSection:d.createElement(U.A,{size:16,strokeWidth:2,color:r.color})}),r.tables.find(e=>"Permission"===e.tableName)&&!(null==(n=r.props.hiddenMenuItems)?void 0:n.includes("Permissions"))&&d.createElement(T.k,{label:"Permissions",onClick:()=>r.setActiveComponent({component:d.createElement("div",{className:"w-full h-full flex flex-col"},d.createElement("div",{className:"grow h-1"},d.createElement(D,{tableName:"Permission",fields:["Name"],filters:[{field:"Tag",operator:"!=",value:"System"}],formFields:["Name"],formCloseOnCreate:!0,formMaxWidth:36,maxResults:100,formAppendButton:e=>d.createElement(d.Fragment,null,"UPDATE"===e.operation&&d.createElement("div",{className:"w-full flex justify-start items-center gap-1"},d.createElement(L,{value:e.data["".concat(e.tableName,"Id")]})))})))}),leftSection:d.createElement(E.A,{size:16,strokeWidth:2,color:r.color})})))};var em=l(8019);let eu=()=>{var e;let t=A();return d.createElement(d.Fragment,null,t.tables.filter(e=>"Option"===e.tableName).length>0&&!(null==(e=t.props.hiddenMenuItems)?void 0:e.includes("Options"))&&d.createElement(T.k,{label:"Options",leftSection:d.createElement(em.A,{size:16,strokeWidth:2,color:t.color}),onClick:()=>t.setActiveComponent({component:d.createElement(D,{tableName:"Option",maxResults:100,formAppendButton:e=>d.createElement(d.Fragment,null,"UPDATE"===e.operation&&d.createElement("div",{className:"w-full flex justify-start items-center gap-1"},d.createElement(L,{value:e.data["".concat(e.tableName,"Id")]})))})})}))};var ep=l(9639),ef=l(6394),eE=l(7848);let eh=e=>{var t,l,a,r;let s=(0,n.A)();(0,d.useRef)(null);let[i,c]=(0,d.useState)(!1);(0,d.useState)(!1);let m=async()=>{var t;c(!0),e.formBuilder.dispatch({type:"SET_FIELD_VALUE",payload:{field:"Status",value:"Running"}}),await s.action("ADMIN_TriggerJob",{jobName:null==(t=e.formBuilder.snapshot)?void 0:t.Name}),c(!1)};return null==e.formBuilder.snapshot||(null==(t=e.formBuilder.snapshot)?void 0:t.Name)==null||(null==(l=e.formBuilder.snapshot)?void 0:l.name)===""||(null==(a=e.formBuilder.snapshot)?void 0:a._ui_info_)==null?d.createElement(d.Fragment,null):(null==(r=e.formBuilder.snapshot)?void 0:r._ui_info_.canTrigger)===!0?d.createElement(o.$,{variant:"outline",onClick:m,loading:i},"Run Job"):d.createElement(d.Fragment,null)};var ev=l(2038),ey=l(1054),eg=l(9050),eb=l(7544),eN=l(8846),eI=l(3576),ew=l(3470);let eC=e=>{let{log:t}=e,[l,a]=d.useState(!1);return d.createElement(d.Fragment,null,d.createElement("span",{className:"w-full flex justify-start cursor-pointer items-start",onClick:()=>a(e=>!e)},d.createElement("div",{className:"w-60 flex-shrink-0 flex justify-between items-center"},d.createElement(eI.E,{size:"sm"},(0,ew.ki)(t.Timestamp)),"Warning"==t.Level&&d.createElement("div",{className:" bg-yellow-500 rounded-full h-3 w-3 mr-4"}),"Error"==t.Level&&d.createElement("div",{className:"bg-red-500 rounded-full h-3 w-3 mr-4"}),"Critical"==t.Level&&d.createElement("div",{className:"flex justify-center items-center mr-4 text-red-500"},d.createElement("div",{className:"bg-red-500 animate-pulse rounded-full h-3 w-3"}),"!")),d.createElement("div",{className:"flex-1 min-w-0"},d.createElement(eI.E,{size:"sm",className:"break-words whitespace-pre-wrap"},t.Message))),l&&d.createElement("div",{className:"w-full"},d.createElement("div",{className:"w-full flex justify-start my-1"},d.createElement("div",{className:"w-60 flex-shrink-0"}),t.Properties&&d.createElement("div",{className:"flex-1 min-w-0"},Object.entries(t.Properties).map(e=>{let[t,l]=e;return d.createElement("div",{key:t},d.createElement(eI.E,{size:"sm",className:"break-words"},d.createElement("strong",null,t,":")," ",JSON.stringify(l)))}))),(t.Exception||t.StackTrace)&&d.createElement(d.Fragment,null,d.createElement("div",{className:"w-full flex justify-start my-1"},d.createElement("div",{className:"w-60 flex-shrink-0"}),d.createElement(eI.E,{size:"sm",className:"break-words whitespace-pre-wrap"},t.Exception)))))};var ex=l(6417),eA=l(4311),eT=l(1491),eS=l(7719);let eR=e=>{var t;let l=(0,eb.Us)(),a=d.useRef(!0),[n,s]=(0,d.useState)(!0),[i,c]=(0,d.useState)([]),[m,u]=(0,d.useState)(null==(t=e.isLive)||t),[p,E]=(0,d.useState)(""),[h,v]=(0,d.useState)(""),[y,g]=(0,d.useState)([null,null]),[b,N]=(0,d.useState)({all:!0,Critical:!1,Error:!1,Warning:!1,Information:!1,Debug:!1}),I=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b;s(!0),c([]);let a=await l.signalR(),n=t.all?["Critical","Error","Warning","Information","Debug"]:Object.entries(t).filter(e=>{let[t,l]=e;return l&&"all"!==t}).map(e=>{let[t]=e;return t}),r=await a.invoke("Logging",JSON.stringify({Type:"initial_load",Message:"",Levels:n,Search:p,UserId:h,StartDate:y[0],EndDate:y[1],JobHistoryId:e.jobHistoryId}));c(null!=r?r:[]),s(!1)},w=(e,t)=>{let l={...b};N(l="all"===e?{all:t,Critical:!1,Error:!1,Warning:!1,Information:!1,Debug:!1}:{...l,all:!1,[e]:t}),I(l)};return(0,d.useEffect)(()=>{let e,t=async()=>{if(console.log("Initializing log viewer"),!m&&a.current&&await I(),m){await I();let t=await l.signalR();t.on("Log",e=>{c(t=>[e,...t].slice(0,250))}),e=()=>t.off("Log")}a.current=!1};return l.signalR(),l.signalRState===eN.j.Connected&&t(),()=>{null==e||e()}},[l.signalRState,m]),d.createElement("form",{onSubmit:e=>{e.preventDefault(),I()},className:"relative w-full h-full flex flex-col gap-2"},d.createElement("div",{className:"w-full items-end flex gap-1"},d.createElement("div",{className:"grow mr-1"},d.createElement(ep.x,{gutter:"xs"},d.createElement(ep.x.Col,{span:5},d.createElement(ev.k,{label:"Search",value:p,onChange:e=>E(e.currentTarget.value)})),d.createElement(ep.x.Col,{span:4},d.createElement(ev.k,{label:"UserId",value:h,onChange:e=>v(e.currentTarget.value)})),d.createElement(ep.x.Col,{span:3},d.createElement(eS.t,{type:"range",label:"Date Range",placeholder:"Pick dates range",clearable:!0,value:y,onChange:g})))),d.createElement("div",{className:m?"hidden":"block"},d.createElement($.m,{label:"Go"},d.createElement(o.$,{type:"submit",variant:"outline"},d.createElement(ex.A,{size:12})))),d.createElement("div",{className:m?"block":"hidden"},d.createElement($.m,{label:"Stop"},d.createElement(o.$,{variant:"outline",color:"red",onClick:e=>{m&&(e.preventDefault(),u(!1))}},d.createElement(eA.A,{size:12})))),d.createElement($.m,{label:"Live"},d.createElement(o.$,{variant:m?"filled":"outline",onClick:()=>u(!0)},d.createElement(eT.A,{size:16})))),d.createElement("div",{className:"flex gap-6"},d.createElement(f.S,{label:"All",checked:b.all,onChange:e=>w("all",e.currentTarget.checked)}),d.createElement(f.S,{label:"Critical",checked:b.Critical,onChange:e=>w("Critical",e.currentTarget.checked)}),d.createElement(f.S,{label:"Error",checked:b.Error,onChange:e=>w("Error",e.currentTarget.checked)}),d.createElement(f.S,{label:"Warning",checked:b.Warning,onChange:e=>w("Warning",e.currentTarget.checked)}),d.createElement(f.S,{label:"Information",checked:b.Information,onChange:e=>w("Information",e.currentTarget.checked)}),d.createElement(f.S,{label:"Debug",checked:b.Debug,onChange:e=>w("Debug",e.currentTarget.checked)})),d.createElement(ey.t,{styles:{root:{flexGrow:1,overflowY:"scroll",position:"relative"}},withBorder:!0},n&&d.createElement("div",{className:"absolute w-full h-full flex justify-center items-center"},d.createElement(r.a,null)),d.createElement(eg.a,{p:"xs"},i.map(e=>d.createElement(eC,{key:e.LogId,log:e})))))},eD=()=>{var e;let t=A();return d.createElement(d.Fragment,null,t.tables.filter(e=>"Job"===e.tableName).length>0&&!(null==(e=t.props.hiddenMenuItems)?void 0:e.includes("Jobs"))&&d.createElement(T.k,{label:"Jobs",leftSection:d.createElement(eE.A,{size:16,strokeWidth:2,color:t.color}),onClick:()=>t.setActiveComponent({component:d.createElement(D,{tableName:"Job",orderBy:[{field:"Name",order:"asc"}],fields:["Name","Queue","IsActive","LastExecution"],filters:[{field:"Tag",operator:"!=",value:"System"}],canCreate:!1,canDelete:!1,formCloseOnEscape:!0,customForm:e=>d.createElement(d.Fragment,null,d.createElement(ep.x,null,d.createElement(ep.x.Col,{span:4},d.createElement(V.A,{name:"Name"})),d.createElement(ep.x.Col,{span:4},d.createElement(V.A,{name:"Queue"})),d.createElement(ep.x.Col,{span:4},d.createElement(V.A,{name:"LastExecution"}))),d.createElement(ep.x,null,d.createElement(ep.x.Col,{span:4},d.createElement(V.A,{name:"IsActive"})),d.createElement(ep.x.Col,{span:4}),d.createElement(ep.x.Col,{span:4}))),appendCustomForm:e=>{var t;return"CREATE"===e.operation&&d.Fragment,d.createElement(d.Fragment,null,d.createElement("div",{className:"w-full h-96 mt-4"},d.createElement(D,{title:"History",tableName:"JobHistory",fields:["ServerName","Status","Message","CreatedDate","CompletedDate"],filters:[{field:"JobId",value:null==(t=e.snapshot)?void 0:t.JobId}],orderBy:[{field:"CreatedDate",order:"desc"}],maxResults:100,canUpdate:!1,canCreate:!1,formFullScreen:!0,refreshInterval:1e3,formClassNames:"h-full flex grow",customForm:e=>{var t;return d.createElement("div",{className:"w-full flex flex-col gap-2"},d.createElement(ep.x,null,d.createElement(ep.x.Col,{span:2.4},d.createElement(V.A,{name:"Name"})),d.createElement(ep.x.Col,{span:2.4},d.createElement(V.A,{name:"JobId"})),d.createElement(ep.x.Col,{span:2.4},d.createElement(V.A,{name:"Status"})),d.createElement(ep.x.Col,{span:2.4},d.createElement(V.A,{name:"CreatedDate"})),d.createElement(ep.x.Col,{span:2.4},d.createElement(V.A,{name:"CompletedDate"}))),d.createElement("div",{className:"w-full grow flex flex-col"},d.createElement(ef.L,{legend:"Logs",styles:{root:{flexGrow:1}}},d.createElement(eR,{jobHistoryId:null==(t=e.snapshot)?void 0:t.JobHistoryId}))))}})),d.createElement("div",{className:"w-full flex justify-between mt-3"},"UPDATE"===e.operation&&d.createElement("div",{className:"w-full flex justify-start items-center gap-1"},d.createElement(L,{value:e.data["".concat(e.tableName,"Id")]})),d.createElement("div",{className:"flex"},d.createElement("div",{className:"mr-2"},d.createElement(eh,{formBuilder:e})),d.createElement(H.A,null))))}})})}))};var ek=l(9391);let e_=()=>{var e;let t=A();return d.createElement(d.Fragment,null,t.tables.filter(e=>"Setting"===e.tableName).length>0&&!(null==(e=t.props.hiddenMenuItems)?void 0:e.includes("Settings"))&&d.createElement(T.k,{label:"Settings",leftSection:d.createElement(ek.A,{size:16,strokeWidth:2,color:t.color}),onClick:()=>t.setActiveComponent({component:d.createElement(D,{tableName:"Setting",maxResults:100,formAppendButton:e=>d.createElement(d.Fragment,null,"UPDATE"===e.operation&&d.createElement("div",{className:"w-full flex justify-start items-center gap-1"},d.createElement(L,{value:e.data["".concat(e.tableName,"Id")]})))})})}))};var eF=l(7786),eL=l(8150),eB=l(9583),eP=l(8728);let eO=e=>{var t,l;let a=(0,n.A)(),r=(0,d.useRef)(null),[s,i]=(0,d.useState)(!1),[o,c]=(0,d.useState)(!1),[m,u]=(0,d.useState)(!1),p=async e=>{var t;return!0===(await a.bulkUpdate(e.map(e=>({tableName:"AuditField",fields:{...e}})))).succeeded||(null==(t=r.current)||t.refresh(),!1)},E=async e=>{var t;return!0===(await a.update("AuditField",e)).succeeded||(null==(t=r.current)||t.refresh(),!1)};return d.createElement("div",{className:"w-full flex flex-col gap-4"},d.createElement(eL.F,{icon:d.createElement(eP.A,{size:"1rem"}),color:"yellow"},"In a multi-server environment, audit configuration changes may take up to one minute to propagate."),(null==(t=e.formBuilder.snapshot)?void 0:t.IsTable)&&d.createElement(ep.x,null,d.createElement(ep.x.Col,{span:4},d.createElement(V.A,{name:"Name"})),d.createElement(ep.x.Col,{span:2},d.createElement(V.A,{name:"IsCreate"})),d.createElement(ep.x.Col,{span:2},d.createElement(V.A,{name:"IsRead"})),d.createElement(ep.x.Col,{span:2},d.createElement(V.A,{name:"IsUpdate"})),d.createElement(ep.x.Col,{span:2},d.createElement(V.A,{name:"IsDelete"}))),d.createElement("div",{className:"w-full h-[550px]"},d.createElement(eB.default,{tableName:"AuditField",columnWidths:["100%","130px","130px","130px"],additionalFields:["IsCreate","IsUpdate","IsDelete"],canDelete:!1,fields:["Name",{header:e=>d.createElement("div",null,d.createElement(f.S,{label:"Create",checked:s,onChange:t=>{i(t.target.checked),e.setRecords(e=>{let l=e.map(e=>({...e,IsCreate:t.target.checked}));return p(l),l})}})),body:(e,t)=>d.createElement(f.S,{checked:e.IsCreate,onChange:l=>{t.setRecords(t=>{let a=t.map(t=>t.AuditFieldId===e.AuditFieldId?{...t,IsCreate:l.target.checked}:t);return a.filter(e=>e.IsCreate).length===t.length?i(!0):i(!1),E(a.find(t=>t.AuditFieldId===e.AuditFieldId)),a})}})},{header:e=>d.createElement("div",null,d.createElement(f.S,{label:"Update",checked:o,onChange:t=>{c(t.target.checked),e.setRecords(e=>{let l=e.map(e=>({...e,IsUpdate:t.target.checked}));return p(l),l})}})),body:(e,t)=>d.createElement(f.S,{checked:e.IsUpdate,onChange:l=>{t.setRecords(t=>{let a=t.map(t=>t.AuditFieldId===e.AuditFieldId?{...t,IsUpdate:l.target.checked}:t);return a.filter(e=>e.IsUpdate).length===t.length?c(!0):c(!1),E(a.find(t=>t.AuditFieldId===e.AuditFieldId)),a})}})},{header:e=>d.createElement("div",null,d.createElement(f.S,{label:"Delete",checked:m,onChange:t=>{u(t.target.checked),e.setRecords(e=>{let l=e.map(e=>({...e,IsDelete:t.target.checked}));return p(l),l})}})),body:(e,t)=>d.createElement(f.S,{checked:e.IsDelete,onChange:l=>{t.setRecords(t=>{let a=t.map(t=>t.AuditFieldId===e.AuditFieldId?{...t,IsDelete:l.target.checked}:t);return a.filter(e=>e.IsDelete).length===t.length?u(!0):u(!1),E(a.find(t=>t.AuditFieldId===e.AuditFieldId)),a})}})}],maxResults:99999,onRowClick:e=>!1,filters:[{field:"AuditId",operator:"==",value:null==(l=e.formBuilder.snapshot)?void 0:l.AuditId}],orderBy:[{field:"Name",order:"asc"}],onDataLoaded:e=>{(e=>{e.filter(e=>e.IsCreate).length===e.length?i(!0):i(!1),e.filter(e=>e.IsUpdate).length===e.length?c(!0):c(!1),e.filter(e=>e.IsDelete).length===e.length?u(!0):u(!1)})(e.results)}})),d.createElement("div",{className:"w-full flex justify-between"},"UPDATE"===e.formBuilder.operation&&d.createElement("div",{className:"w-full flex justify-start items-center gap-1"},d.createElement(L,{value:e.formBuilder.data["".concat(e.formBuilder.tableName,"Id")]})),d.createElement("div",null,d.createElement(H.A,null))))},eM=()=>d.createElement("div",{className:"w-full"},d.createElement(ep.x,null,d.createElement(ep.x.Col,{span:4},d.createElement(V.A,{name:"TableName"})),d.createElement(ep.x.Col,{span:4},d.createElement(V.A,{name:"FieldName"})),d.createElement(ep.x.Col,{span:4},d.createElement(V.A,{name:"FieldType"}))),d.createElement(ep.x,null,d.createElement(ep.x.Col,{span:4},d.createElement(V.A,{name:"OldValue"})),d.createElement(ep.x.Col,{span:4},d.createElement(V.A,{name:"NewValue"})),d.createElement(ep.x.Col,{span:4})),d.createElement(ep.x,null,d.createElement(ep.x.Col,{span:4},d.createElement(V.A,{name:"OldValueId"})),d.createElement(ep.x.Col,{span:4},d.createElement(V.A,{name:"NewValueId"})),d.createElement(ep.x.Col,{span:4}))),eU=e=>{var t,l,a,n,r,s,i;return(0,d.useEffect)(()=>{var t,l,a;if((null==(t=e.formBuilder.snapshot)?void 0:t.Operation)!=="Read")return;let n=JSON.stringify(JSON.parse(null==(l=e.formBuilder.snapshot)?void 0:l.Query),null,4),r=JSON.stringify(JSON.parse(null==(a=e.formBuilder.snapshot)?void 0:a.Results),null,4);e.formBuilder.setField("Query",n),e.formBuilder.setField("Results",r)},[null==(t=e.formBuilder.snapshot)?void 0:t.Query,null==(l=e.formBuilder.snapshot)?void 0:l.Results]),d.createElement("div",{className:"w-full flex flex-col gap-4"},d.createElement(ep.x,null,d.createElement(ep.x.Col,{span:4},d.createElement(V.A,{name:"TableName"})),d.createElement(ep.x.Col,{span:4},d.createElement(V.A,{name:"Operation"})),d.createElement(ep.x.Col,{span:4},d.createElement(V.A,{name:"CreatedDate"}))),d.createElement(ep.x,null,d.createElement(ep.x.Col,{span:4},d.createElement(V.A,{name:"UserId"})),d.createElement(ep.x.Col,{span:4},d.createElement(ev.k,{label:"UserId",value:null==(a=e.formBuilder.snapshot)?void 0:a.UserId,readOnly:!0}))),d.createElement(ep.x,null,(null==(n=e.formBuilder.snapshot)?void 0:n.Operation)!=="Read"&&d.createElement(d.Fragment,null,d.createElement(ep.x.Col,{span:4},d.createElement(V.A,{name:"Name"})),d.createElement(ep.x.Col,{span:4},d.createElement(V.A,{name:"EntityId"})))),(null==(r=e.formBuilder.snapshot)?void 0:r.Operation)==="Read"&&d.createElement(ep.x,null,d.createElement(ep.x.Col,{span:6},d.createElement("div",{className:"w-full h-[60vh]"},d.createElement(V.A,{name:"Query",varient:"textarea"}))),d.createElement(ep.x.Col,{span:6},d.createElement("div",{className:"w-full h-[60vh]"},d.createElement(V.A,{name:"Results",varient:"textarea"})))),(null==(s=e.formBuilder.snapshot)?void 0:s.Operation)!=="Read"&&d.createElement("div",{className:"w-full h-[500px] mt-2"},d.createElement(eB.default,{tableName:"AuditHistoryDetail",disabledMessage:null==e.formBuilder.snapshot?"Loading...":void 0,fields:["FieldName","TableName","OldValue","NewValue"],maxResults:100,orderBy:[{field:"FieldName",order:"ASC"}],filters:[{field:"AuditHistoryId",value:null==(i=e.formBuilder.snapshot)?void 0:i.AuditHistoryId}],canCreate:!1,canDelete:!1,canUpdate:!1,customForm:()=>d.createElement(eM,null)})),"UPDATE"===e.formBuilder.operation&&d.createElement("div",{className:"w-full flex justify-start items-center gap-1"},d.createElement(L,{value:e.formBuilder.data["".concat(e.formBuilder.tableName,"Id")]})))},eW=()=>{var e;let t=A();return d.createElement(d.Fragment,null,t.tables.filter(e=>"Option"===e.tableName).length>0&&!(null==(e=t.props.hiddenMenuItems)?void 0:e.includes("Options"))&&d.createElement(T.k,{label:"Audit",leftSection:d.createElement(eF.A,{size:16,strokeWidth:2,color:t.color}),onClick:()=>t.setActiveComponent({component:d.createElement(z.t,{defaultValue:"history",styles:{root:{display:"flex",flexDirection:"column",height:"100%",flexGrow:1},panel:{display:"flex",flexDirection:"column",flexGrow:1,height:1}}},d.createElement(z.t.List,null,d.createElement(z.t.Tab,{value:"history"},"History"),d.createElement(z.t.Tab,{value:"field-history"},"Field History"),d.createElement(z.t.Tab,{value:"config"},"Config")),d.createElement(z.t.Panel,{value:"history"},d.createElement("div",{className:"w-full h-full pt-4"},d.createElement(D,{tableName:"AuditHistory",fields:["Operation","TableName","User","Name","CreatedDate","EntityId"],columnWidths:["125px","100%","100%","100%","100%","100%"],title:"History",maxResults:100,canCreate:!1,orderBy:[{field:"CreatedDate",order:"desc"}],customForm:e=>d.createElement(eU,{formBuilder:e})}))),d.createElement(z.t.Panel,{value:"field-history"},d.createElement("div",{className:"w-full h-full pt-4"},d.createElement(D,{tableName:"AuditHistoryDetail",fields:["ah.Operation","ah.Name","ah.TableName","FieldName","OldValue","NewValue","ah.CreatedDate","ah.EntityId"],columnWidths:["125px","100%","100%","100%","100%","100%","100%","100px"],title:"Field History",maxResults:100,canCreate:!1,canUpdate:!1,canDelete:!1,joins:[{fromTable:"AuditHistoryDetail",fromField:"AuditHistoryId",toTable:"AuditHistory",toField:"AuditHistoryId",fields:["EntityId","TableName","Name","CreatedDate","Operation"],alias:"ah"}],orderBy:[{field:"ah.CreatedDate",order:"desc"}],customForm:e=>d.createElement(eM,null)}))),d.createElement(z.t.Panel,{value:"config"},d.createElement("div",{className:"w-full h-full pt-4"},d.createElement(D,{tableName:"Audit",title:"Audit",formTitle:"Audit",maxResults:100,orderBy:[{field:"Name",order:"asc"}],fields:["Name","IsCreate","IsRead","IsUpdate","IsDelete"],columnWidths:["350px","100%","100%","100%","100%"],canCreate:!1,canDelete:!1,formMaxWidth:55,formCloseOnEscape:!0,customForm:e=>d.createElement(eO,{formBuilder:e})}))))})}))};var ej=l(8981);let ez=()=>{var e;let t=A();return d.createElement(d.Fragment,null,t.tables.filter(e=>"Server"===e.tableName).length>0&&!(null==(e=t.props.hiddenMenuItems)?void 0:e.includes("Servers"))&&d.createElement(T.k,{label:"Servers",leftSection:d.createElement(ej.A,{size:16,strokeWidth:2,color:t.color}),onClick:()=>t.setActiveComponent({component:d.createElement(D,{tableName:"Server",orderBy:[{field:"Name",order:"ASC"}],maxResults:100,canDelete:!1,canCreate:!1,canUpdate:!1,refreshInterval:1e3,formAppendButton:e=>d.createElement(d.Fragment,null,"UPDATE"===e.operation&&d.createElement("div",{className:"w-full flex justify-start items-center gap-1"},d.createElement(L,{value:e.data["".concat(e.tableName,"Id")]})))})})}))};var eV=l(5950),eH=l(543);let eG=()=>{let e=(0,n.A)(),[t,l]=(0,d.useState)(""),a=async()=>{let t=await e.action("ADMIN_GetTypes");t.succeeded&&l(t.data)};return(0,d.useEffect)(()=>{a()},[]),d.createElement(eH.T,{styles:{root:{width:"100%",height:"100%"},input:{width:"100%",height:"100%"},wrapper:{width:"100%",height:"100%"}},readOnly:!0,value:t})},eq=()=>{var e;let t=A();return d.createElement(d.Fragment,null,!(null==(e=t.props.hiddenMenuItems)?void 0:e.includes("Development"))&&d.createElement(T.k,{label:"Development",leftSection:d.createElement(eV.A,{size:16,strokeWidth:2,color:t.color}),onClick:()=>t.setActiveComponent({component:d.createElement(z.t,{defaultValue:"types",styles:{root:{display:"flex",flexDirection:"column",height:"100%",flexGrow:1},panel:{display:"flex",flexDirection:"column",flexGrow:1,height:1}}},d.createElement(z.t.List,null,d.createElement(z.t.Tab,{value:"types"},"Types")),d.createElement(z.t.Panel,{value:"types"},d.createElement("div",{className:"w-full h-full pt-4"},d.createElement(eG,null))))})}))};var eK=l(8713);let eJ=()=>{var e;let t=A();return d.createElement(d.Fragment,null,!(null==(e=t.props.hiddenMenuItems)?void 0:e.includes("Logs"))&&d.createElement(T.k,{label:"Logs",leftSection:d.createElement(eK.A,{size:16,strokeWidth:2,color:t.color}),onClick:()=>t.setActiveComponent({component:d.createElement(eR,null)})}))},eX={tableName:"",appendCustomForm:void 0,formAppendButton:void 0,formMaxWidth:void 0,formCloseOnCreate:void 0,formTitle:void 0,fields:void 0,filters:void 0,formFields:void 0,formLookupQueries:void 0,orderBy:void 0,refreshInterval:void 0,canCreate:void 0,canDelete:void 0,maxResults:50},eY=e=>{var t;let l=(0,n.A)(),[a,{toggle:m}]=(0,c.j)(),[u,p]=d.useState(void 0),[f,E]=d.useState(void 0),[v,g]=d.useState([]),[b,N]=(0,c.j)(!1),[I,A]=(0,c.j)(!1),[T,S]=d.useState({canImport:!1,canExport:!1}),R=(0,C.A)().getIconColor(),D=async()=>{let e=await l.tables();!0===e.succeeded&&g(e.data)},k=async()=>{let e=l.hasAllPermissions(["ACCESS_ADMIN_DASHBOARD"]),t=l.hasAllPermissions(["ACCESS_ADMIN_DEVELOPMENT"]),[a,n]=await Promise.all([e,t]);if(!a)return void p({Dashboard:!1,Development:!1});p({Dashboard:a,Development:n});let r=!1,s=!1;await l.hasAllPermissions(["ACTION_ADMIN_ExportDependencies","ACTION_ADMIN_ExportData"])===!0&&(r=!0),await l.hasAllPermissions(["ACTION_ADMIN_ImportData"])&&(s=!0),S({canImport:s,canExport:r})};if((0,d.useEffect)(()=>{k(),D()},[]),(null==u?void 0:u.Dashboard)===void 0)return d.createElement("div",{className:"w-full h-full flex justify-center items-center"},d.createElement(r.a,null));if(!u.Dashboard)if(e.accessDeniedMessage)return d.createElement(d.Fragment,null,e.accessDeniedMessage);else return d.createElement("div",{className:"w-full h-full flex justify-center items-center"},"You don't have permission to view this page. Please contact your system administrator.");let _=null!=v.find(e=>"Log"===e.tableName),F=[{order:100,navLink:d.createElement(B,null)},{order:200,navLink:d.createElement(ec,null)},{order:300,navLink:d.createElement(eu,null)},{order:400,navLink:d.createElement(eW,null)},{order:600,navLink:d.createElement(eD,null)},{order:700,navLink:d.createElement(e_,null)},{order:800,navLink:d.createElement(ez,null)},..._?[{order:900,navLink:d.createElement(eJ,null)}]:[],...!0===u.Development?[{order:1e3,navLink:d.createElement(eq,null)}]:[]];void 0!==e.addMenuItems&&(F=F.concat(e.addMenuItems));let L=F.sort((e,t)=>e.order-t.order);return d.createElement(x.Provider,{value:{props:e,tables:v,color:R,setActiveComponent:E,emptyTableInfo:eX}},d.createElement(h,{opened:b,close:N.close}),d.createElement(y,{opened:I,close:A.close}),d.createElement(s.G,{padding:"md",header:{height:60},navbar:{width:300,breakpoint:"sm",collapsed:{mobile:!a}},styles:{navbar:{overflowY:"auto"}}},d.createElement(s.G.Header,null,d.createElement("div",{className:"w-full h-full flex items-center justify-between text-xl px-2"},d.createElement("div",{className:"flex pl-2"},d.createElement(i.w,{opened:a,onClick:m,hiddenFrom:"sm",size:"sm"}),null!=(t=e.title)?t:"Admin Dashboard"),d.createElement("div",{className:"flex items-center gap-2"},!e.forceHideToggleMode&&d.createElement(w,null),!0===T.canImport&&!e.forceHideImportData&&d.createElement(o.$,{variant:"outline",onClick:A.open},"Import Data"),!0===T.canExport&&!e.forceHideExportData&&d.createElement(o.$,{onClick:N.open},"Export Data")))),d.createElement(s.G.Navbar,{className:" p-2"},d.createElement("div",{className:"w-full h-full flex flex-col justify-between"},d.createElement("div",{className:" overflow-y-scroll"},L.map((e,t)=>d.createElement("span",{key:t},e.navLink))),e.userCard&&d.createElement("div",null,e.userCard))),d.createElement(s.G.Main,{styles:{main:{width:"100%",height:"100%",display:"flex",flexDirection:"column"}}},d.createElement("div",{className:"w-full h-1 grow"},null!=f?f.component:d.createElement(d.Fragment,null,_&&d.createElement(eR,null))))))};var e$=l(792),eQ=l(5953),eZ=l(6225),e0=l.n(eZ),e1=l(1922),e2=l(9781),e4=l(3142),e3=l(110);let e6=()=>{var e,t;let l=(0,e4.A)(),n=(0,e3.Id)();return l.isReady?l.isLoggedIn?(0,a.jsx)(eY,{addMenuItems:[{order:1e4,navLink:(0,a.jsx)(T.k,{label:"Logout",leftSection:(0,a.jsx)(e1.A,{size:16}),onClick:()=>{l.signOut(),e0().push("/")}})}],userCard:(0,a.jsxs)(eg.a,{children:[(0,a.jsx)(e$.c,{}),(0,a.jsx)(T.k,{label:(null==(t=n.firebaseAuth)||null==(e=t.currentUser)?void 0:e.email)||"User",leftSection:(0,a.jsx)(eQ.e,{size:"sm"}),rightSection:(0,a.jsx)(e2.A,{size:14,stroke:1.5}),onClick:()=>e0().push("/profile"),p:"md"})]}),accessDeniedMessage:(0,a.jsxs)("div",{className:"w-full h-full flex flex-col gap-2 justify-center items-center",children:["You don't have permission to view this page. Please contact your system administrator.",null!=n.firebaseApp&&(0,a.jsx)(o.$,{onClick:()=>{l.signOut(),e0().push("/")},children:"Logout"})]})}):(e0().push("/login"),(0,a.jsx)(a.Fragment,{})):(0,a.jsx)("div",{className:"w-full h-full flex justify-center items-center",children:(0,a.jsx)(r.a,{})})};function e5(){let e=(0,e3.Id)();return e.isLoading?(0,a.jsx)("div",{className:"w-full h-full flex justify-center items-center",children:(0,a.jsx)(r.a,{})}):e.isError?(0,a.jsx)(eY,{}):(0,a.jsx)(e6,{})}},2360:(e,t,l)=>{"use strict";l.d(t,{A:()=>s});var a=l(9967),n=l(5834),r=l(646);let s=e=>{let t=(0,r.xW)().formBuilder;return void 0!==t.snapshot&&!1===t.canUpdate||void 0===t.snapshot&&!1===t.canCreate?n.createElement(n.Fragment,null):n.createElement(a.$,{type:"submit",className:e.className,size:e.size,variant:e.varient},void 0!==e.label?e.label:"",void 0===e.label&&(void 0!==t.snapshot?"Update":"Create"))}},3470:(e,t,l)=>{"use strict";function a(e){return null!==e}function n(){return-(new Date().getTimezoneOffset()/60)}function r(e){let t=new Date(e),l=t.getDate(),a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],n=t.getFullYear(),r=t.getHours(),s=r>=12?"PM":"AM";r%=12,r=r||12;let i=t.getMinutes().toString().padStart(2,"0"),o=t.getSeconds().toString().padStart(2,"0"),d=t.getMilliseconds().toString().padStart(3,"0");return"".concat(l," ").concat(a," ").concat(n," ").concat(r,":").concat(i,":").concat(o,".").concat(d," ").concat(s)}function s(e){return null!=e&&!!["h","m","s","A","a","H","k","K","m","s","S","Z","X","LT","LTS","LLL","LLLL","lll","llll"].some(t=>e.includes(t))}l.d(t,{PS:()=>s,Pe:()=>a,ki:()=>r,qn:()=>n})},3742:(e,t,l)=>{"use strict";l.d(t,{A:()=>D});var a=l(5834),n=l(336),r=l(543),s=l(2038),i=l(4180),o=l(6313),d=l(646),c=l(191),m=l(4102),u=l(3576),p=l(304),f=l(8718),E=l(9254);let h=e=>{let{option:t,checked:l}=e;return a.createElement(m.Y,{flex:"1",gap:"xs"},a.createElement("div",null,a.createElement(u.E,{size:"sm"},t.label),a.createElement(u.E,{size:"xs",opacity:.65},t.description)))},v=(0,a.forwardRef)((e,t)=>{let l=(0,a.useRef)(null),n=(0,c.A)(),[r,s]=(0,a.useState)(!0),[i,o]=(0,a.useState)(!1),[d,m]=(0,a.useState)(void 0!==e.defaultLabelValue?e.defaultLabelValue:null),[u,v]=(0,a.useState)(void 0!==e.defaultLabelValue?[e.defaultLabelValue]:[]),[y,g]=a.useState(null),[b]=(0,f.o)(y,200,{leading:!0});(0,a.useImperativeHandle)(t,()=>l.current);let N=async()=>{var t,l,a,i,o,c,m;let u=[e.metaDataField.lookupTablePrimaryKeyField];null!=e.metaDataField.lookupTableNameField&&u.push(e.metaDataField.lookupTableNameField),null!=e.metaDataField.lookupTableDescriptionField&&u.push(e.metaDataField.lookupTableDescriptionField),""!==e.metaDataField.option&&u.push("Value");let p={tableName:e.metaDataField.lookupTable,maxResults:20,page:1,fields:u,orderBy:[...""!==e.metaDataField.option?[{field:"Order",order:"asc"}]:[],{field:null!=(o=e.metaDataField.lookupTableNameField)?o:e.metaDataField.lookupTablePrimaryKeyField,order:null==(t=e.query)?void 0:t.order}],filters:[r?{}:{logicalOperator:"OR",filters:[{field:null!=(c=e.metaDataField.lookupTableNameField)?c:e.metaDataField.lookupTablePrimaryKeyField,operator:"contains",value:null!=d&&d.label===b?"":b},...null!=e.metaDataField.lookupTableDescriptionField?[{field:e.metaDataField.lookupTableDescriptionField,operator:"contains",value:null!=d&&d.label===b?"":b}]:[{}]]},...e.metaDataField.lookupTableHasActiveField?[{field:"IsActive",operator:"==",value:"true"}]:[],...null!=(m=null==(l=e.query)?void 0:l.filters)?m:[],...""!==e.metaDataField.option?[{field:"Name",value:e.metaDataField.option}]:[]],joins:null==(a=e.query)?void 0:a.joins,except:null==(i=e.query)?void 0:i.except,..."OwningUserId"===e.metaDataField.name||"OwningTeamId"===e.metaDataField.name?{parameters:{isOwnerField:!0,tableName:e.owningTableName}}:{}},f=await n.read(p);if(!f||!f.succeeded)return;let E=f.data.results.map(t=>{var l,a;return{value:"".concat(t[e.metaDataField.lookupTablePrimaryKeyField]),label:(null!=(l=t[e.metaDataField.lookupTableNameField])?l:t[e.metaDataField.lookupTablePrimaryKeyField]).toString(),...null!=e.metaDataField.lookupTableDescriptionField?{description:"".concat(null!=(a=t[e.metaDataField.lookupTableDescriptionField])?a:"")}:{},...""!==e.metaDataField.option?{data:t.Value}:{}}});void 0!==e.excludeValues&&(E=E.filter(t=>{var l;return(null==(l=e.excludeValues)?void 0:l.find(e=>e===t.value))===void 0})),null!=d&&void 0===E.find(e=>e.value===(null==d?void 0:d.value))&&E.push(d),E=E.map(e=>(void 0===e.label&&(e.label=e.value),e)),r&&s(!1),v(E)},I=async t=>{var l;let a=[e.metaDataField.lookupTablePrimaryKeyField];e.metaDataField.lookupTableNameField&&a.push(e.metaDataField.lookupTableNameField),e.metaDataField.lookupTableDescriptionField&&a.push(e.metaDataField.lookupTableDescriptionField);let r=new E.XK(a).top(1).from(e.metaDataField.lookupTable).where(e.metaDataField.lookupTablePrimaryKeyField,"==",t).toReadRequest(),s=await n.read(r);if(!s||!s.succeeded)return;let i=s.data.results[0];if(null==i)return;let o={value:"".concat(i[e.metaDataField.lookupTablePrimaryKeyField]),label:(null!=(l=i[e.metaDataField.lookupTableNameField])?l:i[e.metaDataField.lookupTablePrimaryKeyField]).toString()};return null!=e.metaDataField.lookupTableDescriptionField&&(o.description=i[e.metaDataField.lookupTableDescriptionField]),o},w=async()=>{if(void 0!==e.defaultLabelValue&&null!=e.defaultLabelValue.value&&""===e.defaultLabelValue.label){let t=u.find(t=>{var l;return t.value===(null==(l=e.defaultLabelValue)?void 0:l.value)});if(null!=t&&""===t.label){let l=await I(e.defaultLabelValue.value);null!=l&&(m(l),v(e=>e.map(e=>e.value===t.value?{...e,...l}:e)))}}if(void 0!==e.defaultLabelValue&&void 0===u.find(t=>{var l;return t.value===(null==(l=e.defaultLabelValue)?void 0:l.value)})){if(u.find(t=>{var l,a,n;return t.value===("number"==typeof(null==(l=e.defaultLabelValue)?void 0:l.value)?"".concat(null==(a=e.defaultLabelValue)?void 0:a.value):null==(n=e.defaultLabelValue)?void 0:n.value)}))return;v([...u,e.defaultLabelValue])}};for(let t of((0,a.useEffect)(()=>{i&&null!==b&&!["CreatedById","UpdatedById"].includes(e.metaDataField.name)&&N()},[b,i]),(0,a.useEffect)(()=>{w()},[e.defaultLabelValue]),u))null==t.label&&(t.label=t.value),"number"==typeof t.value&&(t.value="".concat(t.value));return a.createElement(p.l,{label:e.label,size:e.size,data:u,className:e.className,renderOption:null!=e.metaDataField.lookupTableDescriptionField?h:void 0,defaultValue:void 0!==e.defaultLabelValue?e.defaultLabelValue.value:void 0,value:"number"==typeof e.value?"".concat(e.value):e.value,onSearchChange:g,onChange:t=>{var l,a,n,r,s;void 0!==e.onChange&&e.onChange({id:t,value:null!=(n=null==(l=u.find(e=>e.value===t))?void 0:l.data)?n:null,label:null!=(r=null==(a=u.find(e=>e.value===t))?void 0:a.label)?r:null}),m(null!=(s=u.find(e=>e.value===t))?s:null)},onClick:()=>{o(!0)},onBlur:e.onBlur,searchable:!0,clearable:e.metaDataField.isNullable,ref:l,readOnly:e.readOnly,withAsterisk:e.required,error:e.error,disabled:e.disabled,filter:null!=e.metaDataField.lookupTableDescriptionField?e=>{let{options:t,search:l}=e;return t}:void 0})});v.displayName="XLookup";var y=l(5856),g=l(567),b=l(395),N=l(8625),I=l(2127),w=l(1369),C=l(3378),x=l(9241),A=l(1290);let T=e=>{let t=(0,y.hG)({extensions:[I.A,w.A,g.N,x.A,A.A,N.Ay,C.A.configure({types:["heading","paragraph"]})]});return(0,a.useEffect)(()=>(null==t||t.on("update",()=>{if(null!=e.onChange){var l;e.onChange(null!=(l=null==t?void 0:t.getHTML())?l:"")}}),()=>{null==t||t.off("update")}),[t]),(0,a.useEffect)(()=>{var l;null==t||t.commands.setContent(null!=(l=e.value)?l:"")},[t]),a.createElement(b.d,{editor:t,styles:{root:{height:"100%",display:"flex",flexDirection:"column"},toolbar:{position:"static"},content:{flexGrow:1,display:"flex",flexDirection:"column",overflow:"auto"}},onChange:e=>{console.log(e)}},a.createElement(b.d.Toolbar,{sticky:!0,stickyOffset:60},a.createElement(b.d.ControlsGroup,null,a.createElement(b.d.Bold,null),a.createElement(b.d.Italic,null),a.createElement(b.d.Underline,null),a.createElement(b.d.Strikethrough,null),a.createElement(b.d.ClearFormatting,null),a.createElement(b.d.Highlight,null),a.createElement(b.d.Code,null)),a.createElement(b.d.ControlsGroup,null,a.createElement(b.d.H1,null),a.createElement(b.d.H2,null),a.createElement(b.d.H3,null),a.createElement(b.d.H4,null)),a.createElement(b.d.ControlsGroup,null,a.createElement(b.d.Blockquote,null),a.createElement(b.d.Hr,null),a.createElement(b.d.BulletList,null),a.createElement(b.d.OrderedList,null),a.createElement(b.d.Subscript,null),a.createElement(b.d.Superscript,null)),a.createElement(b.d.ControlsGroup,null,a.createElement(b.d.Link,null),a.createElement(b.d.Unlink,null)),a.createElement(b.d.ControlsGroup,null,a.createElement(b.d.AlignLeft,null),a.createElement(b.d.AlignCenter,null),a.createElement(b.d.AlignJustify,null),a.createElement(b.d.AlignRight,null))),a.createElement(b.d.Content,{onChange:e=>{console.log(e)}}))};function S(e,t){if(!e||!/^[-+]?[0-9]*\.?[0-9]*([eE][-+]?[0-9]+)?$/.test(e))return"NaN";let l={Single:{min:-34e37,max:34e37,precision:7},Double:{min:-17e307,max:17e307,precision:15},Decimal:{min:Number("-7.9e28"),max:Number("7.9e28"),precision:28},Byte:{min:0,max:255},SByte:{min:-128,max:127},Int16:{min:-32768,max:32767},UInt16:{min:0,max:65535},Int32:{min:-0x80000000,max:0x7fffffff},UInt32:{min:0,max:0xffffffff},Int64:{min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER},UInt64:{min:0,max:Number.MAX_SAFE_INTEGER}},a=parseFloat(e);if(isNaN(a)||!isFinite(a))throw Error("Invalid numeric value for ".concat(t,": ").concat(e));if("Int64"===t||"UInt64"===t||"Decimal"===t)if(e.includes(".")||e.includes("e")||e.includes("E")){if("Decimal"===t){if(Math.abs(a)>79e27)throw Error("Value out of range for Decimal: ".concat(e));if(e.replace(/^[-+]/,"").replace(/^0+/,"").replace(/\./,"").replace(/[eE][-+]?[0-9]+$/,"").replace(/0+$/,"").length>29)throw Error("Precision exceeds Decimal's 28-29 significant digits: ".concat(e))}}else try{let l=BigInt(e);if("Int64"===t&&(l<BigInt("-9223372036854775808")||l>BigInt("9223372036854775807")))throw Error("Value out of range for Int64: ".concat(e));if("UInt64"===t&&(l<BigInt(0)||l>BigInt("18446744073709551615")))throw Error("Value out of range for UInt64: ".concat(e));if("Decimal"===t&&(l<BigInt("-79228162514264337593543950335")||l>BigInt("79228162514264337593543950335")))throw Error("Value out of range for Decimal: ".concat(e))}catch(e){if(String(e).includes("out of range"))throw e}else{let n=l[t];if(a<n.min||a>n.max)throw Error("Value out of range for ".concat(t,": ").concat(e));if(["Byte","SByte","Int16","UInt16","Int32","UInt32"].includes(t)&&!Number.isInteger(a))throw Error("Value must be an integer for ".concat(t,": ").concat(e))}let n=e,r=e.endsWith("."),s=e.startsWith("-"),i=s?e.substring(1):e;return/^0[0-9]/.test(i)&&(i.includes(".")?i.startsWith("0.")||(i=i.replace(/^0+(?=\d)/,"")).startsWith(".")&&(i="0"+i):""===(i=i.replace(/^0+/,""))&&(i="0"),n=s?"-"+i:i),r&&!n.endsWith(".")&&(n+="."),n}var R=l(3470);let D=e=>{var t,l,c,m,u,p,f,E,h,y;let g=(0,d.xW)(),b=null==(t=g.formBuilder.metadata)?void 0:t.fields.find(t=>t.name===e.name);if(null==g.formBuilder.metadata)return a.createElement(a.Fragment,null);if(null==b)throw Error("Field ".concat(e.name," not found on ").concat(g.formBuilder.metadata.tableName," metadata."));e.required?g.formBuilder.addRequiredField(b.name):g.formBuilder.removeRequiredField(b.name);let N=b.isReadOnly||e.readOnly,I=(t,l)=>{let a=!1,n=t.name,r=t.type,s=t.isNullable,i=g.formBuilder.data[n],o=["Single","Double","Decimal","Byte","SByte","Int16","UInt16","Int32","UInt32","Int64","UInt64"];if(o.includes(r)&&""===l&&(l="0"),o.includes(r)&&"-"===l&&i.length>1&&(l="0"),o.includes(r)&&l.includes("-")&&(l="-"+l.replace("-","")),o.includes(r)&&(!1===e.allowNegative&&l.startsWith("-")&&""===(l=l.replace("-",""))&&(l="0"),null!=t.numberRange)){let e=t.numberRange.split("-"),a=parseFloat(S(e[0],r)),n=parseFloat(S(e[1],r));try{let e=parseFloat(S(l,r));e<=a&&(l=a.toString()),e>n&&(l=n.toString())}catch(e){console.log(e)}}if("Char"==r&&(l=l.replace(i,""),s||""!==l||(l="A"),a=!0),("String"===r||"Guid"===r)&&(t.characterLimit&&(l.length<=t.characterLimit||(l=l.substring(0,t.characterLimit))),a=!0),["Single","Double","Decimal"].includes(r))try{let e=S(l,r);Number.isNaN(e)||"NaN"===e||(l=e.toString(),a=!0)}catch(e){}if(["Byte","SByte","Int16","UInt16","Int32","UInt32","Int64","UInt64"].includes(r))try{let e=function(e,t){let l,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;if(!e||!/^[-+]?[0-9a-fA-F]+$/.test(e))return NaN;let n={Byte:{min:0,max:255},SByte:{min:-128,max:127},Int16:{min:-32768,max:32767},UInt16:{min:0,max:65535},Int32:{min:-0x80000000,max:0x7fffffff},UInt32:{min:0,max:0xffffffff},Int64:{min:BigInt("-9223372036854775808"),max:BigInt("9223372036854775807")},UInt64:{min:BigInt(0),max:BigInt("18446744073709551615")},Single:{min:-34e37,max:34e37},Double:{min:-17e307,max:17e307},Decimal:{min:BigInt("-79228162514264337593543950335"),max:BigInt("79228162514264337593543950335")}};if("Int64"===t||"UInt64"===t||"Decimal"===t){try{l=BigInt(e)}catch(e){return NaN}let a=n[t];if(l<a.min||l>a.max)throw Error("Value out of range for ".concat(t,": ").concat(e))}else if(l=parseInt(e,a),["Byte","SByte","Int16","UInt16","Int32","UInt32"].includes(t)){let a=n[t];if(l<a.min||l>a.max)throw Error("Value out of range for ".concat(t,": ").concat(e))}return l}(l,r);Number.isNaN(e)||(l=e.toString(),a=!0)}catch(e){}a&&w(n,l)},w=function(t,l){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;g.formBuilder.dispatch({type:"SET_FIELD_VALUE",payload:{field:t,value:l}}),null!=e.onChange&&((null==b?void 0:b.type)==="Lookup"?e.onChange(l,a):e.onChange(l))};if(null==b||void 0===g.formBuilder.data||void 0===g.formBuilder.data[b.name])return a.createElement(a.Fragment,null);let C=t=>{let{field:l}=t;return a.createElement(a.Fragment,null,null!=e.label?e.label:l.displayName," ",!0===l.isRecommended?a.createElement(n.m,{label:"Recommended",withArrow:!0},a.createElement("span",{className:" text-blue-600"},"+")):a.createElement(a.Fragment,null))};return a.createElement(a.Fragment,null,"Lookup"===b.type&&a.createElement(v,{label:a.createElement(C,{field:b}),size:e.size,className:!1===g.formBuilder.canRead.canRead?"invisible":"",metaDataField:b,owningTableName:null==(l=g.formBuilder.metadata)?void 0:l.tableName,ref:!0===e.focus?g.formBuilder.firstInputRef:void 0,onChange:t=>{w(b.name,null==t?void 0:t.id,null==t?void 0:t.value),null!=e.onChange&&e.onChange(null==t?void 0:t.id,null==t?void 0:t.label)},onBlur:e.onBlur,defaultLabelValue:void 0!==g.formBuilder.snapshot?((e,t)=>null==e&&null!=t?{label:t,value:t}:null!=e&&null!=t?{label:e,value:t}:void 0)(g.formBuilder.snapshot[b.lookupName],g.formBuilder.snapshot[b.name]):(e=>{var t;let l=null==(t=g.formBuilder.defaults)?void 0:t.find(t=>t.field===e);if(void 0!==l)return{label:"",value:l.value}})(b.name),value:g.formBuilder.data[b.name],excludeValues:null==(m=g.formBuilder.lookupExclusions)||null==(c=m.find(e=>e.fieldName===b.name))?void 0:c.values,query:null==(u=g.formBuilder.lookupQueries)?void 0:u.find(e=>e.field===b.name),readOnly:["CreatedById","UpdatedById"].includes(b.name)||!1===g.formBuilder.canUpdate&&void 0!==g.formBuilder.snapshot||["OwningUserId","OwningTeamId"].includes(b.name)&&void 0!==g.formBuilder.snapshot&&!1===g.formBuilder.snapshot._ui_info_.canAssign||N,required:!1===b.isNullable&&!["CreatedById","UpdatedById"].includes(b.name)||!0===b.isRequired||!0===e.required,error:null==(p=g.formBuilder.validationMessages.find(e=>e.field===b.name))?void 0:p.message,disabled:e.disabled}),"String"===b.type&&"rich"===e.varient&&a.createElement(T,{value:g.formBuilder.data[b.name],onChange:e=>{I(b,e)}}),"String"===b.type&&"textarea"===e.varient&&a.createElement(r.T,{size:e.size,styles:{root:{height:"100%",display:"flex",flexDirection:"column"},wrapper:{flexGrow:1},input:{height:"100%"}},label:a.createElement(C,{field:b}),placeholder:e.placeholder,value:g.formBuilder.data[b.name],required:!0===b.isRequired||!0===e.required||!b.isNullable,onChange:e=>{I(b,e.currentTarget.value)},onBlur:e.onBlur,readOnly:!1===g.formBuilder.canUpdate&&void 0!==g.formBuilder.snapshot||N,error:null==(f=g.formBuilder.validationMessages.find(e=>e.field===b.name))?void 0:f.message,disabled:e.disabled}),["String","Guid","Int32","Single","Int64","Double","Decimal","Byte","SByte","UInt32","UInt64","Int16","UInt16","Char"].includes(b.type)&&null==e.varient&&null!=g.formBuilder.data[b.name]&&a.createElement(s.k,{label:a.createElement(C,{field:b}),size:e.size,ref:!0===e.focus?g.formBuilder.firstInputRef:void 0,value:g.formBuilder.data[b.name],onChange:e=>{I(b,e.currentTarget.value)},onBlur:e.onBlur,readOnly:!1===g.formBuilder.canUpdate&&void 0!==g.formBuilder.snapshot||N,error:null==(E=g.formBuilder.validationMessages.find(e=>e.field===b.name))?void 0:E.message,required:!0===b.isRequired||!0===e.required||!b.isNullable,placeholder:e.placeholder,disabled:e.disabled}),"DateTime"===b.type&&a.createElement(o.J,{ref:!0===e.focus?g.formBuilder.firstInputRef:void 0,size:e.size,label:a.createElement(C,{field:b}),...null!=b.dateFormat&&""!==b.dateFormat?{valueFormat:b.dateFormat}:{},value:void 0!==g.formBuilder.data&&void 0!==g.formBuilder.data[b.name]&&null!==g.formBuilder.data[b.name]&&"0001-01-01T00:00:00"!==g.formBuilder.data[b.name]?(0,R.PS)(b.dateFormat)?g.formBuilder.data[b.name].replace("Z",""):g.formBuilder.data[b.name].replace("Z","").split("T")[0]:null,onChange:e=>{w(b.name,null==e?null:(0,R.PS)(b.dateFormat)?e:e+"T00:00:00")},onBlur:e.onBlur,clearable:b.isNullable,readOnly:["CreatedDate","UpdatedDate"].includes(b.name)||void 0!==g.formBuilder.snapshot&&!1===g.formBuilder.canUpdate||N,required:!0===b.isRequired||e.required||!b.isNullable,error:null==(h=g.formBuilder.validationMessages.find(e=>e.field===b.name))?void 0:h.message,...e.dateInput,disabled:e.disabled}),"Boolean"===b.type&&a.createElement("div",{className:"w-full h-full flex items-end"},a.createElement("div",{className:"w-full h-9 flex items-center"},a.createElement(i.S,{ref:!0===e.focus?g.formBuilder.firstInputRef:void 0,label:a.createElement(C,{field:b}),size:e.size,checked:void 0!==g.formBuilder.data&&void 0!==g.formBuilder.data[b.name]&&null!==g.formBuilder.data[b.name]?g.formBuilder.data[b.name]:void 0,onChange:t=>{void 0!==g.formBuilder.snapshot&&!1===g.formBuilder.canUpdate||N||w(b.name,t.currentTarget.checked),null!=e.onChange&&e.onChange(t.currentTarget.checked)},onBlur:e.onBlur,readOnly:void 0!==g.formBuilder.snapshot&&!1===g.formBuilder.canUpdate||N,error:null==(y=g.formBuilder.validationMessages.find(e=>e.field===b.name))?void 0:y.message,required:!0===b.isRequired||e.required,disabled:e.disabled}))))}},8002:(e,t,l)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return l(777)}])},8779:(e,t,l)=>{"use strict";l.d(t,{A:()=>r});var a=l(6443),n=l(7188);let r=()=>{let e=(0,a.xd)(),{colorScheme:t,toggleColorScheme:l}=(0,n.C)(),r="dark"===t,s=r?e.colors.gray[4]:e.colors.dark[7];return{getIconColor:()=>s,getPrimaryColor:()=>e.colors[e.primaryColor][r?8:6],colorScheme:t}}},9254:(e,t,l)=>{"use strict";l.d(t,{XK:()=>a});class a{top(e){return this._maxResults=e,this}page(e){return this._page=e,this}from(e){return this._tableName=e,this}where(e,t,l){return e instanceof r?this._filters.push(e):this._filters.push(s(e,t,l)),this}and(e,t,l){return e instanceof r?this._filters[this._filters.length-1].and(e):this._filters[this._filters.length-1].and(e,t,l),this}or(e,t,l){return e instanceof r?this._filters[this._filters.length-1].or(e):this._filters[this._filters.length-1].or(e,t,l),this}join(e,t,l){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return this._joins.push(new n(e,t,l,a,"inner")),this}leftJoin(e,t,l){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return this._joins.push(new n(e,t,l,a,"left")),this}except(e){return this._except.push(e),this}orderBy(e,t){return this._orderBy||(this._orderBy=[]),this._orderBy.push({field:e,order:t}),this}distinct(){return this._distinct=!0,this}denormalize(){return this._denoramlize=!0,this}toReadRequest(){var e,t,l;return{tableName:this._tableName,fields:this._fields,page:null!=(e=this._page)?e:1,maxResults:null!=(t=this._maxResults)?t:null,orderBy:null!=(l=this._orderBy)?l:[],filters:this._filters.length>0?[this._filters[0].getJson()]:[],joins:this._joins,distinct:this._distinct,denormalize:this._denoramlize,except:this._except}}constructor(e){return this._page=1,this._tableName="",this._filters=[],this._joins=[],this._distinct=!1,this._denoramlize=!1,this._except=[],this._fields=e,this}}class n{constructor(e,t,l=null,a=null,n){this.alias=null;let r=e.split("."),s=t.split(".");if(r.length<2||s.length<2)throw Error("Join must include a table and field part ie: tableName.fieldName");this.fromTable=r[0],this.fromField=r[1],this.toTable=s[0],this.toField=s[1],this.alias=l,this.fields=null!=a?a:[],this.type=n}}class r{and(e,t,l){if(e instanceof r)this.filters.push(e);else{if("OR"==this.logicalOperator){let a,n=this.conditions[this.conditions.length-1];return this.lastCondition==n?(a=new r,this.conditions.pop(),a.conditions.push(n)):a=this.filters[this.filters.length-1],this.lastCondition={field:e,operator:t,value:l},a.conditions.push(this.lastCondition),this.filters.push(a),this}this.lastCondition={field:e,operator:t,value:l},this.conditions.push(this.lastCondition)}return this}or(e,t,l){if(e instanceof r)this.filters.push(e);else{if("AND"===this.logicalOperator){this.logicalOperator="OR";let e=new r;e.conditions=this.conditions,this.filters.push(e),this.conditions=[]}this.lastCondition={field:e,operator:t,value:l},this.conditions.push(this.lastCondition)}return this}getJson(){return{logicalOperator:this.logicalOperator,filters:[...this.conditions,...this.filters.map(e=>e.getJson())]}}getStr(){let e=[];for(let t of this.conditions)e.push("".concat(t.field," ").concat(t.operator," ").concat(t.value));for(let t of this.filters)e.push("(".concat(t.getStr(),")"));return e.join(" ".concat(this.logicalOperator," "))}print(){return console.log(this.getStr()),this}constructor(){this.logicalOperator="AND",this.filters=[],this.conditions=[]}}let s=(e,t,l)=>{let a=new r;return a.logicalOperator="AND",a.conditions=[],a.conditions.push({field:e,operator:t,value:l}),a}},9583:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>eu});var a=l(191),n=l(5834),r=l(9641),s=l(8633),i=l(9631),o=l(7232);let d=n.createContext(null),c=()=>{let e=n.useContext(d);if(null==e)throw Error("useDataTableContext must be used within a DataTableContextProvider");return e},m={page:1,fields:null,orderBy:null,searchField:null,searchValue:null,setData:null,active:null};var u=l(304),p=l(2038),f=l(8718),E=l(3470);let h=()=>{var e,t,l;let a=c(),[r,s]=(0,n.useState)({searchField:null,searchValue:null}),[i]=(0,f.o)(r.searchValue,500),o=()=>a.getFields().filter(e=>"string"==typeof e.displayName&&null!=e.metadataField).map((e,t)=>{var l,a,n,r;let s=null!=(r=null==(l=e.metadataField)?void 0:l.lookupName)?r:null==(a=e.metadataField)?void 0:a.name;return{value:"".concat(e.alias).concat(""!==e.alias?".":"").concat(s),label:null==(n=e.metadataField)?void 0:n.displayName}}),d=async()=>{var e,t;let l=null==(t=a.state.metadata)||null==(e=t.fields.find(e=>e.name===r.searchField))?void 0:e.type,n="";if("DateTime"===l&&(null==i?void 0:i.trim())!==""){let e=(0,E.qn)();n="~".concat(e)}let s=i+n,o=await a.getData({...m,page:1,searchField:r.searchField,searchValue:s,active:"Active"===a.state.activeSwitch,orderBy:a.state.data.orderBy});a.dispatch({type:"SEARCH_VALUE_CHANGE",payload:{searchValue:s,searchField:r.searchField,data:o.data}})};return(0,n.useEffect)(()=>{null!=i&&d()},[i,r.searchField]),(0,n.useEffect)(()=>{if(null!=a.props.tableName&&""!==a.props.tableName){var e,t,l;s({searchField:null!=(l=null==(t=o())||null==(e=t[0])?void 0:e.value)?l:null,searchValue:null})}},[a.props.tableName]),n.createElement("div",{className:"flex"},n.createElement(u.l,{placeholder:"Search",style:{width:"auto"},data:null!=(e=o())?e:[],value:null!=(t=r.searchField)?t:"",onChange:e=>{s({...r,searchField:e})}}),n.createElement(p.k,{placeholder:"Search...",style:{width:"auto"},value:null!=(l=r.searchValue)?l:"",onChange:e=>{s({...r,searchValue:e.currentTarget.value})}}))};var v=l(7211),y=l(7376),g=l(6443),b=l(7188);let N=e=>{let t=(0,g.xd)(),l=c(),{colorScheme:a,toggleColorScheme:r}=(0,b.C)(),i="dark"===a?t.colors.gray[4]:t.colors.dark[7],o="",d="";null!=l.state.data.orderBy&&l.state.data.orderBy.length>0&&(o=l.state.data.orderBy[0].field,d=l.state.data.orderBy[0].order);let m=l.getFields();return n.createElement(n.Fragment,null,m.map((e,t)=>{if(null==e.metadataField)return n.createElement(s.X.Th,{key:t,style:{width:e.width},className:"".concat(e.width.endsWith("px")?"flex-none":""," truncate")},n.createElement("div",{className:"flex items-center"},"string"==typeof e.displayName?e.displayName:e.displayName(l.refHandle)));let a=e.metadataField,r=(null==a?void 0:a.lookupName)!=null?a.lookupName:a.name,c="".concat(e.alias).concat(""!==e.alias?".":"").concat(r);if(null!=a)return n.createElement(s.X.Th,{key:c,style:{width:e.width},className:"".concat(e.width.endsWith("px")?"flex-none":""," truncate")},n.createElement("div",{className:"flex items-center"},n.createElement("span",{className:"cursor-pointer",onClick:()=>{l.sort(c)}},a.displayName),o===c&&"desc"===d&&n.createElement(v.A,{size:16,strokeWidth:2,color:i,className:" ml-2"}),o===c&&"asc"===d&&n.createElement(y.A,{size:16,strokeWidth:2,color:i,className:"ml-2"})))}))};var I=l(5261);let w=e=>{let t=c();return void 0!==e.disabledMessage?n.createElement("div",{className:"w-full h-full flex flex-col justify-center items-center"},e.disabledMessage):e.isLoadingData?n.createElement("div",{className:"w-full h-full flex justify-center items-center"},n.createElement(I.a,null)):"MISSING_READ_PERMISSIONS"===t.state.type?n.createElement("div",{className:"w-full h-full flex flex-col justify-center items-center"},n.createElement("div",null,"Missing read permission for ",e.tableName,".")):void 0};var C=l(4658),x=l(9967),A=l(742),T=l(4243),S=l(40),R=l(9005),D=l(964),k=l(8779),_=l(702),F=l(8647);let L={getHighestPermissionLevel:e=>void 0!==e.find(e=>e.endsWith("_SYSTEM"))?"SYSTEM":void 0!==e.find(e=>e.endsWith("_TEAM"))?"TEAM":void 0!==e.find(e=>e.endsWith("_USER"))?"USER":"NONE"};var B=l(9254);let P=(0,F.vt)()((e,t)=>({tablePermissions:[],teams:[],getTablePermissions:async(e,l)=>{let a=t().tablePermissions.find(e=>e.tableName===l);if(void 0!==a)return a.permissions;let n="".concat("TABLE_{tableName}_READ_SYSTEM, TABLE_{tableName}_READ_TEAM, TABLE_{tableName}_READ_USER".replaceAll("{tableName}",l),", ").concat("TABLE_{tableName}_CREATE_SYSTEM, TABLE_{tableName}_CREATE_TEAM, TABLE_{tableName}_CREATE_USER".replaceAll("{tableName}",l),", ").concat("TABLE_{tableName}_DELETE_SYSTEM, TABLE_{tableName}_DELETE_TEAM, TABLE_{tableName}_DELETE_USER".replaceAll("{tableName}",l),", ").concat("TABLE_{tableName}_UPDATE_SYSTEM, TABLE_{tableName}_UPDATE_TEAM, TABLE_{tableName}_UPDATE_USER".replaceAll("{tableName}",l)),r=await e.execute({url:_.rG,method:"POST",body:{method:"has_permissions",parameters:{permissionNames:n.split(",").map(e=>e.trim())}}});if((null==r?void 0:r.succeeded)===!0){let e=r.data;if(e.length>0){let t=e.filter(e=>e.startsWith("TABLE_".concat(l,"_READ"))),a=e.filter(e=>e.startsWith("TABLE_".concat(l,"_CREATE"))),n=e.filter(e=>e.startsWith("TABLE_".concat(l,"_DELETE"))),r=e.filter(e=>e.startsWith("TABLE_".concat(l,"_UPDATE")));return{read:L.getHighestPermissionLevel(t),create:L.getHighestPermissionLevel(a),delete:L.getHighestPermissionLevel(n),update:L.getHighestPermissionLevel(r)}}}return{read:"NONE",create:"NONE",delete:"NONE",update:"NONE"}},getPermissions:async(e,l)=>{let a=t().tablePermissions,n=l.filter(e=>null!=a.find(t=>t.tableName===e));if(n.length===l.length)return n;let r=await e.execute({url:_.rG,method:"POST",body:{method:"has_permissions",parameters:{permissionNames:l}}});return(null==r?void 0:r.succeeded)===!0?r.data:[]},getTeams:async l=>{var a,n;if(t().teams.length>0)return t().teams;let r=new B.XK(["Name"]).top(99999).from("Team").join("Team.TeamId","TeamUser.TeamId","tu").join("tu.UserId","User.UserId","u").distinct().toReadRequest(),s=await l.read(r);return s.succeeded?(e({teams:null!=(a=s.data.results.map(e=>e.Name))?a:[]}),null!=(n=s.data.results.map(e=>e.Name))?n:[]):[]}}));var O=l(2651),M=l(9590);let U=e=>{let t=(0,a.A)(),l=c(),[r,s]=n.useState(null),[i,o]=n.useState(!1),[d,m]=n.useState("create,update"),[p,f]=n.useState([]),E=async()=>{if(null===r)return;o(!0);let a=new FormData;a.append("file",r),a.append("name","TABLE_ImportData"),a.append("parameters",JSON.stringify({tableName:l.props.tableName,operation:d}));let n=await t.execute({url:_.N$,method:"POST",body:a,hideFailureMessage:!0});if((null==n?void 0:n.succeeded)===!1){let e=n.data;if(null!=e&&null!=e.errors&&e.errors.length>0)f(e.errors);else{var s;f([null!=(s=n.friendlyMessage)?s:"Unknown error"])}}else(null==n?void 0:n.succeeded)===!0&&(l.refresh(),e.close());o(!1)};return(0,n.useEffect)(()=>{!0===e.opened&&(o(!1),s(null),f([]))},[e.opened]),n.createElement(O.a,{opened:e.opened,onClose:e.close,title:"Import Data",size:"lg",closeOnEscape:!i,closeOnClickOutside:!i,withCloseButton:!i,centered:!0,styles:{overlay:{zIndex:4e3},inner:{zIndex:4001}}},p.length>0?n.createElement("div",{className:"w-full flex flex-col gap-4 h-96"},n.createElement("div",{className:"w-full h-full flex flex-col gap-2 overflow-y-auto"},p.map((e,t)=>n.createElement("div",{key:t,className:"w-full bg-red-100 py-2 rounded-md"},e)))):n.createElement(n.Fragment,null,n.createElement("div",{className:"w-full relative"},!0===i&&n.createElement("div",{className:"absolute w-full h-full flex justify-center items-center"},n.createElement(I.a,null)),n.createElement("div",{className:"w-full flex flex-col gap-4 ".concat(i?"invisible":"")},n.createElement(u.l,{label:"Operation",placeholder:"Select Operation",data:[{value:"create,update",label:"Create and Update"},{value:"create",label:"Create Only"},{value:"update",label:"Update Only"}],value:d,onChange:e=>{m(e)}}),n.createElement(M.z,{placeholder:"Click to choose import file",label:"File Upload",required:!0,value:r,onChange:e=>{s(e)}}),n.createElement("div",{className:"w-full flex justify-end"},n.createElement(x.$,{onClick:E,disabled:null===r},"Upload"))))))};var W=l(4918),j=l(4180);let z=e=>{var t,l;let a=c(),r=a.getFields(),[s,i]=(0,n.useState)(null!=(l=null==(t=a.state.metadata)?void 0:t.fields.filter(e=>{var t;return e.name!==(null==(t=a.state.metadata)?void 0:t.primaryKey)}).map(e=>({metadataField:e,isVisible:null!=r.find(t=>{var l;return(null==(l=t.metadataField)?void 0:l.name)===e.name})})))?l:[]);return n.createElement(O.a,{opened:e.opened,onClose:e.close,title:"Columns",size:"xs",centered:!0,styles:{overlay:{zIndex:4e3},inner:{zIndex:4001}}},n.createElement("div",{className:"w-full flex flex-col max-h-[80vh]"},n.createElement("div",{className:"w-full overflow-y-scroll flex flex-col gap-2"},s.map(e=>n.createElement("div",{key:e.metadataField.name,className:"flex gap-2"},n.createElement(j.S,{label:e.metadataField.displayName,checked:e.isVisible,onChange:t=>{var l,a;return l=e.metadataField.name,a=t.currentTarget.checked,void i(e=>e.map(e=>e.metadataField.name===l?{...e,isVisible:a}:e))}})))),n.createElement("div",{className:"w-full flex justify-end py-1"},n.createElement(x.$,{onClick:()=>{a.dispatch({type:"SET_VISIBLE_FIELDS",payload:{visibleFields:s.filter(e=>e.isVisible).map(e=>e.metadataField.name)}}),e.close()}},"Set"))))},V=()=>{let[e,t]=(0,n.useState)(void 0),l=(0,k.A)().getIconColor(),r=(0,a.A)(),s=c(),i=P(),[o,d]=(0,W.j)(!1),[m,u]=(0,W.j)(!1),p=async()=>{let e=await i.getPermissions(r,["TABLE_".concat(s.props.tableName,"_IMPORT"),"TABLE_".concat(s.props.tableName,"_EXPORT"),"ACTION_TABLE_ImportData","ACTION_TABLE_ExportData"]),l=await i.getTablePermissions(r,s.props.tableName),a=!1,n=!1;e.find(e=>e==="TABLE_".concat(s.props.tableName,"_IMPORT"))&&e.find(e=>"ACTION_TABLE_ImportData"===e)&&"NONE"!==l.create&&"NONE"!==l.update&&(null==s.props.canImport||s.props.canImport)&&(a=!0),e.find(e=>e==="TABLE_".concat(s.props.tableName,"_EXPORT"))&&e.find(e=>"ACTION_TABLE_ExportData"===e)&&"NONE"!==l.read&&(null==s.props.canExport||s.props.canExport)&&(n=!0),t({Import:a,Export:n})},f=async()=>{await r.action("TABLE_ImportTemplate",{tableName:s.props.tableName},"ImportTemplate_".concat(s.props.tableName,".xlsx"))},E=async()=>{await r.action("TABLE_ExportData",{query:{tableName:s.props.tableName,fields:["*"],orderBy:s.props.orderBy,filters:s.props.filters,joins:s.props.joins,except:s.props.except,maxResults:999999}},"ExportData_".concat(s.props.tableName,".xlsx"))};return((0,n.useEffect)(()=>{e||p()},[e,s.state.isLoadingData]),s.props.disabledMessage||null==s.state.metadata)?n.createElement(n.Fragment,null):n.createElement(n.Fragment,null,n.createElement(U,{opened:o,close:d.close}),null!=s.state.metadata&&n.createElement(z,{opened:m,close:u.close}),n.createElement(C.W,{shadow:"md",width:200},n.createElement(C.W.Target,null,n.createElement(x.$,{radius:"xl",variant:"subtle",styles:{root:{padding:6}}},n.createElement(A.A,{size:24,strokeWidth:2,color:l}))),n.createElement(C.W.Dropdown,null,n.createElement(C.W.Label,null,"View"),n.createElement(C.W.Item,{onClick:u.open,leftSection:n.createElement(T.A,{size:14})},"Columns"),((null==e?void 0:e.Import)||(null==e?void 0:e.Export))&&n.createElement(C.W.Label,null,"Data"),(null==e?void 0:e.Import)&&n.createElement(n.Fragment,null,n.createElement(C.W.Item,{leftSection:n.createElement(S.A,{size:14}),onClick:f},"Import Template"),n.createElement(C.W.Item,{leftSection:n.createElement(R.A,{size:14}),onClick:d.open},"Import Data")),(null==e?void 0:e.Export)&&n.createElement(n.Fragment,null,n.createElement(C.W.Item,{leftSection:n.createElement(D.A,{size:14}),onClick:E},"Export Data")))))},H=e=>{var t,l,a,d,u,p,f,E,v,y;let g=c(),b=(0,k.A)(),I=void 0!==g.state.metadata,C=!0===g.props.scrollable||void 0===g.props.scrollable,x=(void 0===g.props.canCreate||!0===g.props.canCreate)&&"NONE"!==g.state.permissions.create&&void 0===g.props.disabledMessage,A=null==g.props.disabledMessage&&"NONE"!==g.state.permissions.read,T=null!=g.props.customCreateButton?null==(t=(l=g.props).customCreateButton)?void 0:t.call(l,()=>g.openForm(void 0)):void 0,S="NONE"!==g.state.permissions.read&&void 0===g.props.disabledMessage&&(null==g.props.searchable||!0===g.props.searchable),R=!0===g.props.showActiveSwitch&&"NONE"!==g.state.permissions.read&&void 0===g.props.disabledMessage&&(null==(a=g.state.metadata)?void 0:a.fields.find(e=>"IsActive"===e.name))!=null,D=!0===g.props.showOptions||null==g.props.showOptions,_=void 0!==g.props.disabledMessage||"NONE"===g.state.permissions.read||!0===g.state.isLoadingData?n.createElement(w,{tableName:g.props.tableName,permissions:g.state.permissions,isLoadingData:g.state.isLoadingData,disabledMessage:g.props.disabledMessage}):void 0,F=void 0===g.props.title||""!==g.props.title||D||R||S||x||null!=T,L=async e=>{await g.getData({...m,page:e,orderBy:g.state.data.orderBy,setData:!0}),void 0!==g.props.onPageChange&&g.props.onPageChange(e)},B=async e=>{let t=await g.getData({...m,page:1,active:"Active"===e,setData:!0,searchField:g.state.searchField,searchValue:g.state.searchValue,orderBy:g.state.data.orderBy});g.dispatch({type:"ACTIVE_SWITCH_CHANGE",payload:{activeSwitch:e,data:t.data}})};return n.createElement("div",{className:"relative flex flex-col h-full w-full rtable"},void 0!==_&&n.createElement("div",{className:" absolute w-full h-full pt-11"},n.createElement("div",{className:"w-full h-full"},_)),n.createElement("div",{className:"text-lg flex justify-between items-center"},n.createElement("div",{className:"flex items-center"},I?void 0!==g.props.title?g.props.title:"Manage ".concat(void 0===g.state.metadata?g.props.tableName:null==(d=g.state.metadata)?void 0:d.displayName,"s"):""),n.createElement("div",{className:"".concat(F?"flex":"hidden"," items-center gap-2")},D&&n.createElement(V,null),R&&n.createElement("div",{className:" m-2"},n.createElement(r.I,{data:["Active","Inactive"],size:"sm",styles:{label:{paddingLeft:"0.5125rem",paddingRight:"0.5125rem",paddingTop:0,paddingBottom:0}},onChange:e=>{B(e)}})),!0===S?n.createElement(h,null):n.createElement("div",{className:" w-1 h-9"}),x&&null==T&&n.createElement("div",{onClick:()=>{g.openForm(void 0),null!=g.props.formOnOpen&&g.props.formOnOpen("CREATE",void 0)},className:"p-1 rounded-full w-8 h-8 flex justify-center items-center cursor-pointer",style:{backgroundColor:b.getPrimaryColor()}},n.createElement(o.A,{size:22,strokeWidth:2,color:"white"})),x&&null!=T&&n.createElement("div",null,T))),n.createElement(s.X,{"aria-label":g.props.title,highlightOnHover:null==(E=null==(u=g.props.tableStyle)?void 0:u.highlighOnHover)||E,striped:null!=(v=null==(p=g.props.tableStyle)?void 0:p.striped)&&v,withColumnBorders:null!=(y=null==(f=g.props.tableStyle)?void 0:f.withColumnBorders)&&y,className:"".concat(C?"  overflow-x-hidden":""," flex flex-col grow")},n.createElement(s.X.Thead,{className:"".concat(C?"px-2":"")},!g.state.isLoadingData&&n.createElement(s.X.Tr,{className:"flex"},n.createElement(N,null))),n.createElement(s.X.Tbody,{className:"relative overflow-x-hidden ".concat(C?"grow overflow-y-scroll pl-2 pr-0.5":""," ")},e.children)),!0===A&&n.createElement("div",{className:"w-full flex justify-between items-center mt-4 px-2"},n.createElement("div",{className:" text-sm"},void 0!==g.state.data.totalResults&&g.state.data.maxResults&&g.state.data.currentPage&&n.createElement(n.Fragment,null,0===g.state.data.results.length?0:g.state.data.currentPage*g.state.data.maxResults-(g.state.data.maxResults-1)," - ",g.state.data.currentPage*g.state.data.maxResults>g.state.data.totalResults?g.state.data.totalResults:g.state.data.currentPage*g.state.data.maxResults," of ",g.state.data.totalResults)),(null==g.props.pagination||!0===g.props.pagination)&&n.createElement(i.d,{value:g.state.data.currentPage,total:g.state.data.pages<1?1:g.state.data.pages,onChange:e=>{L(e)},size:"sm",withEdges:!0})))};var G=l(9639),q=l(3742);let K=()=>({type:"INSTANTIATED",tableName:void 0,data:void 0,snapshot:void 0,dirtyFields:[],validationMessages:[],metadata:void 0,canUpdate:!0,canCreate:!0,canRead:{canRead:!0,message:""},isLoading:!0,forceIsLoading:!1,isSubmitted:!1,eventListeners:[]}),J=(e,t)=>{var l,a,n;switch(console.log("FormBuilder: "+t.type),t.type){case"START_INITIAL_LOAD":return{...K(),data:t.payload.data,snapshot:void 0,metadata:e.metadata,isLoading:!0,forceIsLoading:null!=(l=t.payload.forceIsLoading)&&l,type:"START_INITIAL_LOAD"};case"INITIAL_LOAD_COMPLETE":return{...e,...t.payload,isLoading:!1,dirtyFields:[],type:"INITIAL_LOAD_COMPLETE"};case"SET_FIELD_VALUE":let r=t.payload.field;return{...e,...e.dirtyFields.includes(r)?{dirtyFields:[...e.dirtyFields]}:{dirtyFields:[...e.dirtyFields,r]},data:{...e.data,[r]:t.payload.value},type:"SET_FIELD_VALUE"};case"SET_IS_LOADING":return{...e,isLoading:!0,type:"SET_IS_LOADING"};case"SUBMIT_COMPLETE":return{...e,isLoading:!1,isSubmitted:!0,validationMessages:[],dirtyFields:[],type:"SUBMIT_COMPLETE"};case"SUBMIT_COMPLETE_LOADING":return{...e,isSubmitted:!0,validationMessages:[],dirtyFields:[],type:"SUBMIT_COMPLETE"};case"SUBMIT_CANCELLED":return{...e,isLoading:!1,type:"SUBMIT_CANCELLED"};case"SET_VALIDATION_MESSAGES":return{...e,validationMessages:t.payload,type:"SET_VALIDATION_MESSAGES"};case"SET_VALIDATION_MESSAGE":let s=t.payload;return{...e,validationMessages:[...e.validationMessages.filter(e=>e.field!==s.field),s],type:"SET_VALIDATION_MESSAGE"};case"SET_DATA_TO_EDIT":let i=t.payload;return{...e,validationMessages:[],snapshot:t.payload.snapshot,data:t.payload.data,canUpdate:null!=t.payload.data&&(null==i.canUpdate||!1!=i.canUpdate)&&null!=(a=null==i?void 0:i.data._ui_info_.canUpdate)&&a,forceIsLoading:null!=(n=i.forceIsLoading)&&n,type:"SET_DATA_TO_EDIT"};case"CLEAR_EDIT_DATA":return{...e,type:"CLEAR_EDIT_DATA",data:e.snapshot};case"CLEAR":return{...e,type:"CLEAR",data:void 0,snapshot:void 0};case"SET_SHOW_FORCE_LOADING":return{...e,forceIsLoading:t.payload.forceIsLoading,type:"SET_SHOW_FORCE_LOADING"}}return{...e}};var X=l(492),Y=l(2676);let $=()=>({get:()=>(0,X.A)(),validate:e=>(0,Y.A)(e)});var Q=l(2360),Z=l(646);let ee=e=>{let t=(()=>{if(!0===e.formBuilder.isLoading)return!0;if(void 0!==e.formBuilder&&void 0!==e.formBuilder.metadata&&void 0!==e.formBuilder.data){for(let t of e.formBuilder.metadata.fields.filter(t=>{var l;return t.name!==(null==(l=e.formBuilder.metadata)?void 0:l.primaryKey)}))if(void 0===e.formBuilder.data[t.name])return console.warn("No data for field: "+t.name+". Ensure lookup fields are spelled correctly."),!0}return!1})()||!0===e.showLoading;return n.createElement(Z.Ay,{formBuilder:e.formBuilder},n.createElement("form",{onSubmit:t=>{t.preventDefault(),t.stopPropagation(),e.formBuilder.save(e.onPreValidate,e.onPreSave,e.onPostSave)},className:"".concat(t||!0===e.showLoading||!e.formBuilder.canRead.canRead||!e.formBuilder.canCreate?"relative overflow-hidden":""," ").concat(e.className)},t&&n.createElement("div",{className:"absolute w-full h-full flex justify-center items-center",style:{zIndex:4e3}},n.createElement(I.a,null)),!t&&!1===e.formBuilder.canRead.canRead&&n.createElement("div",{className:"absolute w-full h-full flex justify-center items-center text-center",style:{zIndex:10}},e.formBuilder.canRead.message),!t&&"CREATE"===e.formBuilder.operation&&!1===e.formBuilder.canCreate&&n.createElement("div",{className:"absolute w-full h-full flex justify-center items-center text-center",style:{zIndex:10}},"This record doesn't exist or you are missing the required permissions to create ".concat(e.formBuilder.tableName)),n.createElement("div",{className:"".concat(t||!1===e.formBuilder.canRead.canRead||"CREATE"===e.formBuilder.operation&&!1===e.formBuilder.canCreate?"invisible":""," ").concat(e.className)},e.children)))},et=(0,n.forwardRef)((e,t)=>{var l,r,s,i;let o=c(),d=(e=>{var t,l;let r=(0,a.A)(),s=P(),i=$(),o=(0,n.useRef)(null),[d,c]=(0,n.useReducer)(J,K()),[m,u]=(0,n.useState)([]),p=(0,n.useRef)(null),f=(0,n.useRef)(null),E=(0,n.useRef)(null),h=[],v=[],y=async t=>{if(null==e.tableName||""===e.tableName)return;if(console.log("LOADING FORM: "+e.tableName),!t.refresh){var l,a;c({type:"START_INITIAL_LOAD",payload:{tableName:e.tableName,data:null!=d.metadata?await g(d.metadata,void 0):void 0,forceIsLoading:null!=(a=null!=(l=t.forceShowLoading)?l:e.forceShowLoading)&&a}})}let n=e.metadata;null==n&&(n=await r.metadata(e.tableName));let i=e.snapshot,o=!1,p=!1,f=!1;if(null==e.snapshot&&null!=t.id||t.refresh){let l=await r.read({tableName:e.tableName,fields:["*"],maxResults:1,page:1,id:t.refresh&&d.metadata?d.snapshot[d.metadata.primaryKey]:t.id});if(null==l||!l.succeeded)return;null==l.data.results||0===l.data.results.length?o=!0:((i=l.data.results[0])._parameters_=l.data.parameters,p=i._ui_info_.canUpdate)}null!=e.snapshot&&(p=e.snapshot._ui_info_.canUpdate);let E=await g(n,i);"NONE"!==(await s.getTablePermissions(r,e.tableName)).create&&(f=!0),null!=e.canUpdate&&!1===e.canUpdate&&(p=!1),null!=e.canCreate&&!1===e.canCreate&&(f=!1),t.refreshDatatables&&await I(),c({type:"INITIAL_LOAD_COMPLETE",payload:{metadata:n,snapshot:i,data:E,canUpdate:p,canCreate:f,canRead:{canRead:!o,message:o?"This record doesn't exist or you are missing the required permissions to access ".concat(e.tableName):""}}}),m.length>0&&(N(m.pop()),u([]))},g=async(t,l)=>{if(void 0!==t){if(void 0===l){var a;return{...await b(t),...null==(a=e.defaults)?void 0:a.reduce((e,t)=>({...e,[t.field]:t.value}),{})}}if(null!=l){let e=Object.keys(l).reduce((e,a)=>(null!==l[a]&&(void 0!==t.fields.find(e=>e.name===a)||["_ui_info_"].includes(a)||a===t.primaryKey)&&(e[a]=l[a]),e),{});return{...await b(t),...e}}}},b=async t=>{let l=t.fields.filter(e=>["Single","Int32","Int64","Double","Decimal","Byte","SByte","UInt32","UInt64","Int16","UInt16"].includes(e.type)).map(e=>({field:e.name,value:e.isNullable?"":0})),a=null==t?void 0:t.fields.filter(e=>e.name!==t.primaryKey).filter(e=>["String","Guid","Char"].includes(e.type)).map(e=>({field:e.name,value:"Char"!==e.type||e.isNullable?"":"A"})),n=null==t?void 0:t.fields.filter(e=>"Boolean"===e.type).map(e=>({field:e.name,value:!1})),r=new Date;r.setUTCHours(0,0,0,0);let s=null==t?void 0:t.fields.filter(e=>"DateTime"===e.type).map(e=>({field:e.name,value:e.isNullable?null:r.toISOString()})),i=null==t?void 0:t.fields.filter(e=>"Lookup"===e.type).map(t=>{var l,a,n;return{field:t.name,value:null!=(n=null==(a=e.defaults)||null==(l=a.find(e=>e.field===t.name))?void 0:l.value)?n:null}});return{...null==l?void 0:l.reduce((e,t)=>({...e,[t.field]:t.value}),{}),...null==a?void 0:a.reduce((e,t)=>({...e,[t.field]:t.value}),{}),...null==n?void 0:n.reduce((e,t)=>({...e,[t.field]:t.value}),{}),...null==s?void 0:s.reduce((e,t)=>({...e,[t.field]:t.value}),{}),...null==i?void 0:i.reduce((e,t)=>({...e,[t.field]:t.value}),{}),_ui_info_:{canUpdate:!0,canDelete:!0}}},N=async(t,l)=>{void 0!==d.metadata?c({type:"SET_DATA_TO_EDIT",payload:{data:await g(d.metadata,t),snapshot:t,...null!=e.canUpdate?{canUpdate:e.canUpdate}:{},forceIsLoading:null!=l&&l}}):u(e=>[...e,t])},I=()=>{for(let e of h)e.refresh()},w=async(t,l,a)=>{var n;let s={...d.data},i={};for(let l of[e.onPreValidate,t,p.current]){if(null==l)continue;let e=await l(s);if(!1===e.continue)return void c({type:"SUBMIT_CANCELLED"});i={...i,...e.parameters}}if(!x())return;for(let t of(c({type:"SET_IS_LOADING"}),[e.onPreSave,l,f.current])){if(null==t)continue;let e=await t(s);if(!1===e.continue)return void c({type:"SUBMIT_CANCELLED"});i={...i,...e.parameters}}let o=await r.execute({url:void 0===d.snapshot?_.Lx:_.I7,method:void 0===d.snapshot?"POST":"PATCH",body:{tableName:null==(n=d.metadata)?void 0:n.tableName,fields:s,parameters:i}}),m=[e.onPostSave,a,E.current];if((null==o?void 0:o.succeeded)===!0)for(let e of m)null!=e&&await e(void 0===d.snapshot?"CREATE":"UPDATE",d.metadata?o.data[d.metadata.primaryKey]:"",o.data);else for(let e of m)null!=e&&await e("FAILED","",{});o.succeeded&&e.keepLoadingOnSuccess?c({type:"SUBMIT_COMPLETE_LOADING"}):c({type:"SUBMIT_COMPLETE"}),I()},C=async e=>{var t;return(await r.execute({url:void 0===d.snapshot?_.Lx:_.I7,method:void 0===d.snapshot?"POST":"PATCH",body:{tableName:null==(t=d.metadata)?void 0:t.tableName,fields:d.data,parameters:e}})).data},x=()=>{var e,t;let l=[];for(let a of null!=(t=null==(e=d.metadata)?void 0:e.fields.filter(e=>{var t;return e.name!==(null==(t=d.metadata)?void 0:t.primaryKey)}))?t:[]){let e=d.data[a.name];if(!["CreatedById","UpdatedById"].includes(a.name)){if(["Single","Int32","Int64","Double","Decimal"].includes(a.type)&&("-"===e||"."===e)){let t='"'.concat(e,'" is not a valid number');l.push({field:a.name,message:t})}if(("Lookup"===a.type||"DateTime"===a.type)&&(!1===a.isNullable||a.isRequired||v.includes(a.name))&&null==e){let e="".concat(a.displayName," is required");l.push({field:a.name,message:e}),console.warn(e)}if((!0===a.isRequired||v.includes(a.name))&&(null==e||""===e)){let e="".concat(a.displayName," is required");l.push({field:a.name,message:e}),console.warn(e)}if("Guid"===a.type&&""!==e&&!i.validate(e)){let e="".concat(a.displayName," is not a valid Id");l.push({field:a.name,message:e}),console.warn(e)}}}return!(l.length>0)||(c({type:"SET_VALIDATION_MESSAGES",payload:l}),!1)},A=async(e,t)=>{await y({id:e,refresh:!1,refreshDatatables:!0,forceShowLoading:t})};return(0,n.useEffect)(()=>{null!=e.tableName&&""!==e.tableName&&y({id:e.id,refresh:!1,refreshDatatables:!1})},[e.tableName,e.id]),(0,n.useEffect)(()=>{d.snapshot!=e.snapshot&&N(e.snapshot)},[e.snapshot]),(0,n.useEffect)(()=>{m.length>0&&"INITIAL_LOAD_COMPLETE"===d.type&&(N(m.pop()),u([]))},[d.type,m]),{metadata:d.metadata,dispatch:c,data:d.data,snapshot:d.snapshot,setSnapshot:N,firstInputRef:o,lookupExclusions:null!=(t=e.lookupExclusions)?t:[],lookupQueries:null!=(l=e.lookupQueries)?l:[],canUpdate:d.canUpdate,canCreate:d.canCreate,canRead:d.canRead,defaults:e.defaults,validationMessages:d.validationMessages,isLoading:d.isLoading||d.forceIsLoading,isSubmitted:d.isSubmitted,operation:null!=e.snapshot||null!=d.snapshot?"UPDATE":"CREATE",stateType:d.type,tableName:e.tableName,onPreValidateRef:p,onPreSaveRef:f,onPostSaveRef:E,reload:async function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];d.metadata&&d.snapshot&&await y({id:d.snapshot[d.metadata.primaryKey],refresh:!0,refreshDatatables:e})},setField:(e,t)=>{var l;let a=null==(l=d.metadata)?void 0:l.fields.find(t=>t.name===e);if(null==a)throw Error("Field ".concat(e," doesn't exist on ").concat(d.tableName));if(!a.isNullable&&null===t)throw Error("Field ".concat(e," cannot be null"));c({type:"SET_FIELD_VALUE",payload:{field:e,value:t}})},setFieldError:(e,t)=>{c({type:"SET_VALIDATION_MESSAGE",payload:{field:e,message:t}})},isDirty:e=>null==e?d.dirtyFields.length>0:d.dirtyFields.includes(e),addDataTable:e=>{null!=h.find(t=>t.dataTableId===e.dataTableId)&&(h=h.filter(t=>t.dataTableId!==e.dataTableId)),h.push(e)},addRequiredField:e=>{v.includes(e)||v.push(e)},removeRequiredField:e=>{v=v.filter(t=>t!==e)},reloadDataTables:I,save:w,saveSilent:C,load:A,clearEdits:()=>{c({type:"CLEAR_EDIT_DATA"})},clear:()=>{c({type:"CLEAR"})},validate:x,setShowForceLoading:e=>{c({type:"SET_FORCE_LOADING",payload:{forceIsLoading:e}})}}})({tableName:null!=(r=null==(l=o.state.metadata)?void 0:l.tableName)?r:"",id:o.state.editRecordId,metadata:o.state.metadata,defaults:o.props.formFieldDefaults,lookupExclusions:o.props.formLookupExclusions,lookupQueries:o.props.formLookupQueries,canCreate:"NONE"!==o.state.permissions.create,canUpdate:o.props.canUpdate,onPreSave:async e=>(!0===o.props.formCloseOnCreate||o.props.formCloseOnCreate,null!=o.props.formOnPreSave&&o.props.formOnPreSave(e),{continue:!0}),onPostSave:async(e,t,l)=>{if("FAILED"===e);else if("CREATE"===e&&!1===o.props.formCloseOnCreate&&d.setSnapshot(l),"UPDATE"===e&&!1===o.props.formCloseOnUpdate&&d.setSnapshot(l),null!=o.props.formOnPostSave&&o.props.formOnPostSave(e,d.data),"CREATE"===e&&(!0===o.props.formCloseOnCreate||void 0===o.props.formCloseOnCreate)||"UPDATE"===e&&(!0===o.props.formCloseOnUpdate||void 0===o.props.formCloseOnUpdate)){var a,n;o.closeForm(),o.getData({...m,page:null==(a=o.state.data)?void 0:a.currentPage,orderBy:null==(n=o.state.data)?void 0:n.orderBy,setData:!0})}}});(0,n.useImperativeHandle)(t,()=>({formBuilder:d}));let u=!0!==o.props.formHideSaveButton&&(void 0!==d.snapshot&&!0===d.canUpdate||void 0===d.snapshot&&!0===d.canCreate);return n.createElement(n.Fragment,null,n.createElement(O.a,{opened:"START_INITIAL_LOAD"===d.stateType,onClose:()=>{},withCloseButton:!1,size:"auto",closeOnClickOutside:!1,closeOnEscape:!1,overlayProps:{blur:3},styles:{content:{display:"none"}},centered:!0}),n.createElement(O.a,{title:(()=>{var e;if(null!=o.props.formTitle)return o.props.formTitle;let t="";"UPDATE"===d.operation&&null!=d.data&&!0===d.data._ui_info_.canUpdate&&(t="Edit"),"CREATE"===d.operation&&"NONE"!==o.state.permissions.create&&(t="Create");let l=void 0===o.state.metadata?o.props.tableName:null==(e=o.state.metadata)?void 0:e.displayName;return""!==t?"".concat(t," ").concat(l):l})(),opened:o.formDisclosure.opened&&null!=d.metadata&&"START_INITIAL_LOAD"!==d.stateType,onClose:()=>{if(null!=o.props.formOnClose&&o.props.formOnClose(),d.isSubmitted){var e,t;o.closeForm(),o.getData({...m,page:null==(e=o.state.data)?void 0:e.currentPage,orderBy:null==(t=o.state.data)?void 0:t.orderBy,setData:!0})}else o.formDisclosure.close()},transitionProps:{transition:"fade",duration:100},closeOnClickOutside:!1,closeOnEscape:null==(s=o.props.formCloseOnEscape)||s,size:(()=>{if(null!=o.props.formMaxWidth)return"".concat(o.props.formMaxWidth,"rem");if(void 0!==o.state.metadata){let e=o.state.metadata.fields.filter(e=>{var t;return(null==(t=o.state.metadata)?void 0:t.primaryKey)!==e.name&&(void 0===o.props.formFields||o.props.formFields.includes(e.name))});if(e.length<=3){let t=e.length/3*72;return void 0!==o.props.formMaxWidth&&t<o.props.formMaxWidth?"".concat(o.props.formMaxWidth,"rem"):null!=o.props.formMinWidth&&t<o.props.formMinWidth?"".concat(o.props.formMinWidth,"rem"):"".concat(t,"rem")}}return void 0!==o.props.formMaxWidth&&o.props.formMaxWidth>72?"".concat(o.props.formMaxWidth,"rem"):"72rem"})(),overlayProps:{blur:3},fullScreen:null!=(i=o.props.formFullScreen)&&i,styles:{root:{overflow:"visible"},body:{...!0===d.isLoading&&{position:"relative",overflow:"hidden",paddingLeft:0,paddingRight:0},flexGrow:1},content:{display:"flex",flexDirection:"column"}},centered:!0},n.createElement(ee,{formBuilder:d,className:o.props.formClassNames},void 0!==o.props.customForm?o.props.customForm(d,o.formDisclosure):void 0!==o.state.metadata&&(void 0!==o.props.formFields?o.props.formFields:o.state.metadata.fields.filter(e=>{var t;return e.name!==(null==(t=o.state.metadata)?void 0:t.primaryKey)})).map((e,t)=>{if(t%3==0){var l,a;return n.createElement(G.x,{key:t},void 0!==o.state.metadata&&(null==(l=void 0!==o.props.formFields?o.props.formFields:null==(a=o.state.metadata)?void 0:a.fields.filter(e=>{var t;return e.name!==(null==(t=o.state.metadata)?void 0:t.primaryKey)}).map(e=>e.name))?void 0:l.slice(t,t+3).map((e,l)=>{var a;let r=null==(a=o.state.metadata)?void 0:a.fields.find(t=>t.name===e);return void 0===r?("function"!=typeof e&&"object"!=typeof e&&console.warn("Couldn't find field named ".concat(e,".")),n.createElement("div",{key:"".concat(t).concat(l),className:"hidden"})):("function"==typeof e&&"".concat(t).concat(l),n.createElement(G.x.Col,{key:"".concat(r.name).concat(t).concat(l,"}"),span:(()=>{if(void 0!==o.state.metadata){let e=o.state.metadata.fields.filter(e=>{var t;return e.name!==(null==(t=o.state.metadata)?void 0:t.primaryKey)}).filter(e=>void 0===o.props.formFields||o.props.formFields.includes(e.name));if(e.length<=3)return 12/e.length}return 4})()},n.createElement(q.A,{focus:0===t&&0===l,name:r.name})))})))}return n.createElement("div",{key:t,className:"hidden"})}),void 0!==o.props.appendCustomForm?n.createElement("div",{className:"mt-2"},o.props.appendCustomForm(d)):n.createElement(n.Fragment,null),null==o.props.customForm&&n.createElement("div",{className:"w-full flex justify-end ".concat(null!=o.props.formAppendButton||u?"mt-3":"")},null!=o.props.formAppendButton?n.createElement(n.Fragment,null,o.props.formAppendButton(d)):n.createElement(n.Fragment,null),!0!==o.props.formHideSaveButton&&(void 0!==d.snapshot&&!0===d.canUpdate||void 0===d.snapshot&&!0===d.canCreate)?n.createElement("div",null,n.createElement(Q.A,null)):n.createElement(n.Fragment,null)))))});et.displayName="DataForm";let el={type:"START_INITIAL_LOAD",id:"",isLoadingData:!0,permissions:{read:"NONE",create:"NONE",delete:"NONE",update:"NONE"},isTableNotFound:!1,isFormOpen:!1,metadata:void 0,joinMetadata:[],data:{pages:0,currentPage:1,totalResults:0,orderBy:[],tableName:"",maxResults:10,results:[],parameters:{}},searchField:"",searchValue:"",activeSwitch:"Active",editRecordId:null,visibleFields:void 0},ea=(e,t)=>{switch(console.log("DataTable: "+t.type),t.type){case"START_INITIAL_LOAD":return{...el,isLoadingData:!0,visibleFields:e.visibleFields,type:"START_INITIAL_LOAD"};case"MISSING_READ_PERMISSIONS":return{...el,isLoadingData:!1,permissions:{...e.permissions,read:"NONE"},type:"MISSING_READ_PERMISSIONS"};case"TABLE_NOT_FOUND":return{...el,isLoadingData:!1,isTableNotFound:!0,type:"TABLE_NOT_FOUND"};case"INITIAL_LOAD_COMPLETE":return{...el,...t.payload,editRecordId:e.editRecordId,type:e.editRecordId?"OPEN_FORM":"INITIAL_LOAD_COMPLETE",visibleFields:e.visibleFields};case"SET_IS_LOADING":return{...e,isLoadingData:!0,type:"SET_IS_LOADING"};case"SET_DONE_LOADING":return{...e,isLoadingData:!1,data:t.payload,type:"SET_DONE_LOADING"};case"SEARCH_VALUE_CHANGE":return{...e,searchValue:t.payload.searchValue,searchField:t.payload.searchField,data:t.payload.data,type:"SEARCH_VALUE_CHANGE"};case"ACTIVE_SWITCH_CHANGE":return{...e,activeSwitch:t.payload.activeSwitch,type:"ACTIVE_SWITCH_CHANGE"};case"SET_METADATA":return{...e,metadata:t.payload.metadata,joinMetadata:t.payload.joinMetadata,type:"SET_METADATA"};case"SET_DATA":return{...e,data:{...e.data,results:t.payload.setDataFunction(e.data.results)},type:"SET_DATA"};case"OPEN_FORM":var l;return{...e,isFormOpen:!0,editRecordId:t.payload.editRecordId,formTableName:null==(l=e.metadata)?void 0:l.tableName,type:"OPEN_FORM"};case"CLOSE_FORM":return{...e,isFormOpen:!1,editRecordId:void 0,formTableName:void 0,type:"CLOSE_FORM"};case"SET_VISIBLE_FIELDS":return{...e,visibleFields:t.payload.visibleFields,type:"SET_VISIBLE_FIELDS"}}return{...e,...t.payload}};var en=l(7544),er=l(9296),es=l(9601),ei=l(2702),eo=l(336),ed=l(6707);let ec=e=>{var t,l,r,i,o;let d=(0,a.A)(),m=(0,n.useContext)(en.BR),u=c(),p=(0,g.xd)(),{colorScheme:f,toggleColorScheme:h}=(0,b.C)(),v=null!=e.record.IsActive&&!0===e.record.IsActive,y="dark"===f?p.colors[p.primaryColor][p.primaryShade-3]:p.colors[p.primaryColor][p.primaryShade],N=!0===e.record._ui_info_.canDelete&&(void 0===u.props.canDelete||!0===u.props.canDelete),I=!0===e.record._ui_info_.canUpdate&&(null==(t=u.state.metadata)?void 0:t.fields.find(e=>"IsActive"===e.name))!=null&&!0===u.props.canDeactivate,w=async e=>{var t,l,a,n;let r=e[null!=(l=null==(t=u.state.metadata)?void 0:t.primaryKey)?l:""];if(void 0===u.props.confirmDelete||!0===u.props.confirmDelete){let t="Confirm",l="Are you sure you want to delete this record?",s=!0;if(null!=u.props.deleteConfirmation){let r=await u.props.deleteConfirmation(e);t=null!=(a=r.title)?a:t,l=null!=(n=r.message)?n:l,s=void 0===r.showPrompt||r.showPrompt}s?null==m||m.showConfirm(l,async()=>{await A(e,u.props.tableName,r)},()=>{},t):await A(e,u.props.tableName,r)}else await A(e,u.props.tableName,r)},C=async e=>{var t,l;let a=e[null!=(l=null==(t=u.state.metadata)?void 0:t.primaryKey)?l:""];await x(u.props.tableName,a,!v)},x=async(e,t,l)=>{u.dispatch({type:"SET_IS_LOADING"}),await d.update(e,{["".concat(u.props.tableName,"Id")]:t,IsActive:l}),await u.refresh()},A=async(e,t,l)=>{u.dispatch({type:"SET_IS_LOADING"}),await d.delete(t,l),null!=u.props.onPostDelete&&u.props.onPostDelete(e),await u.refresh()},T="";if(null!=e.fieldInfo.metadataField){let t="".concat(e.fieldInfo.alias).concat(""!==e.fieldInfo.alias?".":"").concat(e.fieldInfo.metadataField.name);void 0!==e.record[e.fieldInfo.metadataField.lookupName]?T=e.record[e.fieldInfo.metadataField.lookupName]:void 0!==e.record[t]&&(T=((t,l)=>{if("Boolean"===t)return l?"Yes":"No";if("DateTime"===t){var a;if(null==l||"0001-01-01T00:00:00"===l)return"";if((null==(a=e.fieldInfo.metadataField)?void 0:a.dateFormat)!=null)if((0,E.PS)(e.fieldInfo.metadataField.dateFormat))return ed(Date.parse(l)).format(e.fieldInfo.metadataField.dateFormat);else return ed(l.replace("Z","").split("T")[0]).format(e.fieldInfo.metadataField.dateFormat);let t=new Date(l.replace("Z","")),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),s=t.getFullYear();return"".concat(n,"/").concat(r,"/").concat(s)}return l})(e.fieldInfo.metadataField.type,e.record[t]))}return n.createElement(s.X.Td,{className:"".concat((null==(l=u.props.tableStyle)?void 0:l.truncate)===!0||(null==(r=u.props.tableStyle)?void 0:r.truncate)==null?"truncate":""," cursor-pointer relative ").concat(e.fieldInfo.width.endsWith("px")?"flex-none":""),style:{width:e.fieldInfo.width,height:(null==(i=u.props.tableStyle)?void 0:i.truncate)===!0||(null==(o=u.props.tableStyle)?void 0:o.truncate)==null?"36.7px":""}},null!=e.fieldInfo.body?e.fieldInfo.body(e.record,u.refHandle):T,(I||N)&&n.createElement(e=>{let{children:t}=e;return n.createElement("div",{className:"absolute right-0 top-0 bottom-0 flex items-center cursor-pointer xams_delete"},n.createElement("div",{className:"flex items-center p-0.5 rounded gap-1",style:{backgroundColor:"dark"===f?p.colors.gray[p.primaryShade+2]:p.colors.gray[p.primaryShade-5]}},t))},null,n.createElement(n.Fragment,null,I&&n.createElement(e=>{let{record:t}=e;return v?n.createElement(eo.m,{label:"Deactivate",withArrow:!0},n.createElement(es.A,{onClick:e=>{e.stopPropagation(),C(t)},size:26,strokeWidth:2,color:y})):n.createElement(eo.m,{label:"Activate",withArrow:!0},n.createElement(ei.A,{onClick:e=>{e.stopPropagation(),C(t)},size:26,strokeWidth:2,color:y}))},{record:e.record}),N&&n.createElement(e=>{let{record:t}=e;return n.createElement(eo.m,{label:"Delete",withArrow:!0},n.createElement(er.A,{onClick:e=>{e.stopPropagation(),w(t)},size:26,strokeWidth:2,color:y}))},{record:e.record}))))},em=()=>{var e;let t=c();return n.createElement(n.Fragment,null,!1===t.state.isLoadingData&&(null==(e=t.state.data)?void 0:e.results)!=null&&t.state.data.results.filter(e=>{var l;return t.props.tableName===(null==(l=t.state.metadata)?void 0:l.tableName)}).map((e,l)=>void 0!==t.props.customRow?n.createElement(s.X.Tr,{key:t.state.metadata?e[t.state.metadata.primaryKey]:l,className:"w-full"},t.props.customRow(e)):n.createElement(s.X.Tr,{key:t.state.metadata?e[t.state.metadata.primaryKey]:l,className:"flex relative items-start",onClick:()=>{t.openForm(e),null!=t.props.formOnOpen&&t.props.formOnOpen("UPDATE",e)}},t.getFields().map((a,r)=>{let s="".concat(t.state.metadata?e[t.state.metadata.primaryKey]:l,"-").concat(r);return n.createElement(ec,{key:s,record:e,fieldInfo:a})}))))},eu=(0,n.forwardRef)((e,t)=>{let l=(0,a.A)(),r=(0,n.useContext)(Z.cK),s=P(),i=$(),o=(0,n.useRef)(null),[c,u]=(0,n.useState)(i.get()),[p,f]=(0,n.useReducer)(ea,{...el,id:c}),h=(0,n.useRef)(!1),v=(0,n.useRef)(p);if(null!=e.fields&&null!=e.columnWidths&&e.fields.length!==e.columnWidths.length)throw Error("Fields and columnWidths must be the same length in DataTable");let y=async()=>{f({type:"START_INITIAL_LOAD"});let t=null!=p.metadata&&p.metadata.tableName===e.tableName?p.metadata:await l.metadata(e.tableName),a=[];if(null!=e.joins)for(let t of e.joins){let e=await l.metadata(t.toTable);null!=e&&a.push(e)}if(null==t)return void f({type:"TABLE_NOT_FOUND"});if(e.disabledMessage)return void f({type:"SET_METADATA",payload:{metadata:t,joinMetadata:a}});let n=await s.getTablePermissions(l,e.tableName);if("NONE"===n.read)return void f({type:"MISSING_READ_PERMISSIONS"});let r=await N({...m,metadata:t,joinMetadata:a,fields:g(t),page:1,active:!0===e.showActiveSwitch||null,orderBy:e.orderBy,searchField:"",searchValue:""});(null==r?void 0:r.succeeded)&&(b(t),null!=e.onInitialLoad&&e.onInitialLoad(r.data.results),f({type:"INITIAL_LOAD_COMPLETE",payload:{permissions:n,metadata:t,joinMetadata:a,data:r.data,isLoadingData:!1,activeSwitch:!0===e.showActiveSwitch?"Active":null}}))},g=t=>{var l,a;let n=2*t.fields.filter(e=>null!=e.lookupName&&""!==e.lookupName).length+t.fields.filter(e=>null==e.lookupName||""===e.lookupName).length,r=null!=(a=e.fields)?a:t.fields.map(e=>e.name).slice(0,n+1);return null!=p.visibleFields&&(null==(l=p.visibleFields)?void 0:l.length)>0&&(r=p.visibleFields),r},b=t=>{void 0!==e.fields&&e.fields.forEach(l=>{"function"!=typeof l&&(void 0!==t.fields.find(e=>e.name===l)||l===e.tableName+"Id"||"object"==typeof l||l.includes(".")||console.warn("Field ".concat(l," not found in metadata for table ").concat(e.tableName)))})},N=async t=>{var a,n,r,s,i,o,d,c,m,u,E,h,v,y,b;(null==t?void 0:t.setData)!=null&&!0===t.setData&&!1===p.isLoadingData&&(null==t.showLoading||!0===t.showLoading)&&f({type:"SET_IS_LOADING"});let N=null!=(s=null!=(r=null==t?void 0:t.metadata)?r:p.metadata)?s:await l.metadata(e.tableName),I=[];0===(I=null!=(o=null==(a=null!=(i=p.visibleFields)?i:e.fields)?void 0:a.filter(e=>"string"==typeof e&&!e.includes(".")))?o:[]).length&&(I=null!=(c=null==t||null==(d=t.fields)?void 0:d.filter(e=>"string"==typeof e&&!e.includes(".")))?c:[]),0===I.length&&(I=g(N));let w=[];if(null==I||I.forEach(e=>{if(e.endsWith("Id")){let t=null==N?void 0:N.fields.find(t=>t.name===e);(null==t?void 0:t.type)==="Lookup"&&void 0===I.find(e=>e===t.lookupName)&&w.push(t.lookupName)}}),null==I||I.push(...w),null!=e.additionalFields)for(let t of e.additionalFields)void 0===I.find(e=>e===t)&&I.push(t);N&&(null==I?void 0:I.find(e=>e===N.primaryKey))===void 0&&(null==I||I.push(N.primaryKey)),e.canDeactivate&&void 0===I.find(e=>"IsActive"===e)&&(null==N?void 0:N.fields.find(e=>"IsActive"===e.name))!==void 0&&I.push("IsActive");let C=await l.read({tableName:e.tableName,page:null==t?1:t.page,fields:I,maxResults:null!=(m=e.maxResults)?m:10,except:e.except,orderBy:null!=(E=null!=(u=null==t?void 0:t.orderBy)?u:null==(n=p.data)?void 0:n.orderBy)?E:[],filters:[{field:null==t?"":null!=(v=null!=(h=t.searchField)?h:p.searchField)?v:"",value:null==t?"":null!=(b=null!=(y=t.searchValue)?y:p.searchValue)?b:""},...!0===e.showActiveSwitch&&N.fields.find(e=>"IsActive"===e.name)?[{field:"IsActive",operator:"==",value:(null==t?void 0:t.active)!=null?null==t?void 0:t.active.toString():"Active"===p.activeSwitch?"true":"false"}]:[],...void 0!==e.filters?e.filters.map(e=>({field:e.field,operator:e.operator,value:e.value})):[]],joins:void 0!==e.joins?e.joins:[]});return(null==t?void 0:t.setData)!=null&&!0===t.setData&&f({type:"SET_DONE_LOADING",payload:C.data}),null!=e.onDataLoaded&&e.onDataLoaded(C.data),C},I=async t=>{if(null==e.disabledMessage){var l,a;let n=null==(l=v.current.data)?void 0:l.orderBy;(null==n||0===n.length)&&(n=null!=(a=e.orderBy)?a:[]),await N({...m,page:v.current.data.currentPage,showLoading:t,searchField:v.current.searchField,searchValue:v.current.searchValue,orderBy:n,active:"Active"===v.current.activeSwitch,setData:!0})}},w=t=>null!=e.columnWidths&&e.columnWidths.length>=t?e.columnWidths[t]:"100%",C=function(t){let l=!(arguments.length>1)||void 0===arguments[1]||arguments[1];(void 0===e.onRowClick||!0!==l||!1!==e.onRowClick(t))&&f({type:"OPEN_FORM",payload:{editRecordId:null!=t&&p.metadata?t[p.metadata.primaryKey]:null}})},x=()=>{f({type:"CLOSE_FORM"})},A=async e=>{null!=p.data.orderBy&&p.data.orderBy.length>0&&p.data.orderBy[0].field===e&&"asc"===p.data.orderBy[0].order?N({...m,page:p.data.currentPage,orderBy:[{field:e,order:"desc"}],setData:!0}):N({...m,page:p.data.currentPage,orderBy:[{field:e,order:"asc"}],setData:!0})};(0,n.useEffect)(()=>{v.current=p},[p.data]),(0,n.useEffect)(()=>{void 0!==e.tableName&&y()},[e.tableName,e.disabledMessage,p.visibleFields]),(0,n.useEffect)(()=>{if(null!=e.refreshInterval){let t=setInterval(async()=>{!1===h.current&&(h.current=!0,await I(!1),h.current=!1)},e.refreshInterval);return()=>{h.current=!1,clearInterval(t)}}},[e.refreshInterval]);let T={refresh:I,openForm:e=>C(e,!1),dataTableId:c,getRecords:()=>{var e;return null==(e=p.data)?void 0:e.results},setRecords:e=>{f({type:"SET_DATA",payload:{setDataFunction:e}})},showLoading:()=>{f({type:"SET_IS_LOADING"})},sort:A,Metadata:p.metadata};return(null!=r&&r.formBuilder.addDataTable(T),(0,n.useImperativeHandle)(t,()=>T),!0===p.isTableNotFound)?n.createElement("div",{className:"w-full h-full flex justify-center items-center"},"Table not found."):n.createElement(d.Provider,{value:{props:e,state:p,refHandle:T,dispatch:f,openForm:C,closeForm:x,refresh:I,formDisclosure:{opened:p.isFormOpen,close:x},getData:N,getFields:()=>{if(null!=p.visibleFields)return p.visibleFields.map((e,t)=>{var l;let a=null==(l=p.metadata)?void 0:l.fields.find(t=>t.name===e);return null==a?null:{displayName:null==a?void 0:a.displayName,metadataField:a,body:null,width:"100%",alias:""}}).filter(E.Pe);if(null!=e.fields&&null!=p.metadata)return e.fields.filter(e=>{var t;return e!==(null==(t=p.metadata)?void 0:t.primaryKey)}).map((t,l)=>{if("string"==typeof t){let n=t,r=p.metadata,s="";if(t.includes(".")){var a;let l=t.split(".");s=l[0],n=l[1];let i=null==(a=e.joins)?void 0:a.find(e=>e.alias===s);null!=i&&(r=p.joinMetadata.find(e=>e.tableName===i.toTable))}let i=null==r?void 0:r.fields.find(e=>e.name===n);return null==i?null:{displayName:n,metadataField:i,body:null,width:w(l),alias:s}}return"object"==typeof t?{displayName:t.header,body:t.body,width:w(l),alias:""}:null}).filter(E.Pe);if(null==e.fields&&null!=p.metadata){var t;return null==(t=p.metadata)?void 0:t.fields.filter(e=>{var t;return e.name!==(null==(t=p.metadata)?void 0:t.primaryKey)}).map((e,t)=>t<=6?{displayName:e.name,metadataField:e,body:null,width:w(t),alias:""}:null).filter(E.Pe)}return[]},sort:A}},p.isFormOpen&&n.createElement(et,{ref:o}),p.data&&n.createElement(H,null,n.createElement(em,null)))});eu.displayName="DataTable"}},e=>{e.O(0,[31,352,846,991,255,593,792],()=>e(e.s=8002)),_N_E=e.O()}]);