"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[93],{1331:function(e,a,t){t.d(a,{BR:function(){return i},F:function(){return o},QC:function(){return s},TO:function(){return l},Vx:function(){return n},bZ:function(){return u},k0:function(){return c},ku:function(){return r},mH:function(){return m},sy:function(){return d}});let l="/data/Permissions",i="/data/MetaData",n="/data/Create",r="/data/Read",d="/data/Update",s="/data/Delete",o="/data/Upsert",u="/data/Bulk",c="/data/Action",m="/data/File"},2063:function(e,a,t){var l=t(4246),i=t(7378),n=t(2370),r=t(386),d=t(3529),s=t(2053),o=t(174),u=t(8971),c=t(4323);let m=i.lazy(()=>Promise.all([t.e(345),t.e(608),t.e(68)]).then(t.bind(t,871))),f=i.lazy(()=>Promise.all([t.e(698),t.e(642)]).then(t.bind(t,8642)));a.Z=e=>{var a,t,i,h,p,v,y,g,b,E,T,_;let N=(0,c.Gc)(),A=null===(a=N.formBuilder.metadata)||void 0===a?void 0:a.fields.find(a=>a.name===e.name),I=(0,u.Z)();if(null==N.formBuilder.metadata)return(0,l.jsx)(l.Fragment,{});if(null==A)throw Error("Field ".concat(e.name," not found on ").concat(N.formBuilder.metadata.tableName," metadata."));e.required?N.formBuilder.addRequiredField(A.name):N.formBuilder.removeRequiredField(A.name);let L=A.isReadOnly||e.readOnly,S=(e,a)=>{let t=!1,l=e.name,i=e.type,n=e.isNullable;!n&&["Single","Int32","Int64","Double","Decimal"].includes(i)?("-"===a&&(t=!0),"0-"===a&&(a="-0"),"-00"===a&&(a="-0"),"."===a&&(t=!0),/^-0[1-9]$/.test(a)&&(a=a.replace("0",""))):n&&("-"===a||"."===a)&&["Single","Int32","Int64","Double","Decimal"].includes(i)&&(t=!0),("String"===i||"Guid"===i)&&(e.characterLimit&&(a.length<=e.characterLimit||(a=a.substring(0,e.characterLimit))),t=!0),"Single"===i&&(a=a.replace("Infinity","").replace("-Infinity","").replace("NaN",""),/^-?(\d+(\.\d*)?|\.\d+)$/.test(a)&&(t=!0)),"Int32"===i&&/^-?(?:[0-9]{1,10}|[1-9][0-9]{0,8}|[12][0-9]{9}|20[0-9]{8}|21[0-4][0-9]{7}|214[0-6][0-9]{6}|2147[0-3][0-9]{5}|214748[0-2][0-9]{4}|2147483[0-5][0-9]{3}|21474836[0-3][0-9]{2}|214748364[0-7])$/.test(a)&&(t=!0),"Int64"===i&&/^-?(?:[0-9]{1,19}|[1-8][0-9]{0,18}|[9][0-1][0-9]{0,17}|92[0-1][0-9]{0,16}|922[0-2][0-9]{0,15}|9223[0-2][0-9]{0,14}|92233[0-6][0-9]{0,13}|922337[0-1][0-9]{0,12}|92233720[0-2][0-9]{0,10}|922337203[0-5][0-9]{0,9}|9223372036[0-4][0-9]{0,8}|92233720367[0-4][0-9]{0,7}|922337203685[0-3][0-9]{0,6}|9223372036854[0-6][0-9]{0,5}|92233720368547[0-4][0-9]{0,4}|922337203685477[0-4][0-9]{0,3}|9223372036854775[0-7][0-9]{0,2}|922337203685477580[0-7])$/.test(a)&&(t=!0),"Double"===i&&(a=a.replace("Infinity","").replace("-Infinity","").replace("NaN",""),/^-?(\d+(\.\d*)?|\.\d+)$/.test(a)&&(t=!0)),"Decimal"===i&&/^-?(\d+(\.\d*)?|\.\d+)$/.test(a)&&(t=!0),["Single","Int32","Int64","Double","Decimal"].includes(i)?(n&&"-"===a&&(t=!0),!0===n&&""===a?B(l,""):!1===n&&""===a?B(l,"0"):t&&B(l,a.startsWith("0")?a.substring(1,a.length):a)):t&&B(l,a)},B=function(a,t){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;N.formBuilder.dispatch({type:"SET_FIELD_VALUE",payload:{field:a,value:t}}),null!=e.onChange&&((null==A?void 0:A.type)==="Lookup"?e.onChange(t,l):e.onChange(t))};if(null==A||void 0===N.formBuilder.data||void 0===N.formBuilder.data[A.name])return(0,l.jsx)(l.Fragment,{});let D=a=>{let{field:t}=a;return(0,l.jsxs)(l.Fragment,{children:[null!=e.label?e.label:t.displayName," ",!0===t.isRecommended?(0,l.jsx)(n.u,{label:"Recommended",withArrow:!0,children:(0,l.jsx)("span",{className:" text-blue-600",children:"+"})}):(0,l.jsx)(l.Fragment,{})]})};return(0,l.jsxs)(l.Fragment,{children:["Lookup"===A.type&&(0,l.jsx)(f,{label:(0,l.jsx)(D,{field:A}),className:!1===N.formBuilder.canRead.canRead?"invisible":"",metaDataField:A,owningTableName:null===(t=N.formBuilder.metadata)||void 0===t?void 0:t.tableName,ref:!0===e.focus?N.formBuilder.firstInputRef:void 0,onChange:a=>{B(A.name,null==a?void 0:a.id,null==a?void 0:a.value),null!=e.onChange&&e.onChange(null==a?void 0:a.id,null==a?void 0:a.label)},onBlur:e.onBlur,defaultLabelValue:void 0!==N.formBuilder.snapshot?(T=N.formBuilder.snapshot[A.lookupName],_=N.formBuilder.snapshot[A.name],null==T&&null!=_?{label:_,value:_}:null!=T&&null!=_?{label:T,value:_}:void 0):((e,a)=>{var t;if(void 0!==(null===(t=N.formBuilder.defaults)||void 0===t?void 0:t.find(a=>a.field===e)))return I.lookups.find(t=>t.fieldName===e&&t.lookupTable===a)})(A.name,A.lookupTable),value:N.formBuilder.data[A.name],excludeValues:null===(h=N.formBuilder.lookupExclusions)||void 0===h?void 0:null===(i=h.find(e=>e.fieldName===A.name))||void 0===i?void 0:i.values,query:null===(p=N.formBuilder.lookupQueries)||void 0===p?void 0:p.find(e=>e.field===A.name),readOnly:["CreatedById","UpdatedById"].includes(A.name)||!1===N.formBuilder.canUpdate&&void 0!==N.formBuilder.snapshot||["OwningUserId","OwningTeamId"].includes(A.name)&&void 0!==N.formBuilder.snapshot&&!1===N.formBuilder.snapshot._ui_info_.canAssign||L,required:!1===A.isNullable&&!["CreatedById","UpdatedById"].includes(A.name)||!0===A.isRequired||!0===e.required,error:null===(v=N.formBuilder.validationMessages.find(e=>e.field===A.name))||void 0===v?void 0:v.message,disabled:e.disabled}),"String"===A.type&&"rich"===e.varient&&(0,l.jsx)(m,{value:N.formBuilder.data[A.name],onChange:e=>{S(A,e)}}),"String"===A.type&&"textarea"===e.varient&&(0,l.jsx)(r.g,{styles:{root:{height:"100%",display:"flex",flexDirection:"column"},wrapper:{flexGrow:1},input:{height:"100%"}},label:(0,l.jsx)(D,{field:A}),placeholder:e.placeholder,value:N.formBuilder.data[A.name],required:!0===A.isRequired||!0===e.required,onChange:e=>{S(A,e.currentTarget.value)},onBlur:e.onBlur,readOnly:!1===N.formBuilder.canUpdate&&void 0!==N.formBuilder.snapshot||L,error:null===(y=N.formBuilder.validationMessages.find(e=>e.field===A.name))||void 0===y?void 0:y.message,disabled:e.disabled}),["String","Guid","Int32","Single","Int64","Double","Decimal"].includes(A.type)&&null==e.varient&&null!=N.formBuilder.data[A.name]&&(0,l.jsx)(d.o,{label:(0,l.jsx)(D,{field:A}),ref:!0===e.focus?N.formBuilder.firstInputRef:void 0,value:N.formBuilder.data[A.name],onChange:e=>{S(A,e.currentTarget.value)},onBlur:e.onBlur,readOnly:!1===N.formBuilder.canUpdate&&void 0!==N.formBuilder.snapshot||L,error:null===(g=N.formBuilder.validationMessages.find(e=>e.field===A.name))||void 0===g?void 0:g.message,required:!0===A.isRequired||!0===e.required,placeholder:e.placeholder,disabled:e.disabled}),"DateTime"===A.type&&(0,l.jsx)(o.W,{ref:!0===e.focus?N.formBuilder.firstInputRef:void 0,label:(0,l.jsx)(D,{field:A}),...null!=A.dateFormat&&""!==A.dateFormat?{valueFormat:A.dateFormat}:{},value:void 0!==N.formBuilder.data&&void 0!==N.formBuilder.data[A.name]&&null!==N.formBuilder.data[A.name]&&"0001-01-01T00:00:00"!==N.formBuilder.data[A.name]?new Date(N.formBuilder.data[A.name].replace("Z","")):null,onChange:e=>{null==e||e.setUTCHours(0,0,0,0),B(A.name,null==e?null:null==e?void 0:e.toISOString().replace("Z",""))},onBlur:e.onBlur,clearable:A.isNullable,readOnly:["CreatedDate","UpdatedDate"].includes(A.name)||void 0!==N.formBuilder.snapshot&&!1===N.formBuilder.canUpdate||L,required:!0===A.isRequired||e.required,error:null===(b=N.formBuilder.validationMessages.find(e=>e.field===A.name))||void 0===b?void 0:b.message,...e.dateInput,disabled:e.disabled}),"Boolean"===A.type&&(0,l.jsx)("div",{className:"w-full h-full flex items-end",children:(0,l.jsx)("div",{className:"w-full h-9 flex items-center",children:(0,l.jsx)(s.X,{ref:!0===e.focus?N.formBuilder.firstInputRef:void 0,label:(0,l.jsx)(D,{field:A}),checked:void 0!==N.formBuilder.data&&void 0!==N.formBuilder.data[A.name]&&null!==N.formBuilder.data[A.name]?N.formBuilder.data[A.name]:void 0,onChange:a=>{void 0!==N.formBuilder.snapshot&&!1===N.formBuilder.canUpdate||L||B(A.name,a.currentTarget.checked),null!=e.onChange&&e.onChange(a.currentTarget.checked)},onBlur:e.onBlur,readOnly:void 0!==N.formBuilder.snapshot&&!1===N.formBuilder.canUpdate||L,error:null===(E=N.formBuilder.validationMessages.find(e=>e.field===A.name))||void 0===E?void 0:E.message,required:!0===A.isRequired||e.required,disabled:e.disabled})})})]})}},9803:function(e,a,t){var l=t(4246);t(7378);var i=t(7628),n=t(4323);a.Z=e=>{let a=(()=>{if(!0===e.formBuilder.isLoading)return!0;if(void 0!==e.formBuilder&&void 0!==e.formBuilder.metadata&&void 0!==e.formBuilder.data){for(let a of e.formBuilder.metadata.fields)if(void 0===e.formBuilder.data[a.name])return console.warn("No data for field: "+a.name+". Ensure lookup fields are spelled correctly."),!0}return!1})()||!0===e.showLoading;return(0,l.jsx)(n.ZP,{formBuilder:e.formBuilder,children:(0,l.jsxs)("div",{className:"".concat(!a&&!0!==e.showLoading&&e.formBuilder.canRead.canRead&&e.formBuilder.canCreate?"":"relative overflow-hidden"," ").concat(e.className),children:[a&&(0,l.jsx)("div",{className:"absolute w-full h-full flex justify-center items-center",style:{zIndex:4e3},children:(0,l.jsx)(i.a,{})}),!a&&!1===e.formBuilder.canRead.canRead&&(0,l.jsx)("div",{className:"absolute w-full h-full flex justify-center items-center text-center",style:{zIndex:10},children:e.formBuilder.canRead.message}),!a&&"CREATE"===e.formBuilder.operation&&!1===e.formBuilder.canCreate&&(0,l.jsx)("div",{className:"absolute w-full h-full flex justify-center items-center text-center",style:{zIndex:10},children:"This record doesn't exist or you are missing the required permissions to create ".concat(e.formBuilder.tableName)}),(0,l.jsx)("div",{className:"".concat(a||!1===e.formBuilder.canRead.canRead||"CREATE"===e.formBuilder.operation&&!1===e.formBuilder.canCreate?"invisible":""," ").concat(e.className),children:e.children})]})})}},2815:function(e,a,t){var l=t(4246),i=t(226);t(7378);var n=t(4323);a.Z=e=>{let a=(0,n.Gc)().formBuilder;return void 0!==a.snapshot&&!1===a.canUpdate||void 0===a.snapshot&&!1===a.canCreate?(0,l.jsx)(l.Fragment,{}):(0,l.jsxs)(i.z,{className:e.className,onClick:()=>a.save(e.onPreValidate,e.onPreSave,e.onPostSave),variant:e.varient,children:[void 0!==e.label?e.label:"",void 0===e.label&&(void 0!==a.snapshot?"Update":"Create")]})}},4323:function(e,a,t){t.d(a,{Gc:function(){return r},q3:function(){return n}});var l=t(4246),i=t(7378);let n=i.createContext(null),r=()=>{let e=i.useContext(n);if(!e)throw Error("useFormContext must be used within a FormContextProvider");return e};a.ZP=e=>(0,l.jsx)(n.Provider,{value:{formBuilder:e.formBuilder},children:e.children})},5381:function(e,a,t){var l=t(7378),i=t(496),n=t(1331),r=t(6180),d=t(7172);a.Z=e=>{let a=(0,l.useContext)(i.Il),t=(0,l.useContext)(d.Vo),s=(0,r.t)(),o=(e,a)=>{let t=document.createElement("a");t.href=URL.createObjectURL(e),t.download=a,document.body.appendChild(t),t.click(),setTimeout(()=>{document.body.removeChild(t),URL.revokeObjectURL(t.href)},0)},u=async e=>{try{var l,i,n;let r=(null!==(l=null==t?void 0:t.apiUrl)&&void 0!==l?l:"")+e.url;void 0!==e.searchParams&&(r+="?".concat(e.searchParams.toString()));let d=s.accessToken,u=await fetch(r,{method:e.method,headers:{Authorization:"Bearer ".concat(d),UserId:null!==(i=s.userId)&&void 0!==i?i:"",...void 0!==e.body&&!(e.body instanceof FormData)&&{"Content-Type":"application/json"},...e.headers,...(null==t?void 0:t.headers)!==void 0&&(null==t?void 0:t.headers)},...void 0!==e.body&&!(e.body instanceof FormData)&&{body:JSON.stringify(e.body)},...void 0!==e.body&&e.body instanceof FormData&&{body:e.body}});if(401===u.status)return(null==t?void 0:t.onUnauthorized)!==void 0&&t.onUnauthorized(),{succeeded:!1,data:void 0,friendlyMessage:"",logMessage:"",response:u};if(400===u.status&&!e.hideFailureMessage){if(void 0!==e.failureMessage)null==a||a.showError(e.failureMessage);else{let e=await u.json();return null==a||a.showError(e.friendlyMessage),console.error(e.logMessage),e}}if(!1===u.ok){let e=await u.text();return{succeeded:!1,data:void 0,friendlyMessage:e,logMessage:e,response:u}}let c=u.headers.get("content-type");if(c&&-1!==c.indexOf("application/octet-stream")&&o(await u.blob(),null!==(n=e.fileName)&&void 0!==n?n:"file"),!c||-1===c.indexOf("application/json"))return{succeeded:!0,data:u.body,friendlyMessage:"",logMessage:"",response:u};{let t=await u.json();return!1===t.succeeded&&((void 0===e.hideFailureMessage||!1===e.hideFailureMessage)&&(null==a||a.showError(t.friendlyMessage)),console.error(t.logMessage)),t}}catch(t){return console.error(t),(void 0===e.hideFailureMessage||!1===e.hideFailureMessage)&&void 0!==e.failureMessage&&(null==a||a.showError(JSON.stringify(t))),{succeeded:!1,data:void 0,friendlyMessage:"",logMessage:"",response:void 0}}},c=async e=>{let a=await u({url:n.TO,method:"POST",body:{method:"has_permissions",parameters:{permissionNames:e}}});return!0===a.succeeded&&a.data.length===e.length},m=async e=>{let a=await u({url:n.TO,method:"POST",body:{method:"has_permissions",parameters:{permissionNames:e}}});return!0===a.succeeded&&a.data.length>0},f=async e=>{let a=await u({url:n.BR,method:"POST",body:{method:"table_metadata",parameters:{tableName:e}}});return null==a?void 0:a.data},h=async e=>await u({url:n.BR,method:"POST",body:{method:"table_list",parameters:{tag:e}}}),p=async function(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return await u({method:"POST",url:n.Vx,body:{tableName:e,fields:a,parameters:t}})},v=async(e,a,t)=>await u({method:"PATCH",url:n.sy,body:{tableName:e,fields:a,parameters:t}}),y=async(e,a,t)=>await u({method:"DELETE",url:n.QC,body:{tableName:e,fields:{["".concat(e,"Id")]:a},parameters:t}}),g=async(e,a,t)=>await u({method:"POST",url:n.F,body:{tableName:e,fields:a,parameters:t}}),b=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return await u({method:"POST",url:n.Vx,body:{entities:e,parameters:a}})},E=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return await u({method:"PATCH",url:n.sy,body:{entities:e,parameters:a}})},T=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return await u({method:"DELETE",url:n.QC,body:{entities:e,parameters:a}})},_=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return await u({method:"POST",url:n.F,body:{entities:e,parameters:a}})},N=async function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1],await u({url:n.bZ,method:"POST",body:e})},A=async e=>await u({method:"POST",url:n.ku,body:e}),I=async(e,a,t)=>await u({method:"POST",url:n.k0,body:{name:e,parameters:a},fileName:t}),L=async e=>await u({method:"POST",url:n.mH,body:e});return(0,l.useMemo)(()=>({execute:u,hasAllPermissions:c,hasAnyPermissions:m,tables:h,metadata:f,create:p,read:A,update:v,delete:y,upsert:g,bulkCreate:b,bulkUpdate:E,bulkDelete:T,bulkUpsert:_,bulk:N,action:I,file:L}),[null==t?void 0:t.apiUrl,null==t?void 0:t.headers,null==t?void 0:t.onUnauthorized,s.accessToken,s.userId])}},9572:function(e,a,t){var l=t(7302),i=t(823);t(7378),a.Z=()=>{let e=(0,l.rZ)(),{colorScheme:a,toggleColorScheme:t}=(0,i.X)(),n="dark"===a?e.colors.gray[4]:e.colors.dark[7];return{getIconColor:()=>n,getPrimaryColor:()=>e.fn.primaryColor(),colorScheme:a}}},625:function(e,a,t){t.d(a,{Z:function(){return c}});var l=t(5381),i=t(7378),n=t(8971),r=t(2760);let d=()=>({type:"INSTANTIATED",tableName:void 0,data:void 0,snapshot:void 0,dirtyFields:[],validationMessages:[],metadata:void 0,canUpdate:!0,canCreate:!0,canRead:{canRead:!0,message:""},isLoading:!0,forceIsLoading:!1,isSubmitted:!1,eventListeners:[]}),s=(e,a)=>{var t,l,i;switch(console.log("FormBuilder: "+a.type),a.type){case"START_INITIAL_LOAD":return{...d(),data:a.payload.data,snapshot:void 0,metadata:e.metadata,isLoading:!0,forceIsLoading:null!==(t=a.payload.forceIsLoading)&&void 0!==t&&t,type:"START_INITIAL_LOAD"};case"INITIAL_LOAD_COMPLETE":return{...e,...a.payload,isLoading:!1,dirtyFields:[],type:"INITIAL_LOAD_COMPLETE"};case"SET_FIELD_VALUE":let n=a.payload.field;return{...e,...e.dirtyFields.includes(n)?{dirtyFields:[...e.dirtyFields]}:{dirtyFields:[...e.dirtyFields,n]},data:{...e.data,[n]:a.payload.value},type:"SET_FIELD_VALUE"};case"SET_IS_LOADING":return{...e,isLoading:!0,type:"SET_IS_LOADING"};case"SUBMIT_COMPLETE":return{...e,isLoading:!1,isSubmitted:!0,validationMessages:[],dirtyFields:[],type:"SUBMIT_COMPLETE"};case"SUBMIT_CANCELLED":return{...e,isLoading:!1,type:"SUBMIT_CANCELLED"};case"SET_VALIDATION_MESSAGES":return{...e,validationMessages:a.payload,type:"SET_VALIDATION_MESSAGES"};case"SET_VALIDATION_MESSAGE":let r=a.payload;return{...e,validationMessages:[...e.validationMessages.filter(e=>e.field!==r.field),r],type:"SET_VALIDATION_MESSAGE"};case"SET_DATA_TO_EDIT":let s=a.payload;return{...e,validationMessages:[],snapshot:a.payload.snapshot,data:a.payload.data,canUpdate:null!=a.payload.data&&(null==s.canUpdate||!1!=s.canUpdate)&&null!==(l=null==s?void 0:s.data._ui_info_.canUpdate)&&void 0!==l&&l,forceIsLoading:null!==(i=s.forceIsLoading)&&void 0!==i&&i,type:"SET_DATA_TO_EDIT"};case"CLEAR_EDIT_DATA":return{...e,type:"CLEAR_EDIT_DATA",data:e.snapshot};case"CLEAR":return{...e,type:"CLEAR",data:void 0,snapshot:void 0};case"SET_SHOW_FORCE_LOADING":return{...e,forceIsLoading:a.payload.forceIsLoading,type:"SET_SHOW_FORCE_LOADING"}}return{...e}};var o=t(1331),u=t(1765),c=e=>{var a,t;let c=(0,l.Z)(),m=(0,r.eL)(),f=(0,u.Z)(),h=(0,n.Z)(),p=(0,i.useRef)(null),[v,y]=(0,i.useReducer)(s,d()),[g,b]=(0,i.useState)([]),E=[],T=[],_=[],N=async a=>{if(null==e.tableName||""===e.tableName)return;if(!a.refresh){var t,l;y({type:"START_INITIAL_LOAD",payload:{tableName:e.tableName,data:null!=v.metadata?await A(v.metadata,void 0):void 0,forceIsLoading:null!==(l=null!==(t=a.forceShowLoading)&&void 0!==t?t:e.forceShowLoading)&&void 0!==l&&l}})}let i=e.metadata;null==i&&(i=await c.metadata(e.tableName));let n=e.snapshot,r=!1,d=!1,s=!1;if(null==e.snapshot&&null!=a.id||a.refresh){let t=await c.read({tableName:e.tableName,fields:["*"],maxResults:1,page:1,id:a.refresh?v.snapshot["".concat(e.tableName,"Id")]:a.id});if(null==t||!t.succeeded)return;null==t.data.results||0===t.data.results.length?r=!0:d=(n=t.data.results[0])._ui_info_.canUpdate}null!=e.snapshot&&(d=e.snapshot._ui_info_.canUpdate);let o=await A(i,n);"NONE"!==(await m.getTablePermissions(c,e.tableName)).create&&(s=!0),null!=e.canUpdate&&!1===e.canUpdate&&(d=!1),null!=e.canCreate&&!1===e.canCreate&&(s=!1),a.refreshDatatables&&await S(),y({type:"INITIAL_LOAD_COMPLETE",payload:{metadata:i,snapshot:n,data:o,canUpdate:d,canCreate:s,canRead:{canRead:!r,message:r?"This record doesn't exist or you are missing the required permissions to access ".concat(e.tableName):""}}}),g.length>0&&(L(g.pop()),b([]))},A=async(a,t)=>{if(void 0!==a){if(void 0===t){var l;return{...await I(a),...null===(l=e.defaults)||void 0===l?void 0:l.reduce((e,a)=>({...e,[a.field]:a.value}),{})}}if(null!=t){let l=Object.keys(t).reduce((l,i)=>(null!==t[i]&&(void 0!==a.fields.find(e=>e.name===i)||["_ui_info_"].includes(i)||i==="".concat(e.tableName,"Id"))&&(l[i]=t[i]),l),{});return{...await I(a),...l}}}},I=async a=>{var t,l;let i=a.fields.filter(e=>"Single"===e.type||"Int32"===e.type||"Int64"===e.type||"Double"===e.type||"Decimal"===e.type).map(e=>({field:e.name,value:e.isNullable?"":0})),n=null==a?void 0:a.fields.filter(e=>"String"===e.type||"Guid"===e.type).map(e=>({field:e.name,value:""})),r=null==a?void 0:a.fields.filter(e=>"Boolean"===e.type).map(e=>({field:e.name,value:!1})),d=new Date;d.setUTCHours(0,0,0,0);let s=null==a?void 0:a.fields.filter(e=>"DateTime"===e.type).map(e=>({field:e.name,value:e.isNullable?null:d.toISOString()})),o=null==a?void 0:a.fields.filter(e=>"Lookup"===e.type).map(a=>{var t,l,i;return{field:a.name,value:null!==(i=null===(l=e.defaults)||void 0===l?void 0:null===(t=l.find(e=>e.field===a.name))||void 0===t?void 0:t.value)&&void 0!==i?i:null}});for(let i of null!==(t=a.fields)&&void 0!==t?t:[])if("Lookup"===i.type&&void 0!==e.defaults)for(let a of null!==(l=e.defaults)&&void 0!==l?l:[])a.field===i.name&&await h.getLookupLabel(c,i.name,i.lookupTable,i.lookupTableNameField,a.value);return{...null==i?void 0:i.reduce((e,a)=>({...e,[a.field]:a.value}),{}),...null==n?void 0:n.reduce((e,a)=>({...e,[a.field]:a.value}),{}),...null==r?void 0:r.reduce((e,a)=>({...e,[a.field]:a.value}),{}),...null==s?void 0:s.reduce((e,a)=>({...e,[a.field]:a.value}),{}),...null==o?void 0:o.reduce((e,a)=>({...e,[a.field]:a.value}),{}),_ui_info_:{canUpdate:!0,canDelete:!0}}},L=async(a,t)=>{void 0!==v.metadata?y({type:"SET_DATA_TO_EDIT",payload:{data:await A(v.metadata,a),snapshot:a,...null!=e.canUpdate?{canUpdate:e.canUpdate}:{},forceIsLoading:null!=t&&t}}):b(e=>[...e,a])},S=()=>{for(let e of E)e.refresh()},B=async(a,t,l)=>{var i;let n={...v.data},r={};if(null!=a){let e=await a(n);if(!e.continue)return;r={...r,...e.parameters}}if(!C())return;if(y({type:"SET_IS_LOADING"}),null!=e.onPreSave){let a=await e.onPreSave(n);if(!1===a.continue){y({type:"SUBMIT_CANCELLED"});return}r={...r,...a.parameters}}for(let e of T)if("PRE_SAVE"===e.eventName&&!1===await e.callback(n,r)){y({type:"SUBMIT_CANCELLED"});return}if(null!=t){let e=await t(n);if(!1===e.continue){y({type:"SUBMIT_CANCELLED"});return}r={...r,...e.parameters}}let d=await c.execute({url:void 0===v.snapshot?o.Vx:o.sy,method:void 0===v.snapshot?"POST":"PATCH",body:{tableName:null===(i=v.metadata)||void 0===i?void 0:i.tableName,fields:n,parameters:r}});if((null==d?void 0:d.succeeded)===!0){for(let a of(void 0!==e.onPostSave&&await e.onPostSave(void 0===v.snapshot?"CREATE":"UPDATE",d.data["".concat(e.tableName,"Id")],d.data),T))"POST_SAVE"===a.eventName&&a.callback(void 0===v.snapshot?"CREATE":"UPDATE",d.data["".concat(e.tableName,"Id")],d.data);null!=l&&l(void 0===v.snapshot?"CREATE":"UPDATE",d.data["".concat(e.tableName,"Id")],d.data)}else{for(let a of(void 0!==e.onPostSave&&await e.onPostSave("FAILED","",{}),T))"POST_SAVE"===a.eventName&&a.callback("FAILED","",{});null!=l&&l("FAILED","",{})}y({type:"SUBMIT_COMPLETE"}),S()},D=async e=>{var a;return(await c.execute({url:void 0===v.snapshot?o.Vx:o.sy,method:void 0===v.snapshot?"POST":"PATCH",body:{tableName:null===(a=v.metadata)||void 0===a?void 0:a.tableName,fields:v.data,parameters:e}})).data},C=()=>{var e,a;let t=[];for(let l of null!==(a=null===(e=v.metadata)||void 0===e?void 0:e.fields)&&void 0!==a?a:[]){let e=v.data[l.name];if(!["CreatedById","UpdatedById"].includes(l.name)){if(["Single","Int32","Int64","Double","Decimal"].includes(l.type)&&("-"===e||"."===e)){let a='"'.concat(e,'" is not a valid number');t.push({field:l.name,message:a})}if(("Lookup"===l.type||"DateTime"===l.type)&&(!1===l.isNullable||l.isRequired||_.includes(l.name))&&null==e){let e="".concat(l.displayName," is required");t.push({field:l.name,message:e}),console.warn(e)}if((!0===l.isRequired||_.includes(l.name))&&(null==e||""===e)){let e="".concat(l.displayName," is required");t.push({field:l.name,message:e}),console.warn(e)}if("Guid"===l.type&&""!==e&&!f.validate(e)){let e="".concat(l.displayName," is not a valid Id");t.push({field:l.name,message:e}),console.warn(e)}}}return!(t.length>0)||(y({type:"SET_VALIDATION_MESSAGES",payload:t}),!1)},O=async(e,a)=>{await N({id:e,refresh:!1,refreshDatatables:!0,forceShowLoading:a})};return(0,i.useEffect)(()=>{null!=e.tableName&&""!==e.tableName&&N({id:e.id,refresh:!1,refreshDatatables:!1})},[e.tableName,e.id]),(0,i.useEffect)(()=>{v.snapshot!=e.snapshot&&L(e.snapshot)},[e.snapshot]),(0,i.useEffect)(()=>{g.length>0&&"INITIAL_LOAD_COMPLETE"===v.type&&(L(g.pop()),b([]))},[v.type,g]),{metadata:v.metadata,dispatch:y,data:v.data,snapshot:v.snapshot,setSnapshot:L,firstInputRef:p,lookupExclusions:null!==(a=e.lookupExclusions)&&void 0!==a?a:[],lookupQueries:null!==(t=e.lookupQueries)&&void 0!==t?t:[],canUpdate:v.canUpdate,canCreate:v.canCreate,canRead:v.canRead,defaults:e.defaults,validationMessages:v.validationMessages,isLoading:v.isLoading||v.forceIsLoading,isSubmitted:v.isSubmitted,operation:null!=e.snapshot||null!=v.snapshot?"UPDATE":"CREATE",stateType:v.type,tableName:e.tableName,reload:function(){let a=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return N({id:v.snapshot["".concat(e.tableName,"Id")],refresh:!0,refreshDatatables:a})},setField:(e,a)=>{y({type:"SET_FIELD_VALUE",payload:{field:e,value:a}})},setFieldError:(e,a)=>{y({type:"SET_VALIDATION_MESSAGE",payload:{field:e,message:a}})},isDirty:e=>null==e?v.dirtyFields.length>0:v.dirtyFields.includes(e),addDataTable:e=>{null!=E.find(a=>a.dataTableId===e.dataTableId)&&(E=E.filter(a=>a.dataTableId!==e.dataTableId)),E.push(e)},addRequiredField:e=>{_.includes(e)||_.push(e)},removeRequiredField:e=>{_=_.filter(a=>a!==e)},reloadDataTables:S,save:B,saveSilent:D,load:O,on:(e,a)=>{T.push({eventName:e,callback:a})},clearEdits:()=>{y({type:"CLEAR_EDIT_DATA"})},clear:()=>{y({type:"CLEAR"})},validate:C,setShowForceLoading:e=>{y({type:"SET_FORCE_LOADING",payload:{forceIsLoading:e}})}}}},1765:function(e,a,t){t(7378);var l=t(8788),i=t(6052);a.Z=()=>({get:()=>(0,l.Z)(),validate:e=>(0,i.Z)(e)})},8971:function(e,a,t){var l=t(1331);let i=(0,t(6805).Ue)()((e,a)=>({lookups:[],getLookupLabel:async(t,i,n,r,d)=>{let s=a().lookups.find(e=>e.fieldName===i&&e.lookupTable===n&&e.lookupTableNameField==r&&e.value===d);if(void 0!==s)return s;let o=await t.execute({url:l.ku,method:"POST",body:{fields:["*"],tableName:n,maxResults:1,page:1,id:d}});if(((null==o?void 0:o.succeeded)!==!0||null!==o.data)&&(null==o?void 0:o.succeeded)===!0&&void 0!==o.data.results&&o.data.results.length>0){let t=o.data.results[0][r],l={fieldName:i,lookupTable:n,lookupTableNameField:r,value:d,label:t};return e({lookups:[...a().lookups,l]}),l}},getAnyLookup:async(t,i,n,r)=>{let d=a().lookups.find(e=>e.fieldName===i&&e.lookupTable===n&&e.lookupTableNameField==r);if(void 0!==d)return d;let s=await t.execute({url:l.ku,method:"POST",body:{fields:["*"],tableName:n,maxResults:1,page:1}});if(((null==s?void 0:s.succeeded)!==!0||null!==s.data)&&(null==s?void 0:s.succeeded)===!0&&void 0!==s.data.results&&s.data.results.length>0){let t={fieldName:i,lookupTable:n,lookupTableNameField:r,value:s.data.results[0]["".concat(n,"Id")],label:s.data.results[0][r]};return e({lookups:[...a().lookups,t]}),t}}}));a.Z=i},2760:function(e,a,t){t.d(a,{ZP:function(){return s},eL:function(){return d}});var l=t(1331),i=t(6805);let n={getHighestPermissionLevel:e=>void 0!==e.find(e=>e.endsWith("_SYSTEM"))?"SYSTEM":void 0!==e.find(e=>e.endsWith("_TEAM"))?"TEAM":void 0!==e.find(e=>e.endsWith("_USER"))?"USER":"NONE"};var r=t(6521);let d=(0,i.Ue)()((e,a)=>({tablePermissions:[],teams:[],getTablePermissions:async(e,t)=>{let i=a().tablePermissions.find(e=>e.tableName===t);if(void 0!==i)return i.permissions;let r="".concat("TABLE_{tableName}_READ_SYSTEM, TABLE_{tableName}_READ_TEAM, TABLE_{tableName}_READ_USER".replaceAll("{tableName}",t),", ").concat("TABLE_{tableName}_CREATE_SYSTEM, TABLE_{tableName}_CREATE_TEAM, TABLE_{tableName}_CREATE_USER".replaceAll("{tableName}",t),", ").concat("TABLE_{tableName}_DELETE_SYSTEM, TABLE_{tableName}_DELETE_TEAM, TABLE_{tableName}_DELETE_USER".replaceAll("{tableName}",t),", ").concat("TABLE_{tableName}_UPDATE_SYSTEM, TABLE_{tableName}_UPDATE_TEAM, TABLE_{tableName}_UPDATE_USER".replaceAll("{tableName}",t)),d=await e.execute({url:l.TO,method:"POST",body:{method:"has_permissions",parameters:{permissionNames:r.split(",").map(e=>e.trim())}}});if((null==d?void 0:d.succeeded)===!0){let e=d.data;if(e.length>0){let a=e.filter(e=>e.startsWith("TABLE_".concat(t,"_READ"))),l=e.filter(e=>e.startsWith("TABLE_".concat(t,"_CREATE"))),i=e.filter(e=>e.startsWith("TABLE_".concat(t,"_DELETE"))),r=e.filter(e=>e.startsWith("TABLE_".concat(t,"_UPDATE")));return{read:n.getHighestPermissionLevel(a),create:n.getHighestPermissionLevel(l),delete:n.getHighestPermissionLevel(i),update:n.getHighestPermissionLevel(r)}}}return{read:"NONE",create:"NONE",delete:"NONE",update:"NONE"}},getPermissions:async(e,t)=>{let i=a().tablePermissions,n=t.filter(e=>null!=i.find(a=>a.tableName===e));if(n.length===t.length)return n;let r=await e.execute({url:l.TO,method:"POST",body:{method:"has_permissions",parameters:{permissionNames:t}}});return(null==r?void 0:r.succeeded)===!0?r.data:[]},getTeams:async t=>{var l,i;if(a().teams.length>0)return a().teams;let n=new r.ZP(["Name"]).top(99999).from("Team").join("Team.TeamId","TeamUser.TeamId","tu").join("tu.UserId","User.UserId","u").distinct().toReadRequest(),d=await t.read(n);return d.succeeded?(e({teams:null!==(l=d.data.results.map(e=>e.Name))&&void 0!==l?l:[]}),null!==(i=d.data.results.map(e=>e.Name))&&void 0!==i?i:[]):[]}}));var s=d},6521:function(e,a,t){class l{top(e){return this._maxResults=e,this}page(e){return this._page=e,this}from(e){return this._tableName=e,this}where(e,a,t){return e instanceof n?this._filters.push(e):this._filters.push(r(e,a,t)),this}and(e,a,t){return e instanceof n?this._filters[this._filters.length-1].and(e):this._filters[this._filters.length-1].and(e,a,t),this}or(e,a,t){return e instanceof n?this._filters[this._filters.length-1].or(e):this._filters[this._filters.length-1].or(e,a,t),this}join(e,a,t){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return this._joins.push(new i(e,a,t,l,"inner")),this}leftJoin(e,a,t){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return this._joins.push(new i(e,a,t,l,"left")),this}except(e){return this._except.push(e),this}orderBy(e,a){return this._orderBy||(this._orderBy=[]),this._orderBy.push({field:e,order:a}),this}distinct(){return this._distinct=!0,this}denormalize(){return this._denoramlize=!0,this}toReadRequest(){var e,a,t;return{tableName:this._tableName,fields:this._fields,page:null!==(e=this._page)&&void 0!==e?e:1,maxResults:null!==(a=this._maxResults)&&void 0!==a?a:null,orderBy:null!==(t=this._orderBy)&&void 0!==t?t:[],filters:this._filters.length>0?[this._filters[0].getJson()]:[],joins:this._joins,distinct:this._distinct,denormalize:this._denoramlize,except:this._except}}constructor(e){return this._page=1,this._tableName="",this._filters=[],this._joins=[],this._distinct=!1,this._denoramlize=!1,this._except=[],this._fields=e,this}}class i{constructor(e,a,t=null,l=null,i){this.alias=null;let n=e.split("."),r=a.split(".");if(n.length<2||r.length<2)throw Error("Join must include a table and field part ie: tableName.fieldName");this.fromTable=n[0],this.fromField=n[1],this.toTable=r[0],this.toField=r[1],this.alias=t,this.fields=null!=l?l:[],this.type=i}}class n{and(e,a,t){if(e instanceof n)this.filters.push(e);else{if("OR"==this.logicalOperator){let l;let i=this.conditions[this.conditions.length-1];return this.lastCondition==i?(l=new n,this.conditions.pop(),l.conditions.push(i)):l=this.filters[this.filters.length-1],this.lastCondition={field:e,operator:a,value:t},l.conditions.push(this.lastCondition),this.filters.push(l),this}this.lastCondition={field:e,operator:a,value:t},this.conditions.push(this.lastCondition)}return this}or(e,a,t){if(e instanceof n)this.filters.push(e);else{if("AND"===this.logicalOperator){this.logicalOperator="OR";let e=new n;e.conditions=this.conditions,this.filters.push(e),this.conditions=[]}this.lastCondition={field:e,operator:a,value:t},this.conditions.push(this.lastCondition)}return this}getJson(){return{logicalOperator:this.logicalOperator,filters:[...this.conditions,...this.filters.map(e=>e.getJson())]}}getStr(){let e=[];for(let a of this.conditions)e.push("".concat(a.field," ").concat(a.operator," ").concat(a.value));for(let a of this.filters)e.push("(".concat(a.getStr(),")"));return e.join(" ".concat(this.logicalOperator," "))}print(){return console.log(this.getStr()),this}constructor(){this.logicalOperator="AND",this.filters=[],this.conditions=[]}}let r=(e,a,t)=>{let l=new n;return l.logicalOperator="AND",l.conditions=[],l.conditions.push({field:e,operator:a,value:t}),l};a.ZP=l}}]);