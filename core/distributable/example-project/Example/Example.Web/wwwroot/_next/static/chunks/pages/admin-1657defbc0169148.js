(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{3848:function(e,s,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return l(11)}])},11:function(e,s,l){"use strict";l.r(s),l.d(s,{default:function(){return eN}});var t=l(4246),o=l(5381),i=l(7628),n=l(9888),r=l(435),a=l(226),d=l(5213),c=l(3260),u=l(7378),m=l(1879),f=l(1331),h=l(7577),x=l(2053),p=l(6283),v=e=>{let s=(0,o.Z)(),[l,n]=u.useState([]),[r,d]=u.useState(!0),m=async()=>{d(!0),await s.execute({url:f.k0,method:"POST",body:{name:"ADMIN_ExportData",parameters:{tables:l.filter(e=>!0===e.checked).map(e=>({name:e.Name,dependencies:e.Dependencies.filter(e=>!0===e.checked).map(e=>({name:e.Name}))}))}},fileName:"export_".concat(new Date().toLocaleString().replaceAll(" ",""),".json")}),e.close()},v=async()=>{d(!0);let e=await s.execute({url:f.k0,method:"POST",body:{name:"ADMIN_ExportDependencies"}});if((null==e?void 0:e.succeeded)===!0){let s=e.data;for(let e of s)for(let s of(e.checked=!1,e.Dependencies))s.checked=!1,s.disabled=!1;n(s)}d(!1)},j=(e,s)=>{let l=!1;for(let t of e)if(t.Name===s){l=!t.checked;break}let t=e.map(e=>e);w(s,t,[],l),n(t)},w=(e,s,l,t)=>{if(!l.includes(e))for(let o of(l.push(e),s))if(o.Name===e)for(let e of(o.checked=t,o.disabled=!1,o.Dependencies))!1===e.Optional&&(e.checked=t,e.disabled=t,w(e.Name,s,l,t));else for(let s of o.Dependencies)s.Name===e&&(s.checked=t,s.disabled=t)};return(0,u.useEffect)(()=>{!0===e.opened&&(d(!1),n([]),v())},[e.opened]),(0,t.jsxs)(h.u,{opened:e.opened,onClose:e.close,title:"Export Data",styles:{body:{overflow:"hidden",position:"relative",padding:"0px"}},centered:!0,children:[!0===r&&(0,t.jsx)("div",{className:"absolute w-full h-full flex justify-center items-center overflow-hidden z-30",children:(0,t.jsx)(i.a,{})}),(0,t.jsxs)("div",{className:"p-4 ".concat(r?"invisible":""),children:[(0,t.jsx)(c.x,{h:650,children:(0,t.jsx)("div",{className:" pl-2 flex flex-col gap-2",children:l.map(e=>(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{children:(0,t.jsx)(x.X,{styles:{input:{cursor:"pointer"},label:{cursor:"pointer"}},checked:e.checked,disabled:e.disabled,onChange:()=>{},onClick:()=>{j(l,e.Name)},label:e.Name})}),(0,t.jsx)("div",{className:"flex flex-col gap-1",children:e.Dependencies.map(e=>(0,t.jsx)("div",{className:"ml-8",children:(0,t.jsx)(x.X,{styles:{input:{cursor:"pointer"},label:{cursor:"pointer"}},label:e.Name,checked:e.checked,onChange:()=>{},disabled:e.disabled,onClick:()=>j(l,e.Name)})},"".concat(p.Z.name,"-").concat(e.Name)))})]},e.Name))})}),(0,t.jsx)("div",{className:"w-full flex justify-end mt-4",children:(0,t.jsx)(a.z,{onClick:m,children:"Export"})})]})]})},j=l(8676),w=e=>{let s=(0,o.Z)(),[l,n]=u.useState(null),[r,d]=u.useState(!1),c=async()=>{if(null===l)return;d(!0);let t=new FormData;t.append("file",l),t.append("name","ADMIN_ImportData"),await s.execute({url:f.mH,method:"POST",body:t}),e.close()};return(0,u.useEffect)(()=>{!0===e.opened&&(d(!1),n(null))},[e.opened]),(0,t.jsxs)(h.u,{opened:e.opened,onClose:e.close,size:"md",title:"Import Data",closeOnEscape:!r,closeOnClickOutside:!r,withCloseButton:!r,styles:{body:{overflow:"hidden",position:"relative",padding:"0px"}},centered:!0,children:[!0===r&&(0,t.jsx)("div",{className:"absolute w-full h-full  flex justify-center items-center overflow-hidden z-30",children:(0,t.jsx)(i.a,{})}),(0,t.jsxs)("div",{className:"p-4 ".concat(r?"invisible":""),children:[(0,t.jsx)(j.S,{label:"File Upload",placeholder:"Click to choose data file",required:!0,value:l,onChange:e=>{n(e)}}),(0,t.jsx)("div",{className:"w-full flex justify-end mt-4",children:(0,t.jsx)(a.z,{onClick:c,disabled:null===l,children:"Upload"})})]})]})},y=l(9354),g=l(9572),b=l(2975),N=l(806),R=l(5299),I=()=>{var e;let s=eg();return(0,t.jsx)(t.Fragment,{children:s.tables.length>0&&!(null===(e=s.props.hiddenMenuItems)||void 0===e?void 0:e.includes("Entities"))&&(0,t.jsx)(b.O,{label:"Entities",icon:(0,t.jsx)(N.Z,{size:16,strokeWidth:2,color:s.color}),children:s.tables.filter(e=>{var l,t;return"System"!==e.tag&&(null===(l=s.props.hiddenEntities)||void 0===l?void 0:l.includes(e.tableName))!==!0&&(void 0===s.props.visibleEntities||(null===(t=s.props.visibleEntities)||void 0===t?void 0:t.includes(e.tableName)))}).sort((e,l)=>s.props.showEntityDisplayNames?e.displayName.localeCompare(l.displayName):e.tableName.localeCompare(l.tableName)).map(e=>(0,t.jsx)(b.O,{label:s.props.showEntityDisplayNames?e.displayName:e.tableName,icon:(0,t.jsx)(N.Z,{size:16,strokeWidth:2,color:s.color}),onClick:()=>s.setActiveComponent(s=>({component:(0,t.jsx)("div",{className:"w-full h-full flex flex-col",children:(0,t.jsx)("div",{className:"grow h-1",children:(0,t.jsx)(R.Z,{tableName:e.tableName,maxResults:100})})})}))},e.tableName))})})},C=l(188),k=l(6273),P=l(8122),E=l(4139),S=l(9879),A=e=>(0,t.jsxs)("div",{className:"flex justify-center items-center w-full h-full",children:["none"===e.icon&&(0,t.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"cursor-pointer",onClick:e.onClick,children:(0,t.jsx)("rect",{x:"2.00024",y:"2",width:"28",height:"28",rx:"6",stroke:"#4B4B4B",strokeWidth:"4"})}),"user"===e.icon&&(0,t.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"cursor-pointer",onClick:e.onClick,children:[(0,t.jsx)("rect",{x:"2.00024",y:"2",width:"28",height:"28",rx:"6",stroke:"#4B4B4B",strokeWidth:"4"}),(0,t.jsx)("mask",{id:"mask0_712_5305",maskUnits:"userSpaceOnUse",x:"4",y:"16",width:"12",height:"12",children:(0,t.jsx)("path",{d:"M4 16V28H16L4 16Z",fill:"#D9D9D9"})}),(0,t.jsx)("g",{mask:"url(#mask0_712_5305)",children:(0,t.jsx)("rect",{x:"4.00024",y:"4",width:"24",height:"24",rx:"4",fill:"#991B1B"})})]}),"team"===e.icon&&(0,t.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"cursor-pointer",onClick:e.onClick,children:[(0,t.jsx)("rect",{x:"2",y:"2",width:"28",height:"28",rx:"6",stroke:"#4B4B4B",strokeWidth:"4"}),(0,t.jsx)("mask",{id:"mask0_712_5300",maskUnits:"userSpaceOnUse",x:"4",y:"4",width:"24",height:"24",children:(0,t.jsx)("path",{d:"M4 28H28L4 4V28Z",fill:"#D9D9D9"})}),(0,t.jsx)("g",{mask:"url(#mask0_712_5300)",children:(0,t.jsx)("rect",{x:"4",y:"4",width:"24",height:"24",rx:"4",fill:"#F59E0B"})})]}),"system"===e.icon&&(0,t.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"cursor-pointer",onClick:e.onClick,children:[(0,t.jsx)("rect",{x:"2",y:"2",width:"28",height:"28",rx:"6",stroke:"#4B4B4B",strokeWidth:"4"}),(0,t.jsx)("rect",{x:"4",y:"4",width:"24",height:"24",rx:"4",fill:"#84CC16"})]})]}),T=l(6521),D=l(9816),B=l(2063),O=l(2815),L=l(8),_=l(6717);let W=u.createContext(null),F=()=>{let e=u.useContext(W);if(!e)throw Error("useDataGridContext must be used within a DataGridContextProvider");return e},U=u.createContext(null),M=()=>{let e=u.useContext(U);if(!e)throw Error("useSubGrid must be used within a SubGridContextProvider");return e};var Z=e=>{let s=F();return(0,t.jsx)("div",{children:(0,t.jsx)("input",{type:"text",style:{zIndex:null!=s.props.zIndex?s.props.zIndex+1:2,textAlign:e.rightAlign?"right":"left"},className:"w-full h-full border-none outline-none",value:s.editValue,onChange:e=>{s.setEditValue(e.target.value)},autoFocus:!0})})},z=l(2370),J=e=>e.isEditing||null==e.errorMessage||""===e.errorMessage?(0,t.jsx)(t.Fragment,{}):(0,t.jsx)(z.u,{label:e.errorMessage,color:"#dc2626",withArrow:!0,children:(0,t.jsx)("div",{className:"absolute w-full h-full flex justify-start items-center",children:(0,t.jsx)("div",{className:"w-4 h-4 text-xs text-white rounded-full bg-red-600 flex justify-center items-center font-bold ml-1",children:"!"})})}),H=e=>{var s,l,o,i,n;let r=F(),a=M(),d=(0,u.useRef)(null),c=(0,g.Z)();if(null==r.props.rows[e.rowIndex+a.skipRows])return;let m=r.props.rows[e.rowIndex+a.skipRows].columns[e.columnIndex+a.skipColumns],f={row:e.rowIndex+a.skipRows,col:e.columnIndex+a.skipColumns},h=null!==(o=m.value)&&void 0!==o?o:"",x=null==h?"":h.toString(),p="light"===c.colorScheme?"bg-gray-200":"bg-neutral-800",v=r.props.rightAlignNumbers&&"string"==typeof x&&!isNaN(x)&&!isNaN(parseFloat(x)),j=(e,s)=>{let l=r.props.rows[e+a.skipRows].columns[s+a.skipColumns].onClick;if(null!=l){let t=r.props.rows[e+a.skipRows].columns[s+a.skipColumns].data;l(h,{row:e+a.skipRows,col:s+a.skipColumns},t)}!1!==r.props.editable&&(r.setActiveCell({row:e+a.skipRows,col:s+a.skipColumns}),r.isEditing&&r.onEndEdit())},w=r.props.rows[e.rowIndex+a.skipRows].columns[e.columnIndex+a.skipColumns].style,y=s=>{r.gridResize.setIsResizing(!0),r.gridResize.setResizingStartClientX(s.clientX),r.gridResize.setResizingColNumber(e.columnIndex+a.skipColumns)},b=(null===(s=r.activeCell)||void 0===s?void 0:s.row)===e.rowIndex+a.skipRows&&(null===(l=r.activeCell)||void 0===l?void 0:l.col)===e.columnIndex+a.skipColumns;return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{ref:d,style:{...e.style,borderRight:"1px solid gray",borderBottom:"1px solid gray",...null!=w?w:{}},className:"h-full py-0.5 relative whitespace-nowrap text-ellipsis text-sm flex items-center ".concat(m.isDisabled?p:""," ").concat(v?"justify-end":""," ").concat(!1===r.props.editable?"":"cursor-pointer"),onClick:()=>j(e.rowIndex,e.columnIndex),onDoubleClick:()=>r.onKeyDown(window,void 0,x),children:[!b&&null!=m.errorMessage&&(0,t.jsx)(J,{isEditing:b&&r.isEditing,errorMessage:m.errorMessage}),(0,t.jsx)("div",{onMouseDown:e=>y(e),style:{zIndex:(null!==(i=r.props.zIndex)&&void 0!==i?i:0)+2},className:"absolute -right-1 top-0 w-1.5 h-full cursor-ew-resize"}),b?(0,t.jsxs)("div",{style:{boxSizing:r.isEditing?"content-box":"border-box",zIndex:null!==(n=r.props.zIndex)&&void 0!==n?n:1},className:"absolute ".concat(r.isEditing?"-top-0.5 -left-0.5 border-blue-400 border-2":"top-0 left-0 border-blue-600 border-1","  w-full h-full border-solid"),children:[null!=m.errorMessage&&(0,t.jsx)("div",{className:"w-full h-full absolute",children:(0,t.jsx)(J,{isEditing:b&&r.isEditing,errorMessage:m.errorMessage})}),(0,t.jsx)("div",{className:"w-full h-full ".concat(r.isEditing?"border-2 border-solid border-blue-600 flex items-center":""," "),children:r.isEditing&&(0,t.jsx)(Z,{rightAlign:null!=v&&v})})]}):"",null!=m.custom?m.custom(h,f,m.data):"",null==m.custom&&(0,t.jsx)("span",{className:" overflow-hidden px-1",children:""===x.replaceAll(" ","")?"\xa0":x})]},e.columnIndex)})},X=e=>{let[s,l]=(0,u.useState)(!1),[t,o]=(0,u.useState)(void 0),[i,n]=(0,u.useState)(void 0),[r,a]=(0,u.useState)(e.columnWidths),[d,c]=(0,u.useState)(e.columnWidths),[m,f]=(0,u.useState)({startX:0,startY:0,endY:0,clientX:0,clientY:0}),h=()=>{if(s){if(l(!1),null==i)return;let e=m.clientX-t,s=[...d],o=s[i]+e;o<32&&(o=32),s[i]=o,c(s)}};return(0,u.useEffect)(()=>(window.addEventListener("mouseup",h),()=>{window.removeEventListener("mouseup",h)})),(0,u.useEffect)(()=>{if(e.columnWidths.length!==r.length)a(e.columnWidths),c(e.columnWidths);else for(let s=0;s<e.columnWidths.length;s++)if(e.columnWidths[s]!==r[s]){a(e.columnWidths),c(e.columnWidths);break}},[e.columnWidths]),{isResizing:s,setIsResizing:l,resizingStartClientX:t,setResizingStartClientX:o,resizingColNumber:i,setResizingColNumber:n,columnWidths:d,setColWidths:c,onMouseMove:l=>{if(s&&l.preventDefault(),!e.divRef.current)return;let t=e.divRef.current.getBoundingClientRect();f({startX:l.clientX-t.left,startY:0,endY:t.height,clientX:l.clientX,clientY:l.clientY})},mousePosition:m}},G=e=>{if(e.rows.length>0){if(void 0===e.rows[0].columns||0===e.rows[0].columns.length)throw Error("DataGrid: rows must contain columns");let s=e.rows[0].columns.length;for(let l of e.rows){if(null==l.columns)throw Error("DataGrid: rows must contain columns");if(l.columns.length!==s)throw Error("DataGrid: rows must contain the same number of columns")}if("number"!=typeof e.columnWidths&&e.columnWidths.length!==s)throw Error("DataGrid: columnWidths ".concat(e.columnWidths," must be the same length as the number of columns ").concat(s))}};let Y=(0,u.forwardRef)((e,s)=>{var l;let[o,i]=(0,u.useState)(void 0),[n,r]=(0,u.useState)(!1),[a,d]=(0,u.useState)(""),[c,m]=(0,u.useState)(!1),f=(0,u.useRef)(null),h=(0,u.useRef)(null),x=(0,u.useRef)(null),p=(0,u.useRef)(null),v=(0,u.useRef)(null);G(e);let j=(0,u.useCallback)(e=>{let{scrollLeft:s,scrollTop:l,scrollUpdateWasRequested:t}=e;if(!t){var o,i;null===(o=x.current)||void 0===o||o.scrollTo({scrollLeft:0,scrollTop:l}),null===(i=p.current)||void 0===i||i.scrollTo({scrollLeft:s,scrollTop:0})}},[]),w=X({rows:e.rows,divRef:f,columnWidths:"number"==typeof e.columnWidths&&e.rows.length>0?Array(e.rows[0].columns.length).fill(e.columnWidths):"object"==typeof e.columnWidths?e.columnWidths:[]}),y=e.rows.length>0&&e.rows[0].columns.length>0?e.rows[0].columns.length:0,g=w.columnWidths.slice(0,null!==(l=e.snapColumns)&&void 0!==l?l:0).reduce((e,s)=>e+s,0),b=!1,N=(s,l,t)=>{if(!1!==e.editable&&((null==l?void 0:l.key)==="Shift"&&m(!0),!b)){if(void 0===l){R(l,t);return}if(o){if(("ArrowDown"===l.key||"ArrowUp"===l.key||"ArrowLeft"===l.key||"ArrowRight"===l.key||"Enter"===l.key||"Escape"===l.key||"Tab"===l.key)&&l.preventDefault(),"ArrowDown"===l.key){if(o.row===e.rows.length-1)return;I(),i({row:o.row+1,col:o.col}),b=!0}else if("ArrowUp"===l.key){if(0===o.row)return;I(),i({row:o.row-1,col:o.col}),b=!0}else if("ArrowLeft"===l.key){if(0===o.col)return;I(),i({row:o.row,col:o.col-1}),b=!0}else if("ArrowRight"===l.key){if(o.col===e.rows[0].columns.length-1)return;I(),i({row:o.row,col:o.col+1}),b=!0}else if("Enter"===l.key){if(I(),o.row===e.rows.length-1)return;i({row:o.row+1,col:o.col})}else if("Escape"===l.key)C();else if("Tab"===l.key){if(I(),c){if(0===o.col)return;i({row:o.row,col:o.col-1})}else{if(o.col===e.rows[0].columns.length-1)return;i({row:o.row,col:o.col+1})}l.stopPropagation()}else R(l)}}},R=(s,l)=>{if(!n&&o){let t=e.rows[o.row].columns[o.col].isReadOnly,i=e.rows[o.row].columns[o.col].isDisabled;if(t||i)return;null==s&&(d(null!=l?l:""),r(!0)),null!=s&&1===s.key.length&&(d(""),r(!0))}b=!1},I=()=>{if(o&&n){let s=e.rows[o.row].columns[o.col];null!=e.onEndEdit&&e.onEndEdit(a,o,s.data),null!=s.onChange&&s.onChange(a,o,s.data),d(""),r(!1)}},C=()=>{d(""),r(!1)};(0,u.useEffect)(()=>{let e=e=>{N(window,e)},s=e=>{"Shift"===e.key&&m(!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",s),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",s)}},[o,n,a,c]);let k=e=>{f.current&&!f.current.contains(e.target)&&i(void 0)},P=()=>{var e,s,l,t;null==h||null===(e=h.current)||void 0===e||e.resetAfterColumnIndex(0),null===(s=x.current)||void 0===s||s.resetAfterColumnIndex(0),null===(l=p.current)||void 0===l||l.resetAfterColumnIndex(0),null===(t=v.current)||void 0===t||t.resetAfterColumnIndex(0)};return(0,u.useImperativeHandle)(s,()=>({reset:()=>{P()}})),(0,u.useEffect)(()=>{P()},[w.columnWidths]),(0,u.useEffect)(()=>(document.addEventListener("click",k,!0),()=>{document.removeEventListener("click",k,!0)}),[]),(0,t.jsxs)("div",{ref:f,className:"w-full h-full relative",onMouseMove:e=>w.onMouseMove(e),children:[w.isResizing&&(0,t.jsx)("div",{style:{top:w.mousePosition.startY,left:w.mousePosition.startX,border:"1px solid black",width:1,height:w.mousePosition.endY,zIndex:null==e.zIndex?2:e.zIndex+2},className:"absolute"}),(0,t.jsx)(L.ZP,{children:s=>{var l,c,u,m,f,b,R,C,k;let{height:P,width:E}=s;return(0,t.jsx)(W.Provider,{value:{props:e,editValue:a,setEditValue:d,activeCell:o,setActiveCell:i,isEditing:n,setIsEditing:r,onKeyDown:N,onEndEdit:I,gridResize:w},children:(0,t.jsxs)("div",{style:{display:"flex",flexDirection:"row",width:E,height:P},children:[null!=e.snapColumns&&e.snapColumns>0&&(0,t.jsxs)("div",{style:{width:g,height:"100%"},children:[null!=e.snapRows&&e.snapRows>0&&(0,t.jsx)(U.Provider,{value:{skipColumns:0,skipRows:0},children:(0,t.jsx)(_.cd,{ref:h,columnCount:e.snapColumns,rowCount:e.snapRows,columnWidth:e=>w.columnWidths[e],rowHeight:e=>30,height:30*e.snapRows,width:g,style:{overflow:"hidden",...e.styletl},className:" border border-solid border-gray-500",children:H})}),(0,t.jsx)(U.Provider,{value:{skipColumns:0,skipRows:null!==(l=e.snapRows)&&void 0!==l?l:0},children:(0,t.jsx)(_.cd,{ref:x,columnCount:e.snapColumns,rowCount:e.rows.length-(null!==(c=e.snapRows)&&void 0!==c?c:0),columnWidth:e=>w.columnWidths[e],rowHeight:e=>30,height:P-(null!==(u=e.snapRows)&&void 0!==u?u:0)*30,width:g,style:{overflow:"hidden",...e.stylebl},className:" border border-solid border-gray-500",children:H})})]}),(0,t.jsxs)("div",{className:"w-full h-full flex flex-col",children:[null!=e.snapRows&&e.snapRows>0&&(0,t.jsx)(U.Provider,{value:{skipColumns:null!==(m=e.snapColumns)&&void 0!==m?m:0,skipRows:0},children:(0,t.jsx)(_.cd,{ref:p,columnCount:y-(null!==(f=e.snapColumns)&&void 0!==f?f:0),rowCount:e.snapRows,columnWidth:s=>{var l;return w.columnWidths[s+(null!==(l=e.snapColumns)&&void 0!==l?l:0)]},rowHeight:e=>30,height:30*e.snapRows,width:null!=e.snapColumns&&e.snapColumns>0?E-g:E,style:{overflow:"hidden",...e.styletr},className:" border border-solid border-gray-500",children:H})}),(0,t.jsx)(U.Provider,{value:{skipColumns:null!==(b=e.snapColumns)&&void 0!==b?b:0,skipRows:null!==(R=e.snapRows)&&void 0!==R?R:0},children:(0,t.jsx)(_.cd,{ref:v,onScroll:j,columnCount:y-(null!==(C=e.snapColumns)&&void 0!==C?C:0),rowCount:e.rows.length-(null!==(k=e.snapRows)&&void 0!==k?k:0),columnWidth:s=>{var l;return w.columnWidths[s+(null!==(l=e.snapColumns)&&void 0!==l?l:0)]},rowHeight:e=>30,height:null!=e.snapRows&&e.snapRows>0?P-30*e.snapRows:P,width:null!=e.snapColumns&&e.snapColumns>0?E-g:E,style:{...e.style},className:"thin-scrollbar-x border border-solid border-gray-500",children:H})})]})]})})}})]})});Y.displayName="DataGrid";var V=e=>{let[s,l]=(0,u.useState)([]),o=(s,i,n,r)=>{let a=!r;if(""===n&&a){var d;let s={RoleId:e.roleId,PermissionId:null===(d=e.state.allPermissions.find(e=>e.Name===i))||void 0===d?void 0:d.PermissionId,Permission:"permission.".concat(i)};e.setState(e=>({...e,createRolePermissions:[...e.createRolePermissions,s],deleteRolePermissions:e.deleteRolePermissions.filter(e=>e.Permission!=="permission.".concat(i))}))}else""!==n||a?""===n||a?""!==n&&a&&e.setState(e=>({...e,createRolePermissions:e.createRolePermissions.filter(e=>e.PermissionId!==n||e.Permission!=="permission.".concat(i)),deleteRolePermissions:e.deleteRolePermissions.filter(e=>e.RolePermissionId!==n)})):e.setState(e=>({...e,createRolePermissions:e.createRolePermissions.filter(e=>e.PermissionId!==n||e.Permission!=="permission.".concat(i)),deleteRolePermissions:[...e.deleteRolePermissions,{RolePermissionId:n}]})):e.setState(e=>({...e,createRolePermissions:e.createRolePermissions.filter(e=>e.Permission!=="permission.".concat(i))}));l(e=>{let l=[...e],r=l[s.row],d={...r.columns[s.col]};return d.custom=(e,s)=>(0,t.jsx)(A,{icon:a?"system":"none",onClick:()=>o(s,i,n,a)}),r.columns[s.col]=d,l})},i=(s,o,n,r,a)=>{let d="none",c=s;s.endsWith("NONE")?(c=c.substring(0,s.length-4).concat("USER"),d="user"):s.endsWith("USER")?(c=c.substring(0,s.length-4).concat("TEAM"),d="team"):s.endsWith("TEAM")?(c=c.substring(0,s.length-4).concat("SYSTEM"),d="system"):s.endsWith("SYSTEM")&&(c=c.substring(0,s.length-6).concat("NONE"),d="none"),"none"===d&&null!=n&&e.setState(e=>({...e,deleteRolePermissions:[...e.deleteRolePermissions,{RolePermissionId:n}],updateRolePermissions:e.updateRolePermissions.filter(e=>e.RolePermissionId!==n),createRolePermissions:e.createRolePermissions.filter(e=>e.PermissionId!==n)})),"none"!==d&&null==n&&e.setState(s=>{var l;return{...s,createRolePermissions:[...s.createRolePermissions.filter(e=>e.Permission!=="".concat(r,".").concat(a)),{RolePermissionId:"",RoleId:e.roleId,PermissionId:null===(l=e.state.allPermissions.find(e=>e.Name===c))||void 0===l?void 0:l.PermissionId,Permission:"".concat(r,".").concat(a)}]}}),"none"!==d&&null!=n&&e.setState(s=>{var l;return{...s,updateRolePermissions:[...s.updateRolePermissions.filter(e=>e.RolePermissionId!==n),{RolePermissionId:n,PermissionId:null===(l=e.state.allPermissions.find(e=>e.Name===c))||void 0===l?void 0:l.PermissionId}],deleteRolePermissions:s.deleteRolePermissions.filter(e=>e.RolePermissionId!==n)}}),l(e=>e.map((e,s)=>({columns:e.columns.map((e,l)=>s===o.row&&l===o.col?{...e,custom:(e,s)=>(0,t.jsx)(A,{icon:d,onClick:()=>i(c,s,n,r,a)})}:e)})))};return{toggleBinaryPermission:o,toggleTablePermission:i,rows:s,setRows:l}},Q=e=>{let s=V(e),l=(e,s,l)=>{var t,o,i,n,r;let a="none",d=e.find(e=>{var t;return null===(t=e.Permission)||void 0===t?void 0:t.startsWith("TABLE_".concat(s,"_").concat(l))});return null==d?{permissionLevel:"none",RolePermissionId:null}:(((null===(t=d.Permission)||void 0===t?void 0:t.endsWith("IMPORT"))||(null===(o=d.Permission)||void 0===o?void 0:o.endsWith("EXPORT")))&&(a="system"),(null===(i=d.Permission)||void 0===i?void 0:i.endsWith("USER"))&&(a="user"),(null===(n=d.Permission)||void 0===n?void 0:n.endsWith("TEAM"))&&(a="team"),(null===(r=d.Permission)||void 0===r?void 0:r.endsWith("SYSTEM"))&&(a="system"),{permissionLevel:a,RolePermissionId:d.RolePermissionId})},o=(o,i)=>{let n=[];for(let r of(n.push({columns:[{value:"Entity",isReadOnly:!0,style:{}},{value:"Create",isReadOnly:!0,style:{justifyContent:"center"}},{value:"Read",isReadOnly:!0,style:{justifyContent:"center"}},{value:"Update",isReadOnly:!0,style:{justifyContent:"center"}},{value:"Delete",isReadOnly:!0,style:{justifyContent:"center"}},{value:"Assign",isReadOnly:!0,style:{justifyContent:"center"}},{value:"Import",isReadOnly:!0,style:{justifyContent:"center"}},{value:"Export",isReadOnly:!0,style:{justifyContent:"center"}}]}),i)){let i=l(o,r.tableName,"CREATE"),a=l(o,r.tableName,"READ"),d=l(o,r.tableName,"UPDATE"),c=l(o,r.tableName,"DELETE"),u=l(o,r.tableName,"ASSIGN"),m=l(o,r.tableName,"IMPORT"),f=l(o,r.tableName,"EXPORT"),h=e.roleId!==es,x={columns:[{value:r.tableName,isReadOnly:!0,style:{border:"none",userSelect:"none"}},{custom:(e,l)=>(0,t.jsx)(A,{icon:i.permissionLevel,onClick:()=>h&&s.toggleTablePermission("TABLE_".concat(r.tableName,"_CREATE_").concat(i.permissionLevel.toUpperCase()),l,i.RolePermissionId,r.tableName,"CREATE")}),isReadOnly:!0,style:{justifyContent:"center",border:"none",userSelect:"none"}},{custom:(e,l)=>(0,t.jsx)(A,{icon:a.permissionLevel,onClick:()=>h&&s.toggleTablePermission("TABLE_".concat(r.tableName,"_READ_").concat(a.permissionLevel.toUpperCase()),l,a.RolePermissionId,r.tableName,"READ")}),isReadOnly:!0,style:{justifyContent:"center",border:"none",userSelect:"none"}},{custom:(e,l)=>(0,t.jsx)(A,{icon:d.permissionLevel,onClick:()=>h&&s.toggleTablePermission("TABLE_".concat(r.tableName,"_UPDATE_").concat(d.permissionLevel.toUpperCase()),l,d.RolePermissionId,r.tableName,"UPDATE")}),isReadOnly:!0,style:{justifyContent:"center",border:"none",userSelect:"none"}},{custom:(e,l)=>(0,t.jsx)(A,{icon:c.permissionLevel,onClick:()=>h&&s.toggleTablePermission("TABLE_".concat(r.tableName,"_DELETE_").concat(c.permissionLevel.toUpperCase()),l,c.RolePermissionId,r.tableName,"DELETE")}),isReadOnly:!0,style:{justifyContent:"center",border:"none",userSelect:"none"}},{custom:(e,l)=>(0,t.jsx)(A,{icon:u.permissionLevel,onClick:()=>h&&s.toggleTablePermission("TABLE_".concat(r.tableName,"_ASSIGN_").concat(u.permissionLevel.toUpperCase()),l,u.RolePermissionId,r.tableName,"ASSIGN")}),isReadOnly:!0,style:{justifyContent:"center",border:"none",userSelect:"none"}},{custom:(e,l)=>(0,t.jsx)(A,{icon:m.permissionLevel,onClick:()=>{var e;return h&&s.toggleBinaryPermission(l,"TABLE_".concat(r.tableName,"_IMPORT"),null!==(e=m.RolePermissionId)&&void 0!==e?e:"","none"!==m.permissionLevel)}}),isReadOnly:!0,style:{justifyContent:"center",border:"none",userSelect:"none"}},{custom:(e,l)=>(0,t.jsx)(A,{icon:f.permissionLevel,onClick:()=>{var e;return h&&s.toggleBinaryPermission(l,"TABLE_".concat(r.tableName,"_EXPORT"),null!==(e=f.RolePermissionId)&&void 0!==e?e:"","none"!==f.permissionLevel)}}),isReadOnly:!0,style:{justifyContent:"center",border:"none",userSelect:"none"}}]};n.push(x)}s.setRows(n)};return(0,u.useEffect)(()=>{o(e.state.rolePermissions,e.state.tables)},[e.state.rolePermissions,e.state.tables]),(0,t.jsx)(Y,{rows:s.rows,columnWidths:[300,100,100,100,100,100,100,100],snapRows:1,snapColumns:1,editable:!1,style:{borderBottomRightRadius:"0.2rem"},styletr:{borderTopRightRadius:"0.2rem"},styletl:{borderTopLeftRadius:"0.2rem"},stylebl:{borderBottomLeftRadius:"0.2rem"}})},q=e=>{let s=V(e),l=()=>{let l=[];l.push({columns:[{value:"Permission Name",isReadOnly:!0},{value:"Access",isReadOnly:!0,style:{justifyContent:"center"}}]});let o=e.roleId!==es;for(let i of e.state.allPermissions){if("System"===i.Tag)continue;let n="",r=!1;for(let s of e.state.rolePermissions)if(s.PermissionId===i.PermissionId){n=s.RolePermissionId,r=!0;break}let a={columns:[{value:i.Name,isReadOnly:!0,style:{border:"none"}},{custom:(e,l)=>(0,t.jsx)(A,{icon:n?"system":"none",onClick:()=>o&&s.toggleBinaryPermission(l,i.Name,n,r)}),style:{justifyContent:"center",border:"none",userSelect:"none"}}]};l.push(a)}s.setRows(l)};return(0,u.useEffect)(()=>{l()},[]),(0,t.jsx)(Y,{rows:s.rows,columnWidths:[300,150],snapColumns:1,snapRows:1,editable:!1,style:{borderBottomRightRadius:"0.2rem"},styletr:{borderTopRightRadius:"0.2rem"},styletl:{borderTopLeftRadius:"0.2rem"},stylebl:{borderBottomLeftRadius:"0.2rem"}})},K=e=>{let s=V(e),l=()=>{let l=[];l.push({columns:[{value:"Permission Name",isReadOnly:!0},{value:"Access",isReadOnly:!0,style:{justifyContent:"center"}}]});let o=e.roleId!==es;for(let i of e.state.allPermissions){if("System"!==i.Tag||!i.Name.startsWith("JOB_"))continue;let n="",r=!1;for(let s of e.state.rolePermissions)if(s.PermissionId===i.PermissionId){n=s.RolePermissionId,r=!0;break}let a={columns:[{value:i.Name,isReadOnly:!0,style:{border:"none"}},{custom:(e,l)=>(0,t.jsx)(A,{icon:n?"system":"none",onClick:()=>o&&s.toggleBinaryPermission(l,i.Name,n,r)}),style:{justifyContent:"center",border:"none",userSelect:"none"}}]};l.push(a)}s.setRows(l)};return(0,u.useEffect)(()=>{l()},[]),(0,t.jsx)(Y,{rows:s.rows,columnWidths:[300,150],snapColumns:1,snapRows:1,editable:!1,style:{borderBottomRightRadius:"0.2rem"},styletr:{borderTopRightRadius:"0.2rem"},styletl:{borderTopLeftRadius:"0.2rem"},stylebl:{borderBottomLeftRadius:"0.2rem"}})},$=e=>{let s=V(e),l=()=>{let l=[];l.push({columns:[{value:"Permission Name",isReadOnly:!0},{value:"Access",isReadOnly:!0,style:{justifyContent:"center"}}]});let o=e.roleId!==es;for(let i of e.state.allPermissions){if("System"!==i.Tag||i.Name.startsWith("TABLE_")||i.Name.startsWith("JOB_")||!(i.Name.startsWith("ACTION_ADMIN")||i.Name.startsWith("ACTION_TABLE")||"ACCESS_ADMIN_DASHBOARD"==i.Name))continue;let n="",r=!1;for(let s of e.state.rolePermissions)if(s.PermissionId===i.PermissionId){n=s.RolePermissionId,r=!0;break}let a={columns:[{value:i.Name,isReadOnly:!0,style:{border:"none"}},{custom:(e,l)=>(0,t.jsx)(A,{icon:n?"system":"none",onClick:()=>o&&s.toggleBinaryPermission(l,i.Name,n,r)}),style:{justifyContent:"center",border:"none",userSelect:"none"}}]};l.push(a)}s.setRows(l)};return(0,u.useEffect)(()=>{l()},[]),(0,t.jsx)(Y,{rows:s.rows,columnWidths:[300,150],snapColumns:1,snapRows:1,editable:!1,style:{borderBottomRightRadius:"0.2rem"},styletr:{borderTopRightRadius:"0.2rem"},styletl:{borderTopLeftRadius:"0.2rem"},stylebl:{borderBottomLeftRadius:"0.2rem"}})},ee=e=>{let s=V(e),l=()=>{let l=[];l.push({columns:[{value:"Permission Name",isReadOnly:!0},{value:"Access",isReadOnly:!0,style:{justifyContent:"center"}}]});let o=e.roleId!==es;for(let i of e.state.allPermissions){if("System"!==i.Tag||i.Name.startsWith("TABLE_")||i.Name.startsWith("JOB_")||i.Name.startsWith("ACTION_ADMIN")||i.Name.startsWith("ACTION_TABLE")||"ACCESS_ADMIN_DASHBOARD"==i.Name)continue;let n="",r=!1;for(let s of e.state.rolePermissions)if(s.PermissionId===i.PermissionId){n=s.RolePermissionId,r=!0;break}let a={columns:[{value:i.Name,isReadOnly:!0,style:{border:"none"}},{custom:(e,l)=>(0,t.jsx)(A,{icon:n?"system":"none",onClick:()=>o&&s.toggleBinaryPermission(l,i.Name,n,r)}),style:{justifyContent:"center",border:"none",userSelect:"none"}}]};l.push(a)}s.setRows(l)};return(0,u.useEffect)(()=>{l()},[]),(0,t.jsx)(Y,{rows:s.rows,columnWidths:[300,150],snapColumns:1,snapRows:1,editable:!1,style:{borderBottomRightRadius:"0.2rem"},styletr:{borderTopRightRadius:"0.2rem"},styletl:{borderTopLeftRadius:"0.2rem"},stylebl:{borderBottomLeftRadius:"0.2rem"}})};let es="64589861-0481-4dbb-a96f-9b8b6546c40d";var el=e=>{let s=(0,o.Z)(),[l,n]=u.useState(!0),[r,a]=(0,u.useState)({tables:[],allPermissions:[],rolePermissions:[],createRolePermissions:[],updateRolePermissions:[],deleteRolePermissions:[],isLoaded:!1}),[d,c]=(0,u.useState)("entities"),m=async()=>{if(null==e.roleId){n(!1);return}let l=await s.tables();if(!l.succeeded)return;let t=new T.ZP(["*"]).top(999999).from("Permission").orderBy("Name","asc").distinct().toReadRequest(),o=await s.read(t),i=new T.ZP(["*"]).top(999999).from("RolePermission").where("RoleId","==",e.roleId).distinct().toReadRequest(),r=await s.read(i);r.succeeded&&(a(e=>({...e,tables:l.data,allPermissions:o.data.results,rolePermissions:r.data.results,isLoaded:!0})),n(!1))},f=(0,u.useCallback)(async()=>(n(!0),(await s.bulk({creates:r.createRolePermissions.map(e=>({tableName:"RolePermission",fields:{PermissionId:e.PermissionId,RoleId:e.RoleId}})),updates:r.updateRolePermissions.map(e=>({tableName:"RolePermission",fields:e})),deletes:r.deleteRolePermissions.map(e=>({tableName:"RolePermission",fields:e}))})).succeeded)?(n(!1),{continue:!0}):(n(!1),{continue:!1}),[r.deleteRolePermissions,r.createRolePermissions,r.updateRolePermissions]);return(0,u.useEffect)(()=>{m()},[]),(0,t.jsxs)("div",{className:"w-full flex flex-col gap-4",children:[(0,t.jsx)(B.Z,{name:"Name"}),(0,t.jsxs)("div",{className:"w-full h-[500px] relative",children:[l&&(0,t.jsx)("div",{className:"w-full h-full absolute flex justify-center items-center",children:(0,t.jsx)(i.a,{})}),null==e.roleId&&(0,t.jsx)("div",{className:"w-full h-full flex justify-center items-center",children:"Save the role to set permissions"}),null!=e.roleId&&r.isLoaded&&(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(D.m,{defaultValue:"entities",className:"h-full flex flex-col",onTabChange:c,children:[(0,t.jsxs)(D.m.List,{children:[(0,t.jsx)(D.m.Tab,{value:"entities",children:"Entities"}),(0,t.jsx)(D.m.Tab,{value:"actions",children:"Actions"}),(0,t.jsx)(D.m.Tab,{value:"jobs",children:"Jobs"}),(0,t.jsx)(D.m.Tab,{value:"system",children:"System"}),(0,t.jsx)(D.m.Tab,{value:"permissions",children:"Custom Permissions"})]}),(0,t.jsx)(D.m.Panel,{value:"entities",pt:"xs",className:"h-full",children:(0,t.jsx)("div",{className:"w-full h-full",children:(0,t.jsx)(Q,{roleId:e.roleId,state:r,setState:a})})}),(0,t.jsx)(D.m.Panel,{value:"actions",pt:"xs",className:"h-full",children:(0,t.jsx)("div",{className:"w-full h-full",children:(0,t.jsx)(ee,{roleId:e.roleId,state:r,setState:a})})}),(0,t.jsx)(D.m.Panel,{value:"permissions",pt:"xs",className:"h-full",children:(0,t.jsx)("div",{className:"w-full h-full",children:(0,t.jsx)(q,{roleId:e.roleId,state:r,setState:a})})}),(0,t.jsx)(D.m.Panel,{value:"jobs",pt:"xs",className:"h-full",children:(0,t.jsx)("div",{className:"w-full h-full",children:(0,t.jsx)(K,{roleId:e.roleId,state:r,setState:a})})}),(0,t.jsx)(D.m.Panel,{value:"system",pt:"xs",className:"h-full",children:(0,t.jsx)("div",{className:"w-full h-full",children:(0,t.jsx)($,{roleId:e.roleId,state:r,setState:a})})})]})})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)("div",{className:"flex gap-5 w-full",children:[null!=e.roleId&&null!=d&&"entities"===d&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{className:"flex text-sm gap-1 items-center",children:[(0,t.jsx)(A,{icon:"none"}),"None"]}),(0,t.jsxs)("span",{className:"flex text-sm gap-1 items-center",children:[(0,t.jsx)(A,{icon:"user"}),"User"]}),(0,t.jsxs)("span",{className:"flex text-sm gap-1 items-center",children:[(0,t.jsx)(A,{icon:"team"}),"Team"]}),(0,t.jsxs)("span",{className:"flex text-sm gap-1 items-center",children:[(0,t.jsx)(A,{icon:"system"}),"System"]})]}),null!=e.roleId&&null!=d&&("permissions"===d||"system"===d)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{className:"flex text-sm gap-1 items-center whitespace-nowrap",children:[(0,t.jsx)(A,{icon:"none"}),"Doesn't have permission"]}),(0,t.jsxs)("span",{className:"flex text-sm gap-1 items-center whitespace-nowrap",children:[(0,t.jsx)(A,{icon:"system"}),"Has permission"]})]}),null!=e.roleId&&null!=d&&"actions"===d&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{className:"flex text-sm gap-1 items-center whitespace-nowrap",children:[(0,t.jsx)(A,{icon:"none"}),"Can't execute action"]}),(0,t.jsxs)("span",{className:"flex text-sm gap-1 items-center whitespace-nowrap",children:[(0,t.jsx)(A,{icon:"system"}),"Can execute action"]})]}),null!=e.roleId&&null!=d&&"jobs"===d&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{className:"flex text-sm gap-1 items-center whitespace-nowrap",children:[(0,t.jsx)(A,{icon:"none"}),"Can't start job"]}),(0,t.jsxs)("span",{className:"flex text-sm gap-1 items-center whitespace-nowrap",children:[(0,t.jsx)(A,{icon:"system"}),"Can start job"]})]})]}),(0,t.jsx)(O.Z,{onPreSave:f})]})]})},et=()=>{var e,s,l,o,i;let n=eg();return(0,t.jsx)(t.Fragment,{children:n.tables.filter(e=>["User","Role","Team","Permission"].includes(e.tableName)).length>0&&!(null===(e=n.props.hiddenMenuItems)||void 0===e?void 0:e.includes("Security"))&&(0,t.jsxs)(b.O,{label:"Security",icon:(0,t.jsx)(C.Z,{size:16,strokeWidth:2,color:n.color}),children:[n.tables.find(e=>"User"===e.tableName)&&!(null===(s=n.props.hiddenMenuItems)||void 0===s?void 0:s.includes("Users"))&&(0,t.jsx)(b.O,{label:"Users",onClick:()=>n.setActiveComponent({component:(0,t.jsx)("div",{className:"w-full h-full flex flex-col",children:(0,t.jsx)("div",{className:"grow h-1",children:(0,t.jsx)(S.default,{tableName:"User",maxResults:100,appendCustomForm:e=>void 0===e.snapshot?(0,t.jsx)(t.Fragment,{}):(0,t.jsxs)("div",{className:" h-96 mt-5 flex justify-stretch gap-4",children:[(0,t.jsx)(S.default,{title:"Roles",tableName:"UserRole",fields:["RoleId"],filters:[{field:"UserId",value:e.snapshot.UserId}],formZIndex:1e3,formFields:["RoleId"],formFieldDefaults:[{field:"UserId",value:e.snapshot.UserId}],formLookupQueries:[{field:"RoleId",except:[{fromField:"RoleId",query:{tableName:"UserRole",fields:["RoleId"],filters:[{field:"UserId",operator:"==",value:e.snapshot.UserId}]}}]}]}),(0,t.jsx)(S.default,{title:"Teams",tableName:"TeamUser",fields:["TeamId"],filters:[{field:"UserId",value:e.snapshot.UserId}],formZIndex:1e3,formFields:["TeamId"],formFieldDefaults:[{field:"UserId",value:e.snapshot.UserId}],formLookupQueries:[{field:"TeamId",except:[{fromField:"TeamId",query:{tableName:"TeamUser",fields:["TeamId"],filters:[{field:"UserId",operator:"==",value:e.snapshot.UserId}]}}]}]})]})})})})}),icon:(0,t.jsx)(k.Z,{size:16,strokeWidth:2,color:n.color})}),n.tables.find(e=>"Team"===e.tableName)&&!(null===(l=n.props.hiddenMenuItems)||void 0===l?void 0:l.includes("Teams"))&&(0,t.jsx)(b.O,{label:"Teams",onClick:()=>n.setActiveComponent({component:(0,t.jsx)("div",{className:"w-full h-full flex flex-col",children:(0,t.jsx)("div",{className:"grow h-1",children:(0,t.jsx)(S.default,{tableName:"Team",formCloseOnCreate:!1,maxResults:100,appendCustomForm:e=>void 0===e.snapshot?(0,t.jsx)(t.Fragment,{}):(0,t.jsxs)("div",{className:" h-96 mt-5 flex justify-stretch gap-4",children:[(0,t.jsx)(S.default,{title:"Roles",tableName:"TeamRole",fields:["RoleId"],filters:[{field:"TeamId",value:e.snapshot.TeamId}],formZIndex:1e3,formFields:["RoleId"],formFieldDefaults:[{field:"TeamId",value:e.snapshot.TeamId}],formLookupQueries:[{field:"RoleId",except:[{fromField:"RoleId",query:{tableName:"TeamRole",fields:["RoleId"],filters:[{field:"TeamId",operator:"==",value:e.snapshot.TeamId}]}}]}]}),(0,t.jsx)(S.default,{title:"Users",tableName:"TeamUser",fields:["UserId"],filters:[{field:"TeamId",value:e.snapshot.TeamId}],formZIndex:1e3,formFields:["UserId"],formFieldDefaults:[{field:"TeamId",value:e.snapshot.TeamId}],formLookupQueries:[{field:"UserId",except:[{fromField:"UserId",query:{tableName:"TeamUser",fields:["UserId"],filters:[{field:"TeamId",operator:"==",value:e.snapshot.TeamId}]}}]}]})]}),formMaxWidth:72})})})}),icon:(0,t.jsx)(P.Z,{size:16,strokeWidth:2,color:n.color})}),n.tables.find(e=>"Role"===e.tableName)&&!(null===(o=n.props.hiddenMenuItems)||void 0===o?void 0:o.includes("Roles"))&&(0,t.jsx)(b.O,{label:"Roles",onClick:()=>{n.setActiveComponent({component:(0,t.jsx)("div",{className:"w-full h-full flex flex-col",children:(0,t.jsx)("div",{className:"grow h-1",children:(0,t.jsx)(S.default,{tableName:"Role",formMaxWidth:72,maxResults:100,customForm:e=>{var s;return(0,t.jsx)(el,{roleId:null===(s=e.snapshot)||void 0===s?void 0:s.RoleId,formBuilder:e})}})})})})},icon:(0,t.jsx)(E.Z,{size:16,strokeWidth:2,color:n.color})}),n.tables.find(e=>"Permission"===e.tableName)&&!(null===(i=n.props.hiddenMenuItems)||void 0===i?void 0:i.includes("Permissions"))&&(0,t.jsx)(b.O,{label:"Permissions",onClick:()=>n.setActiveComponent({component:(0,t.jsx)("div",{className:"w-full h-full flex flex-col",children:(0,t.jsx)("div",{className:"grow h-1",children:(0,t.jsx)(S.default,{tableName:"Permission",fields:["Name"],filters:[{field:"Tag",operator:"!=",value:"System"}],formFields:["Name"],formCloseOnCreate:!0,formMaxWidth:36,maxResults:100})})})}),icon:(0,t.jsx)(p.Z,{size:16,strokeWidth:2,color:n.color})})]})})},eo=l(4459),ei=()=>{var e;let s=eg();return(0,t.jsx)(t.Fragment,{children:s.tables.filter(e=>"Option"===e.tableName).length>0&&!(null===(e=s.props.hiddenMenuItems)||void 0===e?void 0:e.includes("Options"))&&(0,t.jsx)(b.O,{label:"Options",icon:(0,t.jsx)(eo.Z,{size:16,strokeWidth:2,color:s.color}),onClick:()=>s.setActiveComponent({component:(0,t.jsx)("div",{className:"w-full h-full flex flex-col",children:(0,t.jsx)("div",{className:"grow h-1",children:(0,t.jsx)(R.Z,{tableName:"Option",maxResults:100})})})})})})},en=l(2289),er=l(872),ea=e=>{var s,l,i,n;let r=(0,o.Z)(),d=(0,u.useRef)(null),[c,m]=(0,u.useState)(!1),[f,h]=(0,u.useState)(!1),x=async()=>{var s;m(!0),e.formBuilder.dispatch({type:"SET_FIELD_VALUE",payload:{field:"Status",value:"Running"}}),await r.action("ADMIN_TriggerJob",{jobName:null===(s=e.formBuilder.snapshot)||void 0===s?void 0:s.Name}),m(!1)};return((0,u.useEffect)(()=>{let s=setInterval(async()=>{if(null!=d.current&&!f){h(!0);try{var s;let l=await r.read({tableName:e.formBuilder.tableName,id:null===(s=e.formBuilder.snapshot)||void 0===s?void 0:s.JobId,fields:["*"]});if(null!=l&&l.data.results.length>0){let s=l.data.results[0];"Running"!=s.Status?m(!1):m(!0),e.formBuilder.dispatch({type:"SET_FIELD_VALUE",payload:{field:"Status",value:s.Status}}),e.formBuilder.dispatch({type:"SET_FIELD_VALUE",payload:{field:"LastExecution",value:s.LastExecution}})}}catch(e){console.error(e)}finally{h(!1)}}},2500);return()=>clearInterval(s)},[]),(0,u.useEffect)(()=>{var s;null!=e.formBuilder.snapshot&&(null===(s=e.formBuilder.snapshot)||void 0===s?void 0:s.Status)==="Running"&&m(!0),null!=e.formBuilder.snapshot&&(d.current=e.formBuilder.snapshot)},[e.formBuilder.snapshot]),null==e.formBuilder.snapshot||(null===(s=e.formBuilder.snapshot)||void 0===s?void 0:s.Name)==null||(null===(l=e.formBuilder.snapshot)||void 0===l?void 0:l.name)===""||(null===(i=e.formBuilder.snapshot)||void 0===i?void 0:i._ui_info_)==null)?(0,t.jsx)(t.Fragment,{}):(null===(n=e.formBuilder.snapshot)||void 0===n?void 0:n._ui_info_.canTrigger)===!0?(0,t.jsx)(a.z,{variant:"outline",onClick:x,loading:c,children:"Run Job"}):(0,t.jsx)(t.Fragment,{})},ed=()=>{var e;let s=eg();return(0,t.jsx)(t.Fragment,{children:s.tables.filter(e=>"Job"===e.tableName).length>0&&!(null===(e=s.props.hiddenMenuItems)||void 0===e?void 0:e.includes("Jobs"))&&(0,t.jsx)(b.O,{label:"Jobs",icon:(0,t.jsx)(er.Z,{size:16,strokeWidth:2,color:s.color}),onClick:()=>s.setActiveComponent({component:(0,t.jsx)("div",{className:"w-full h-full flex flex-col",children:(0,t.jsx)("div",{className:"grow h-1",children:(0,t.jsx)(S.default,{tableName:"Job",orderBy:[{field:"Name",order:"asc"}],fields:["Name","Status","Queue","IsActive","LastExecution"],filters:[{field:"Tag",operator:"!=",value:"System"}],canCreate:!1,canDelete:!1,formCloseOnEscape:!0,formAppendButton:e=>(0,t.jsx)(ea,{formBuilder:e}),appendCustomForm:e=>{var s;return"CREATE"===e.operation&&t.Fragment,(0,t.jsx)("div",{className:"w-full h-96",children:(0,t.jsx)(S.default,{title:"History",tableName:"JobHistory",fields:["Status","Message","CreatedDate","CompletedDate"],filters:[{field:"JobId",value:null===(s=e.snapshot)||void 0===s?void 0:s.JobId}],orderBy:[{field:"CreatedDate",order:"desc"}],refreshInterval:1e3,maxResults:100,canUpdate:!1,customForm:e=>(0,t.jsxs)("div",{className:"w-full flex flex-col gap-2",children:[(0,t.jsxs)(en.r,{children:[(0,t.jsx)(en.r.Col,{span:4,children:(0,t.jsx)(B.Z,{name:"Name"})}),(0,t.jsx)(en.r.Col,{span:4,children:(0,t.jsx)(B.Z,{name:"JobId"})}),(0,t.jsx)(en.r.Col,{span:4,children:(0,t.jsx)(B.Z,{name:"Status"})})]}),(0,t.jsxs)(en.r,{children:[(0,t.jsx)(en.r.Col,{span:4,children:(0,t.jsx)(B.Z,{name:"CreatedDate"})}),(0,t.jsx)(en.r.Col,{span:4,children:(0,t.jsx)(B.Z,{name:"CompletedDate"})}),(0,t.jsx)(en.r.Col,{span:4})]}),(0,t.jsx)("div",{className:"w-full h-48",children:(0,t.jsx)(B.Z,{name:"Message",varient:"textarea"})})]})})})}})})})})})})},ec=l(7115),eu=()=>{var e;let s=eg();return(0,t.jsx)(t.Fragment,{children:s.tables.filter(e=>"Setting"===e.tableName).length>0&&!(null===(e=s.props.hiddenMenuItems)||void 0===e?void 0:e.includes("Settings"))&&(0,t.jsx)(b.O,{label:"Settings",icon:(0,t.jsx)(ec.Z,{size:16,strokeWidth:2,color:s.color}),onClick:()=>s.setActiveComponent({component:(0,t.jsx)("div",{className:"w-full h-full flex flex-col",children:(0,t.jsx)("div",{className:"grow h-1",children:(0,t.jsx)(S.default,{tableName:"Setting",maxResults:100})})})})})})},em=l(5595),ef=l(950),eh=l(5815),ex=e=>{var s,l;let i=(0,o.Z)(),n=(0,u.useRef)(null),[r,a]=(0,u.useState)(!1),[d,c]=(0,u.useState)(!1),[m,f]=(0,u.useState)(!1),h=e=>{e.filter(e=>e.IsCreate).length===e.length?a(!0):a(!1),e.filter(e=>e.IsUpdate).length===e.length?c(!0):c(!1),e.filter(e=>e.IsDelete).length===e.length?f(!0):f(!1)},p=async e=>{var s;return!0===(await i.bulkUpdate(e.map(e=>({tableName:"AuditField",fields:{...e}})))).succeeded||(null===(s=n.current)||void 0===s||s.refresh(),!1)},v=async e=>{var s;return!0===(await i.update("AuditField",e)).succeeded||(null===(s=n.current)||void 0===s||s.refresh(),!1)};return(0,t.jsxs)("div",{className:"w-full flex flex-col gap-4",children:[(0,t.jsx)(ef.b,{icon:(0,t.jsx)(eh.Z,{size:"1rem"}),color:"yellow",children:"In a multi-server environment, Audit configuration changes may take up to 5 minutes to take effect."}),(null===(s=e.formBuilder.snapshot)||void 0===s?void 0:s.IsTable)&&(0,t.jsxs)(en.r,{children:[(0,t.jsx)(en.r.Col,{span:4,children:(0,t.jsx)(B.Z,{name:"Name"})}),(0,t.jsx)(en.r.Col,{span:2,children:(0,t.jsx)(B.Z,{name:"IsCreate"})}),(0,t.jsx)(en.r.Col,{span:2,children:(0,t.jsx)(B.Z,{name:"IsRead"})}),(0,t.jsx)(en.r.Col,{span:2,children:(0,t.jsx)(B.Z,{name:"IsUpdate"})}),(0,t.jsx)(en.r.Col,{span:2,children:(0,t.jsx)(B.Z,{name:"IsDelete"})})]}),(0,t.jsx)("div",{className:"w-full h-[550px]",children:(0,t.jsx)(S.default,{tableName:"AuditField",columnWidths:["100%","130px","130px","130px"],additionalFields:["IsCreate","IsUpdate","IsDelete"],fields:["Name",{header:e=>(0,t.jsx)("div",{children:(0,t.jsx)(x.X,{label:"Create",checked:r,onChange:s=>{a(s.target.checked),e.setRecords(e=>{let l=e.map(e=>({...e,IsCreate:s.target.checked}));return p(l),l})}})}),body:(e,s)=>(0,t.jsx)(x.X,{checked:e.IsCreate,onChange:l=>{s.setRecords(s=>{let t=s.map(s=>s.AuditFieldId===e.AuditFieldId?{...s,IsCreate:l.target.checked}:s);return t.filter(e=>e.IsCreate).length===s.length?a(!0):a(!1),v(t.find(s=>s.AuditFieldId===e.AuditFieldId)),t})}})},{header:e=>(0,t.jsx)("div",{children:(0,t.jsx)(x.X,{label:"Update",checked:d,onChange:s=>{c(s.target.checked),e.setRecords(e=>{let l=e.map(e=>({...e,IsUpdate:s.target.checked}));return p(l),l})}})}),body:(e,s)=>(0,t.jsx)(x.X,{checked:e.IsUpdate,onChange:l=>{s.setRecords(s=>{let t=s.map(s=>s.AuditFieldId===e.AuditFieldId?{...s,IsUpdate:l.target.checked}:s);return t.filter(e=>e.IsUpdate).length===s.length?c(!0):c(!1),v(t.find(s=>s.AuditFieldId===e.AuditFieldId)),t})}})},{header:e=>(0,t.jsx)("div",{children:(0,t.jsx)(x.X,{label:"Delete",checked:m,onChange:s=>{f(s.target.checked),e.setRecords(e=>{let l=e.map(e=>({...e,IsDelete:s.target.checked}));return p(l),l})}})}),body:(e,s)=>(0,t.jsx)(x.X,{checked:e.IsDelete,onChange:l=>{s.setRecords(s=>{let t=s.map(s=>s.AuditFieldId===e.AuditFieldId?{...s,IsDelete:l.target.checked}:s);return t.filter(e=>e.IsDelete).length===s.length?f(!0):f(!1),v(t.find(s=>s.AuditFieldId===e.AuditFieldId)),t})}})}],maxResults:99999,onRowClick:e=>!1,filters:[{field:"AuditId",operator:"==",value:null===(l=e.formBuilder.snapshot)||void 0===l?void 0:l.AuditId}],orderBy:[{field:"Name",order:"asc"}],onDataLoaded:e=>{h(e.results)}})}),(0,t.jsx)("div",{className:"w-full flex justify-end",children:(0,t.jsx)(O.Z,{})})]})},ep=l(3529),ev=e=>{var s,l,o,i,n,r,a;return(0,u.useEffect)(()=>{var s,l,t;if((null===(s=e.formBuilder.snapshot)||void 0===s?void 0:s.Operation)!=="Read")return;let o=JSON.stringify(JSON.parse(null===(l=e.formBuilder.snapshot)||void 0===l?void 0:l.Query),null,4),i=JSON.stringify(JSON.parse(null===(t=e.formBuilder.snapshot)||void 0===t?void 0:t.Results),null,4);e.formBuilder.setField("Query",o),e.formBuilder.setField("Results",i)},[null===(s=e.formBuilder.snapshot)||void 0===s?void 0:s.Query,null===(l=e.formBuilder.snapshot)||void 0===l?void 0:l.Results]),(0,t.jsxs)("div",{className:"w-full flex flex-col gap-4",children:[(0,t.jsxs)(en.r,{children:[(0,t.jsx)(en.r.Col,{span:4,children:(0,t.jsx)(B.Z,{name:"TableName"})}),(0,t.jsx)(en.r.Col,{span:4,children:(0,t.jsx)(B.Z,{name:"Operation"})}),(0,t.jsx)(en.r.Col,{span:4,children:(0,t.jsx)(B.Z,{name:"CreatedDate"})})]}),(0,t.jsxs)(en.r,{children:[(0,t.jsx)(en.r.Col,{span:4,children:(0,t.jsx)(B.Z,{name:"UserId"})}),(0,t.jsx)(en.r.Col,{span:4,children:(0,t.jsx)(ep.o,{label:"UserId",value:null===(o=e.formBuilder.snapshot)||void 0===o?void 0:o.UserId,readOnly:!0})})]}),(0,t.jsx)(en.r,{children:(null===(i=e.formBuilder.snapshot)||void 0===i?void 0:i.Operation)!=="Read"&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(en.r.Col,{span:4,children:(0,t.jsx)(B.Z,{name:"Name"})}),(0,t.jsx)(en.r.Col,{span:4,children:(0,t.jsx)(B.Z,{name:"EntityId"})})]})}),(null===(n=e.formBuilder.snapshot)||void 0===n?void 0:n.Operation)==="Read"&&(0,t.jsxs)(en.r,{children:[(0,t.jsx)(en.r.Col,{span:6,children:(0,t.jsx)("div",{className:"w-full h-[60vh]",children:(0,t.jsx)(B.Z,{name:"Query",varient:"textarea"})})}),(0,t.jsx)(en.r.Col,{span:6,children:(0,t.jsx)("div",{className:"w-full h-[60vh]",children:(0,t.jsx)(B.Z,{name:"Results",varient:"textarea"})})})]}),(null===(r=e.formBuilder.snapshot)||void 0===r?void 0:r.Operation)!=="Read"&&(0,t.jsx)("div",{className:"w-full h-[500px] mt-2",children:(0,t.jsx)(S.default,{tableName:"AuditHistoryDetail",disabledMessage:null==e.formBuilder.snapshot?"Loading...":void 0,fields:["Name","OldValue","NewValue","EntityName"],maxResults:100,orderBy:[{field:"Name",order:"ASC"}],filters:[{field:"AuditHistoryId",value:null===(a=e.formBuilder.snapshot)||void 0===a?void 0:a.AuditHistoryId}]})})]})},ej=()=>{var e;let s=eg();return(0,t.jsx)(t.Fragment,{children:s.tables.filter(e=>"Option"===e.tableName).length>0&&!(null===(e=s.props.hiddenMenuItems)||void 0===e?void 0:e.includes("Options"))&&(0,t.jsx)(b.O,{label:"Audit",icon:(0,t.jsx)(em.Z,{size:16,strokeWidth:2,color:s.color}),onClick:()=>s.setActiveComponent({component:(0,t.jsx)("div",{className:"w-full flex flex-col grow",children:(0,t.jsxs)(D.m,{defaultValue:"history",styles:{root:{display:"flex",flexDirection:"column",flexGrow:1},panel:{display:"flex",flexDirection:"column",flexGrow:1,height:1}},children:[(0,t.jsxs)(D.m.List,{children:[(0,t.jsx)(D.m.Tab,{value:"history",children:"History"}),(0,t.jsx)(D.m.Tab,{value:"config",children:"Config"})]}),(0,t.jsx)(D.m.Panel,{value:"history",children:(0,t.jsx)("div",{className:"w-full h-full pt-4",children:(0,t.jsx)(S.default,{tableName:"AuditHistory",fields:["Operation","TableName","User","Name","CreatedDate"],columnWidths:["125px","100%","100%","100%","100%"],title:"History",maxResults:100,canCreate:!1,orderBy:[{field:"CreatedDate",order:"desc"}],customForm:e=>(0,t.jsx)(ev,{formBuilder:e})})})}),(0,t.jsx)(D.m.Panel,{value:"config",children:(0,t.jsx)("div",{className:"w-full h-full pt-4",children:(0,t.jsx)(S.default,{tableName:"Audit",title:"Audit",formTitle:"Audit",maxResults:100,orderBy:[{field:"Name",order:"asc"}],fields:["Name","IsCreate","IsRead","IsUpdate","IsDelete"],columnWidths:["350px","100%","100%","100%","100%"],canCreate:!1,canDelete:!1,formMaxWidth:55,formCloseOnEscape:!0,customForm:e=>(0,t.jsx)(ex,{formBuilder:e})})})})]})})})})})};let ew={tableName:"",appendCustomForm:void 0,formAppendButton:void 0,formMaxWidth:void 0,formCloseOnCreate:void 0,formTitle:void 0,fields:void 0,filters:void 0,formFields:void 0,formLookupQueries:void 0,orderBy:void 0,refreshInterval:void 0,canCreate:void 0,canDelete:void 0,maxResults:50},ey=u.createContext(null),eg=()=>{let e=u.useContext(ey);if(!e)throw Error("useAdminDashContext must be used within a AdminDashContextProvider");return e};var eb=e=>{var s;let l=(0,o.Z)(),[f,h]=u.useState(void 0),[x,p]=u.useState(void 0),[j,b]=u.useState([]),[N,R]=(0,m.q)(!1),[C,k]=(0,m.q)(!1),[P,E]=u.useState({canImport:!1,canExport:!1}),S=(0,g.Z)().getIconColor(),A=async()=>{let e=await l.tables();!0===e.succeeded&&b(e.data)},T=async()=>{if(!await l.hasAllPermissions(["ACCESS_ADMIN_DASHBOARD"])){h(!1);return}h(!0);let e=!1,s=!1;await l.hasAllPermissions(["ACTION_ADMIN_ExportDependencies","ACTION_ADMIN_ExportData"])===!0&&(e=!0),await l.hasAllPermissions(["ACTION_ADMIN_ImportData"])&&(s=!0),E({canImport:s,canExport:e})};if((0,u.useEffect)(()=>{T(),A()},[]),void 0===f)return(0,t.jsx)("div",{className:"w-full h-full flex justify-center items-center",children:(0,t.jsx)(i.a,{})});if(!f)return(0,t.jsx)("div",{className:"w-full h-full flex justify-center items-center",children:"You don't have permission to view this page. Please contact your system administrator."});let D=[{order:100,navLink:(0,t.jsx)(I,{})},{order:200,navLink:(0,t.jsx)(et,{})},{order:300,navLink:(0,t.jsx)(ei,{})},{order:400,navLink:(0,t.jsx)(ej,{})},{order:500,navLink:(0,t.jsx)(ed,{})},{order:600,navLink:(0,t.jsx)(eu,{})}];void 0!==e.addMenuItems&&(D=D.concat(e.addMenuItems));let B=D.sort((e,s)=>e.order-s.order);return(0,t.jsxs)(ey.Provider,{value:{props:e,tables:j,color:S,setActiveComponent:p,emptyTableInfo:ew},children:[(0,t.jsx)(v,{opened:N,close:R.close}),(0,t.jsx)(w,{opened:C,close:k.close}),(0,t.jsx)(n.V,{padding:"md",styles:e=>({main:{backgroundColor:"dark"===e.colorScheme?e.colors.dark[8]:e.colors.gray[0],overflow:"hidden",display:"flex"}}),header:(0,t.jsx)(r.h,{height:60,p:"xs",children:(0,t.jsxs)("div",{className:"w-full h-full flex items-center justify-between text-xl",children:[(0,t.jsx)("div",{className:" pl-2",children:null!==(s=e.title)&&void 0!==s?s:"Admin Dashboard"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[!e.forceHideToggleMode&&(0,t.jsx)(y.Z,{}),!0===P.canImport&&!e.forceHideImportData&&(0,t.jsx)(a.z,{variant:"outline",onClick:k.open,children:"Import Data"}),!0===P.canExport&&!e.forceHideExportData&&(0,t.jsx)(a.z,{onClick:R.open,children:"Export Data"})]})]})}),navbar:(0,t.jsx)(d.w,{width:{base:320},p:"xs",children:(0,t.jsx)(d.w.Section,{grow:!0,component:c.x,mx:"-xs",px:"xs",children:B.map(e=>(0,t.jsx)(t.Fragment,{children:e.navLink}))})}),children:(0,t.jsx)("div",{className:"flex w-full",children:null!=x&&x.component})})]})},eN=()=>(0,t.jsx)(eb,{})},5299:function(e,s,l){"use strict";var t=l(4246),o=l(7378),i=l(7628);let n=o.lazy(()=>Promise.all([l.e(932),l.e(698),l.e(786),l.e(93),l.e(879)]).then(l.bind(l,9879))),r=(0,o.forwardRef)((e,s)=>{let[l,r]=(0,o.useState)(!1),a=o.useRef(null);if((0,o.useImperativeHandle)(s,()=>a.current),(0,o.useEffect)(()=>{r(!0)},[]),!l)return(0,t.jsx)("div",{className:"w-full h-full flex justify-center items-center",children:(0,t.jsx)(i.a,{})});let d=e.tableName+JSON.stringify(e.filters)+JSON.stringify(e.joins)+JSON.stringify(e.orderBy)+JSON.stringify(e.except)+JSON.stringify(e.additionalFields)+JSON.stringify(e.fields)+JSON.stringify(e.maxResults);return(0,t.jsx)(n,{ref:a,...e},d)});s.Z=r},9354:function(e,s,l){"use strict";var t=l(4246),o=l(7302),i=l(823),n=l(6164),r=l(8540),a=l(4215);l(7378),s.Z=()=>{let e=(0,o.rZ)(),{colorScheme:s,toggleColorScheme:l}=(0,i.X)(),d="dark"===s;return(0,t.jsx)(n.A,{variant:"outline",color:d?"yellow":e.fn.primaryColor(),onClick:()=>l(),title:"Toggle color scheme",children:d?(0,t.jsx)(r.Z,{size:"1.1rem"}):(0,t.jsx)(a.Z,{size:"1.1rem"})})}}},function(e){e.O(0,[932,698,786,240,93,879,888,774,179],function(){return e(e.s=3848)}),_N_E=e.O()}]);